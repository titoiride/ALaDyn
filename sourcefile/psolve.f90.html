<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A High-Accuracy PIC Code for the Maxwell-Vlasov Equations">
    
    <meta name="author" content="The ALaDyn Collaboration" >
    <link rel="icon" href="../favicon.png">

    <title>psolve.f90 &ndash; ALaDyn</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">ALaDyn <small>3.0.1</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Guide</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/aladyn.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/aladyn.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>psolve.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 0.7% of total for source files.">184 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/psolve.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">psolve.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/psolve.html">psolve</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/psolve.f90.html#src">psolve.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~psolve.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilepsolvef90EfferentGraph" width="641pt" height="225pt"
 viewBox="0.00 0.00 641.00 224.57" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~psolve.f90~~EfferentGraph" class="graph" transform="scale(.8124 .8124) rotate(0) translate(4 272.4227)">
<title>sourcefile~~psolve.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-272.4227 785,-272.4227 785,4 -4,4"/>
<!-- sourcefile~psolve.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~psolve.f90</title>
<polygon fill="none" stroke="#000000" points="781,-126 714,-126 714,-102 781,-102 781,-126"/>
<text text-anchor="middle" x="747.5" y="-111.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">psolve.f90</text>
</g>
<!-- sourcefile~prl_fft.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~prl_fft.f90</title>
<g id="a_sourcefile~~psolve.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/prl_fft.f90.html" xlink:title="prl_fft.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="666,-166 602,-166 602,-142 666,-142 666,-166"/>
<text text-anchor="middle" x="634" y="-151.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">prl_fft.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M713.7536,-125.893C701.8944,-130.0724 688.422,-134.8204 675.9701,-139.2088"/>
<polygon fill="#ff0000" stroke="#ff0000" points="674.521,-136.0084 666.2529,-142.6333 676.8477,-142.6104 674.521,-136.0084"/>
</g>
<!-- sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~pstruct_data.f90</title>
<g id="a_sourcefile~~psolve.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/pstruct_data.f90.html" xlink:title="pstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="384,-249 285,-249 285,-225 384,-225 384,-249"/>
<text text-anchor="middle" x="334.5" y="-234.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M736.3283,-126.3773C723.4519,-139.9842 701.0815,-161.6779 678,-175 588.7071,-226.5378 466.3859,-236.9569 394.3742,-238.1482"/>
<polygon fill="#ff0000" stroke="#ff0000" points="394.0855,-234.651 384.1245,-238.2608 394.1624,-241.6506 394.0855,-234.651"/>
</g>
<!-- sourcefile~common_param.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~common_param.f90</title>
<g id="a_sourcefile~~psolve.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/common_param.f90.html" xlink:title="common_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="395,-127 274,-127 274,-103 395,-103 395,-127"/>
<text text-anchor="middle" x="334.5" y="-112.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">common_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M713.7025,-114.0818C646.5514,-114.2444 495.0796,-114.6112 405.2203,-114.8288"/>
<polygon fill="#ff0000" stroke="#ff0000" points="405.1052,-111.3289 395.1137,-114.8532 405.1222,-118.3289 405.1052,-111.3289"/>
</g>
<!-- sourcefile~grid_fields.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~grid_fields.f90</title>
<g id="a_sourcefile~~psolve.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/grid_fields.f90.html" xlink:title="grid_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="678,-86 590,-86 590,-62 678,-62 678,-86"/>
<text text-anchor="middle" x="634" y="-71.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M713.7536,-102.107C702.5224,-98.1489 689.8442,-93.6808 677.9562,-89.4912"/>
<polygon fill="#ff0000" stroke="#ff0000" points="678.8001,-86.0776 668.2053,-86.0547 676.4733,-92.6796 678.8001,-86.0776"/>
</g>
<!-- sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~fstruct_data.f90</title>
<g id="a_sourcefile~~psolve.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/fstruct_data.f90.html" xlink:title="fstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="238,-24 142,-24 142,0 238,0 238,-24"/>
<text text-anchor="middle" x="190" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M737.8955,-101.9867C725.6616,-87.6375 703.0759,-64.1742 678,-53 602.1663,-19.2074 575.3578,-36.2233 492.5,-31"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M492.5,-31C448.4022,-26.4976 439.0779,-14.693 395,-10 341.5245,-4.3064 327.774,-9.3599 274,-10 265.8077,-10.0975 257.1669,-10.2485 248.6687,-10.4248"/>
<polygon fill="#ff0000" stroke="#ff0000" points="248.3338,-6.9312 238.4132,-10.6505 248.4879,-13.9295 248.3338,-6.9312"/>
</g>
<!-- sourcefile~grid_param.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~grid_param.f90</title>
<g id="a_sourcefile~~psolve.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/grid_param.f90.html" xlink:title="grid_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="381.5,-43 287.5,-43 287.5,-19 381.5,-19 381.5,-43"/>
<text text-anchor="middle" x="334.5" y="-28.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M492.5,-31C459.1951,-28.9005 421.8628,-28.7964 391.8522,-29.2654"/>
<polygon fill="#ff0000" stroke="#ff0000" points="391.4956,-25.7712 381.561,-29.4529 391.6232,-32.7701 391.4956,-25.7712"/>
</g>
<!-- sourcefile~parallel.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~parallel.f90</title>
<g id="a_sourcefile~~psolve.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/parallel.f90.html" xlink:title="parallel.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="530.5,-166 454.5,-166 454.5,-142 530.5,-142 530.5,-166"/>
<text text-anchor="middle" x="492.5" y="-151.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">parallel.F90</text>
</a>
</g>
</g>
<!-- sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M601.8915,-154C583.838,-154 560.9423,-154 540.7682,-154"/>
<polygon fill="#ff0000" stroke="#ff0000" points="540.5067,-150.5001 530.5066,-154 540.5066,-157.5001 540.5067,-150.5001"/>
</g>
<!-- sourcefile~modern_fft_lib.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~modern_fft_lib.f90</title>
<g id="a_sourcefile~~psolve.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/modern_fft_lib.f90.html" xlink:title="modern_fft_lib.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="548.5,-208 436.5,-208 436.5,-184 548.5,-184 548.5,-208"/>
<text text-anchor="middle" x="492.5" y="-193.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modern_fft_lib.F90</text>
</a>
</g>
</g>
<!-- sourcefile~prl_fft.f90&#45;&gt;sourcefile~modern_fft_lib.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~prl_fft.f90&#45;&gt;sourcefile~modern_fft_lib.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M601.8915,-163.5305C584.4527,-168.7066 562.4959,-175.2238 542.8382,-181.0586"/>
<polygon fill="#ff0000" stroke="#ff0000" points="541.6952,-177.7469 533.1045,-183.9478 543.6871,-184.4575 541.6952,-177.7469"/>
</g>
<!-- sourcefile~struct_def.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~struct_def.f90</title>
<g id="a_sourcefile~~psolve.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/struct_def.f90.html" xlink:title="struct_def.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="232.5,-249 147.5,-249 147.5,-225 232.5,-225 232.5,-249"/>
<text text-anchor="middle" x="190" y="-234.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">struct_def.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M284.7713,-237C271.2398,-237 256.5372,-237 242.84,-237"/>
<polygon fill="#ffff00" stroke="#ffff00" points="242.5976,-233.5001 232.5976,-237 242.5975,-240.5001 242.5976,-233.5001"/>
</g>
<!-- sourcefile~precision_def.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~precision_def.f90</title>
<g id="a_sourcefile~~psolve.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/precision_def.f90.html" xlink:title="precision_def.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="106,-189 0,-189 0,-165 106,-165 106,-189"/>
<text text-anchor="middle" x="53" y="-174.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">precision_def.F90</text>
</a>
</g>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M303.3426,-249.0389C264.2876,-262.2136 195.9276,-278.8661 142,-258 110.5997,-245.8503 83.4643,-216.8991 67.6673,-197.1141"/>
<polygon fill="#ffff00" stroke="#ffff00" points="70.3009,-194.7978 61.4221,-189.017 64.758,-199.0729 70.3009,-194.7978"/>
</g>
<!-- sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M285.9538,-102.9986C251.0559,-95.3023 207.2394,-87.8142 190,-94"/>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M612.5092,-86.1503C588.5803,-99.679 549.7269,-121.6456 522.7373,-136.9047"/>
<polygon fill="#00ffff" stroke="#00ffff" points="520.7119,-134.0291 513.7294,-141.9975 524.1571,-140.1226 520.7119,-134.0291"/>
</g>
<!-- sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~grid_field_param.f90</title>
<g id="a_sourcefile~~psolve.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/grid_field_param.f90.html" xlink:title="grid_field_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="554,-86 431,-86 431,-62 554,-62 554,-86"/>
<text text-anchor="middle" x="492.5" y="-71.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_field_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M589.6168,-74C581.5194,-74 572.8844,-74 564.2297,-74"/>
<polygon fill="#00ffff" stroke="#00ffff" points="564.0921,-70.5001 554.0921,-74 564.092,-77.5001 564.0921,-70.5001"/>
</g>
<!-- sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M179.9261,-24.1328C156.5699,-52.2625 98.5269,-122.1683 69.7386,-156.8404"/>
<polygon fill="#0000ff" stroke="#0000ff" points="66.784,-154.9198 63.0887,-164.8494 72.1696,-159.3915 66.784,-154.9198"/>
</g>
<!-- sourcefile~grid_param.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~grid_param.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M287.2211,-41.8603C282.272,-44.5302 277.7059,-47.8563 274,-52 225.699,-106.0073 281.7634,-153.2545 238,-211 235.7496,-213.9694 233.0584,-216.6399 230.1149,-219.0333"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="228.0996,-216.1716 221.8634,-224.7367 232.0797,-221.93 228.0996,-216.1716"/>
</g>
<!-- sourcefile~grid_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~grid_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M297.4185,-43.0187C289.6124,-45.7857 281.4792,-48.8478 274,-52 235.5367,-68.2109 229.2873,-79.9029 190,-94"/>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M190,-94C146.9643,-109.442 102.6982,-139.2845 76.5333,-158.6607"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="74.2678,-155.9852 68.3818,-164.7947 78.4767,-161.5785 74.2678,-155.9852"/>
</g>
<!-- sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M162.276,-224.8581C141.4782,-215.7496 112.7957,-203.1879 90.0347,-193.2196"/>
<polygon fill="#ff0000" stroke="#ff0000" points="91.2469,-189.9296 80.6828,-189.1238 88.4387,-196.3416 91.2469,-189.9296"/>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M454.2526,-144.5592C435.8869,-140.0259 413.4746,-134.4937 393.0276,-129.4467"/>
<polygon fill="#cbff00" stroke="#cbff00" points="393.7216,-126.013 383.1742,-127.0145 392.0441,-132.809 393.7216,-126.013"/>
</g>
<!-- sourcefile~mpi_var.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~mpi_var.f90</title>
<g id="a_sourcefile~~psolve.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/mpi_var.f90.html" xlink:title="mpi_var.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="372,-85 297,-85 297,-61 372,-61 372,-85"/>
<text text-anchor="middle" x="334.5" y="-70.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_var.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M475.5311,-141.9729C456.569,-128.9165 424.6306,-108.0537 395,-94 390.7055,-91.9631 386.1582,-90.0209 381.5622,-88.1986"/>
<polygon fill="#cbff00" stroke="#cbff00" points="382.7172,-84.8935 372.1255,-84.6344 380.2438,-91.442 382.7172,-84.8935"/>
</g>
<!-- sourcefile~util.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~util.f90</title>
<g id="a_sourcefile~~psolve.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/util.f90.html" xlink:title="util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="361.5,-169 307.5,-169 307.5,-145 361.5,-145 361.5,-169"/>
<text text-anchor="middle" x="334.5" y="-154.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M454.2526,-154.7262C429.1599,-155.2027 396.5135,-155.8225 371.6461,-156.2947"/>
<polygon fill="#cbff00" stroke="#cbff00" points="371.4414,-152.7979 361.5097,-156.4872 371.5743,-159.7966 371.4414,-152.7979"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M445.9494,-86.0796C428.6683,-90.5639 408.88,-95.6989 390.8196,-100.3854"/>
<polygon fill="#00ff66" stroke="#00ff66" points="389.791,-97.0363 380.9907,-102.936 391.5493,-103.8119 389.791,-97.0363"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M448.0677,-61.9077C429.569,-56.8732 407.9203,-50.9815 388.514,-45.7"/>
<polygon fill="#00ff66" stroke="#00ff66" points="389.1669,-42.2505 378.5988,-43.0016 387.3287,-49.0048 389.1669,-42.2505"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M430.9607,-73.6105C414.9091,-73.5089 397.8452,-73.4009 382.6029,-73.3044"/>
<polygon fill="#00ff66" stroke="#00ff66" points="382.3983,-69.8032 372.3763,-73.2397 382.3539,-76.803 382.3983,-69.8032"/>
</g>
<!-- sourcefile~modern_fft_lib.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~modern_fft_lib.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M436.4688,-196.4204C375.7463,-196.821 275.9971,-197.3193 190,-197"/>
</g>
<!-- sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M296.9908,-74.3551C267.2258,-76.3927 224.956,-81.4571 190,-94"/>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M307.9437,-169.0637C279.4092,-180.898 232.429,-197.1576 190,-197"/>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M190,-197C165.7117,-196.9098 139.2528,-193.7748 116.1208,-190.0128"/>
<polygon fill="#00ffff" stroke="#00ffff" points="116.5327,-186.5327 106.0879,-188.3092 115.3609,-193.4339 116.5327,-186.5327"/>
</g>
<!-- sourcefile~code_util.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~code_util.f90</title>
<g id="a_sourcefile~~psolve.f90~~EfferentGraph_node15"><a xlink:href=".././sourcefile/code_util.f90.html" xlink:title="code_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="230.5,-169 149.5,-169 149.5,-145 230.5,-145 230.5,-169"/>
<text text-anchor="middle" x="190" y="-154.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">code_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M307.3207,-157C288.6041,-157 263.1687,-157 240.7652,-157"/>
<polygon fill="#00ffff" stroke="#00ffff" points="240.7201,-153.5001 230.7201,-157 240.7201,-160.5001 240.7201,-153.5001"/>
</g>
<!-- sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~psolve.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M149.2664,-162.9465C138.8796,-164.4628 127.4675,-166.1288 116.2446,-167.7672"/>
<polygon fill="#ff0000" stroke="#ff0000" points="115.4155,-164.3511 106.026,-169.259 116.4267,-171.2776 115.4155,-164.3511"/>
</g>
</g>
</svg>
</div><script>var pansourcefilepsolvef90EfferentGraph = svgPanZoom('#sourcefilepsolvef90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~psolve.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilepsolvef90AfferentGraph" width="374pt" height="74pt"
 viewBox="0.00 0.00 374.00 74.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~psolve.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 70)">
<title>sourcefile~~psolve.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-70 370,-70 370,4 -4,4"/>
<!-- sourcefile~psolve.f90 -->
<g id="sourcefile~~psolve.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~psolve.f90</title>
<polygon fill="none" stroke="#000000" points="67,-45 0,-45 0,-21 67,-21 67,-45"/>
<text text-anchor="middle" x="33.5" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">psolve.f90</text>
</g>
<!-- sourcefile~pic_out_util.f90 -->
<g id="sourcefile~~psolve.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~pic_out_util.f90</title>
<g id="a_sourcefile~~psolve.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/pic_out_util.f90.html" xlink:title="pic_out_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="225,-66 132,-66 132,-42 225,-42 225,-66"/>
<text text-anchor="middle" x="178.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_out_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~psolve.f90 -->
<g id="sourcefile~~psolve.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~psolve.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M131.8229,-47.2399C114.4087,-44.7178 94.7081,-41.8646 77.5389,-39.378"/>
<polygon fill="#ff0000" stroke="#ff0000" points="77.6173,-35.853 67.2188,-37.8834 76.6139,-42.7807 77.6173,-35.853"/>
</g>
<!-- sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~psolve.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~init_beam_part_distrib.f90</title>
<g id="a_sourcefile~~psolve.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/init_beam_part_distrib.f90.html" xlink:title="init_beam_part_distrib.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="254,-24 103,-24 103,0 254,0 254,-24"/>
<text text-anchor="middle" x="178.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">init_beam_part_distrib.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~psolve.f90 -->
<g id="sourcefile~~psolve.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~psolve.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M102.6027,-22.992C93.8341,-24.262 85.1319,-25.5223 77.0107,-26.6984"/>
<polygon fill="#ff0000" stroke="#ff0000" points="76.4684,-23.2404 67.0733,-28.1377 77.4718,-30.1681 76.4684,-23.2404"/>
</g>
<!-- sourcefile~aladyn.f90 -->
<g id="sourcefile~~psolve.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~aladyn.f90</title>
<g id="a_sourcefile~~psolve.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/aladyn.f90.html" xlink:title="ALaDyn.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="366,-45 290,-45 290,-21 366,-21 366,-45"/>
<text text-anchor="middle" x="328" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALaDyn.F90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out_util.f90 -->
<g id="sourcefile~~psolve.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M289.888,-38.3535C273.2457,-40.6912 253.3843,-43.4811 235.0723,-46.0534"/>
<polygon fill="#ff0000" stroke="#ff0000" points="234.5046,-42.5987 225.0887,-47.4558 235.4783,-49.5306 234.5046,-42.5987"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~psolve.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~init_beam_part_distrib.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M289.888,-27.6465C281.9054,-26.5252 273.1823,-25.2999 264.2447,-24.0444"/>
<polygon fill="#00ffff" stroke="#00ffff" points="264.4806,-20.5433 254.0909,-22.6181 263.5068,-27.4752 264.4806,-20.5433"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/psolve.html">psolve</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/psolve.f90.html#src">psolve.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-2"></a><span class="c">!                            Copyright 2008-2020  The ALaDyn Collaboration                            !</span>
<a name="ln-3"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-4"></a>
<a name="ln-5"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-6"></a><span class="c">!  This file is part of ALaDyn.                                                                       !</span>
<a name="ln-7"></a><span class="c">!                                                                                                     !</span>
<a name="ln-8"></a><span class="c">!  ALaDyn is free software: you can redistribute it and/or modify                                     !</span>
<a name="ln-9"></a><span class="c">!  it under the terms of the GNU General Public License as published by                               !</span>
<a name="ln-10"></a><span class="c">!  the Free Software Foundation, either version 3 of the License, or                                  !</span>
<a name="ln-11"></a><span class="c">!  (at your option) any later version.                                                                !</span>
<a name="ln-12"></a><span class="c">!                                                                                                     !</span>
<a name="ln-13"></a><span class="c">!  ALaDyn is distributed in the hope that it will be useful,                                          !</span>
<a name="ln-14"></a><span class="c">!  but WITHOUT ANY WARRANTY; without even the implied warranty of                                     !</span>
<a name="ln-15"></a><span class="c">!  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                      !</span>
<a name="ln-16"></a><span class="c">!  GNU General Public License for more details.                                                       !</span>
<a name="ln-17"></a><span class="c">!                                                                                                     !</span>
<a name="ln-18"></a><span class="c">!  You should have received a copy of the GNU General Public License                                  !</span>
<a name="ln-19"></a><span class="c">!  along with ALaDyn.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                                    !</span>
<a name="ln-20"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-21"></a>
<a name="ln-22"></a> <span class="k">module </span><span class="n">psolve</span>
<a name="ln-23"></a>  <span class="k">use </span><span class="n">pstruct_data</span>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">fstruct_data</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">common_param</span>
<a name="ln-26"></a>  <span class="k">use </span><span class="n">grid_param</span>
<a name="ln-27"></a>  <span class="k">use </span><span class="n">prl_fft</span>
<a name="ln-28"></a>  <span class="k">use </span><span class="n">grid_fields</span>
<a name="ln-29"></a>
<a name="ln-30"></a>  <span class="k">implicit none</span>
<a name="ln-31"></a><span class="k">  private</span>
<a name="ln-32"></a><span class="k">  public</span> <span class="kd">::</span> <span class="n">fft_3d_psolv</span><span class="p">,</span> <span class="n">fft_2d_psolv</span>
<a name="ln-33"></a>
<a name="ln-34"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">wb</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="n">wa</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-35"></a>  <span class="c">!==========================</span>
<a name="ln-36"></a>
<a name="ln-37"></a> <span class="k">contains</span>
<a name="ln-38"></a>
<a name="ln-39"></a><span class="k">  subroutine </span><span class="n">beam_2d_potential</span><span class="p">(</span><span class="n">poten</span><span class="p">,</span> <span class="n">nxf_in</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span>
<a name="ln-40"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">poten</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-41"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nxf_in</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="n">ft_ind</span>
<a name="ln-42"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ak2p</span>
<a name="ln-43"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iy1</span><span class="p">,</span> <span class="n">iz</span><span class="p">,</span> <span class="n">iz1</span>
<a name="ln-44"></a>   <span class="c">!_________________________________</span>
<a name="ln-45"></a>   <span class="c">! Laplacian(y,z)(poten)=-rho =&gt;  [k^2_y+k^2_z][poten(ky,kz)]=rho[ky,kz]</span>
<a name="ln-46"></a>   <span class="c">! Solves Poisson equation in Fourier space</span>
<a name="ln-47"></a>   <span class="c">! ft_ind &gt;1  sin/cosine transform</span>
<a name="ln-48"></a>   <span class="c">! ft_mod=0,1   periodic fft</span>
<a name="ln-49"></a>   <span class="k">do </span><span class="n">iz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n3_loc</span>
<a name="ln-50"></a>    <span class="n">iz1</span> <span class="o">=</span> <span class="n">iz</span> <span class="o">+</span> <span class="n">imodz</span><span class="o">*</span><span class="n">n3_loc</span>
<a name="ln-51"></a>    <span class="k">do </span><span class="n">iy</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n2_loc</span>
<a name="ln-52"></a>     <span class="n">iy1</span> <span class="o">=</span> <span class="n">iy</span> <span class="o">+</span> <span class="n">imody</span><span class="o">*</span><span class="n">n2_loc</span>
<a name="ln-53"></a>     <span class="n">ak2p</span> <span class="o">=</span> <span class="n">skz</span><span class="p">(</span><span class="n">iz1</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span><span class="o">*</span><span class="n">skz</span><span class="p">(</span><span class="n">iz1</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span> <span class="o">+</span> <span class="n">sky</span><span class="p">(</span><span class="n">iy1</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span><span class="o">*</span><span class="n">sky</span><span class="p">(</span><span class="n">iy1</span> <span class="p">&amp;</span>
<a name="ln-54"></a>                                                                     <span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span>
<a name="ln-55"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">ak2p</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-56"></a><span class="k">      do </span><span class="n">ix</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nxf_in</span>
<a name="ln-57"></a>       <span class="n">poten</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">)</span> <span class="o">=</span> <span class="n">poten</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">)</span><span class="o">/</span><span class="n">ak2p</span> <span class="c">!poten</span>
<a name="ln-58"></a>      <span class="k">end do</span>
<a name="ln-59"></a><span class="k">     else</span>
<a name="ln-60"></a><span class="k">      </span><span class="n">poten</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nxf_in</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-61"></a>     <span class="k">end if</span>
<a name="ln-62"></a><span class="k">    end do</span>
<a name="ln-63"></a><span class="k">   end do</span>
<a name="ln-64"></a><span class="k">  end subroutine</span>
<a name="ln-65"></a>  <span class="c">!==========================</span>
<a name="ln-66"></a>  <span class="k">subroutine </span><span class="n">beam_potential</span><span class="p">(</span><span class="n">poten</span><span class="p">,</span> <span class="n">gam2</span><span class="p">,</span> <span class="n">nxf_in</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span>
<a name="ln-67"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">poten</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-68"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gam2</span>
<a name="ln-69"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nxf_in</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="n">ft_ind</span>
<a name="ln-70"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ak2</span><span class="p">,</span> <span class="n">ak2p</span>
<a name="ln-71"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iy1</span><span class="p">,</span> <span class="n">iz</span><span class="p">,</span> <span class="n">iz1</span>
<a name="ln-72"></a>   <span class="c">!_________________________________</span>
<a name="ln-73"></a>   <span class="c">! ft_ind=0,1 solves Poisson equation in Fourier space (kx/gam,ky,kz)</span>
<a name="ln-74"></a>   <span class="c">! ft_ind=2 solves Poisson equation in sin/cosine Fourier space (kx/gam,ky,kz)</span>
<a name="ln-75"></a>   <span class="c">! Laplacian(poten)=-rho =&gt;  K^2[poten(kx,ky,kz]=rho[kx,ky,kz]</span>
<a name="ln-76"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">n3_loc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-77"></a><span class="k">    </span><span class="n">iz</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-78"></a>    <span class="k">do </span><span class="n">iy</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n2_loc</span>
<a name="ln-79"></a>     <span class="n">iy1</span> <span class="o">=</span> <span class="n">iy</span> <span class="o">+</span> <span class="n">imody</span><span class="o">*</span><span class="n">n2_loc</span>
<a name="ln-80"></a>     <span class="n">ak2p</span> <span class="o">=</span> <span class="n">sky</span><span class="p">(</span><span class="n">iy1</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span><span class="o">*</span><span class="n">sky</span><span class="p">(</span><span class="n">iy1</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span>
<a name="ln-81"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">ak2p</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-82"></a><span class="k">      do </span><span class="n">ix</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nxf_in</span>
<a name="ln-83"></a>       <span class="n">ak2</span> <span class="o">=</span> <span class="n">ak2p</span> <span class="o">+</span> <span class="n">skx</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span><span class="o">*</span><span class="n">skx</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span><span class="o">/</span><span class="n">gam2</span>
<a name="ln-84"></a>       <span class="n">poten</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">)</span> <span class="o">=</span> <span class="n">poten</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">)</span><span class="o">/</span><span class="n">ak2</span> <span class="c">!pot_b</span>
<a name="ln-85"></a>      <span class="k">end do</span>
<a name="ln-86"></a><span class="k">     else</span>
<a name="ln-87"></a><span class="k">      do </span><span class="n">ix</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nxf_in</span>
<a name="ln-88"></a>       <span class="n">ak2</span> <span class="o">=</span> <span class="n">skx</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span><span class="o">*</span><span class="n">skx</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span><span class="o">/</span><span class="n">gam2</span>
<a name="ln-89"></a>       <span class="n">poten</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">)</span> <span class="o">=</span> <span class="n">poten</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">)</span><span class="o">/</span><span class="n">ak2</span> <span class="c">!pot_b</span>
<a name="ln-90"></a>      <span class="k">end do</span>
<a name="ln-91"></a><span class="k">     end if</span>
<a name="ln-92"></a><span class="k">    end do</span>
<a name="ln-93"></a><span class="k">   else</span>
<a name="ln-94"></a><span class="k">    do </span><span class="n">iz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n3_loc</span>
<a name="ln-95"></a>     <span class="n">iz1</span> <span class="o">=</span> <span class="n">iz</span> <span class="o">+</span> <span class="n">imodz</span><span class="o">*</span><span class="n">n3_loc</span>
<a name="ln-96"></a>     <span class="k">do </span><span class="n">iy</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n2_loc</span>
<a name="ln-97"></a>      <span class="n">iy1</span> <span class="o">=</span> <span class="n">iy</span> <span class="o">+</span> <span class="n">imody</span><span class="o">*</span><span class="n">n2_loc</span>
<a name="ln-98"></a>      <span class="n">ak2p</span> <span class="o">=</span> <span class="n">skz</span><span class="p">(</span><span class="n">iz1</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span><span class="o">*</span><span class="n">skz</span><span class="p">(</span><span class="n">iz1</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-99"></a>             <span class="n">sky</span><span class="p">(</span><span class="n">iy1</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span><span class="o">*</span><span class="n">sky</span><span class="p">(</span><span class="n">iy1</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span>
<a name="ln-100"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ak2p</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-101"></a><span class="k">       do </span><span class="n">ix</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nxf_in</span>
<a name="ln-102"></a>        <span class="n">ak2</span> <span class="o">=</span> <span class="n">ak2p</span> <span class="o">+</span> <span class="n">skx</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span><span class="o">*</span><span class="n">skx</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span><span class="o">/</span><span class="n">gam2</span>
<a name="ln-103"></a>        <span class="n">poten</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">)</span> <span class="o">=</span> <span class="n">poten</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">)</span><span class="o">/</span><span class="n">ak2</span> <span class="c">!pot_b</span>
<a name="ln-104"></a>       <span class="k">end do</span>
<a name="ln-105"></a><span class="k">      else</span>
<a name="ln-106"></a><span class="k">       do </span><span class="n">ix</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nxf_in</span>
<a name="ln-107"></a>        <span class="n">ak2</span> <span class="o">=</span> <span class="n">skx</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span><span class="o">*</span><span class="n">skx</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">ft_ind</span><span class="p">)</span><span class="o">/</span><span class="n">gam2</span>
<a name="ln-108"></a>        <span class="n">poten</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">)</span> <span class="o">=</span> <span class="n">poten</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">)</span><span class="o">/</span><span class="n">ak2</span> <span class="c">!pot_b</span>
<a name="ln-109"></a>       <span class="k">end do</span>
<a name="ln-110"></a><span class="k">      end if</span>
<a name="ln-111"></a><span class="k">     end do</span>
<a name="ln-112"></a><span class="k">    end do</span>
<a name="ln-113"></a><span class="k">   end if</span>
<a name="ln-114"></a>   <span class="c">!=================</span>
<a name="ln-115"></a>  <span class="k">end subroutine</span>
<a name="ln-116"></a>  <span class="c">!===============================================</span>
<a name="ln-117"></a>  <span class="k">subroutine </span><span class="n">fft_3d_psolv</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">pot1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">omp0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n1_loc</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-118"></a>                          <span class="n">n3_loc</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">s_ind</span><span class="p">)</span>
<a name="ln-119"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rho</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="n">pot1</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-120"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">g2</span><span class="p">,</span> <span class="n">omp0</span>
<a name="ln-121"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n1_loc</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">s_ind</span>
<a name="ln-122"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span>
<a name="ln-123"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-124"></a>   <span class="c">! ft_mod=0,1 for standard fft in periodic BC</span>
<a name="ln-125"></a>   <span class="c">! ft_mod=2  for sin(sym=1) cos(sym=2) transforms</span>
<a name="ln-126"></a>   <span class="c">! In rho(1) enters charge density rho(x,y,z)=q*n(x,y,z)</span>
<a name="ln-127"></a>   <span class="c">! In rho(1) exit pot(x,y,z)</span>
<a name="ln-128"></a>   <span class="c">!===========================</span>
<a name="ln-129"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">wb</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">))</span>
<a name="ln-130"></a>   <span class="k">call </span><span class="n">mpi_ftw_alloc</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">)</span>
<a name="ln-131"></a>   <span class="k">call </span><span class="n">ftw_init</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">)</span> <span class="c">!set wavenumber grid</span>
<a name="ln-132"></a>   <span class="n">wb</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-133"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prlx</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-134"></a><span class="k">    do </span><span class="n">k</span> <span class="o">=</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span>
<a name="ln-135"></a>     <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span>
<a name="ln-136"></a>      <span class="n">aux1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-137"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span>
<a name="ln-138"></a>       <span class="n">ii</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-139"></a>       <span class="n">aux1</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="o">=</span> <span class="n">rho</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-140"></a>      <span class="k">end do</span>
<a name="ln-141"></a><span class="k">      call </span><span class="n">all_gather_dpreal</span><span class="p">(</span><span class="n">aux1</span><span class="p">,</span> <span class="n">aux2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">n1_loc</span><span class="p">)</span>
<a name="ln-142"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n1</span>
<a name="ln-143"></a>       <span class="n">wb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">aux2</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-144"></a>      <span class="k">end do</span>
<a name="ln-145"></a><span class="k">     end do</span>
<a name="ln-146"></a><span class="k">    end do</span>
<a name="ln-147"></a><span class="k">   else</span>
<a name="ln-148"></a><span class="k">    </span><span class="n">wb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n2_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n3_loc</span><span class="p">)</span> <span class="o">=</span> <span class="n">rho</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">:</span><span class="n">k2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-149"></a>   <span class="k">end if</span>
<a name="ln-150"></a><span class="k">   if</span> <span class="p">(</span><span class="n">ft_mod</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-151"></a><span class="k">    call </span><span class="n">pftw3d_sc</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
<a name="ln-152"></a>    <span class="n">wb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n1_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n2_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n3_loc</span><span class="p">)</span> <span class="o">=</span> <span class="n">omp0</span><span class="o">*</span><span class="n">wb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n1_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n2_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n3_loc</span><span class="p">)</span>
<a name="ln-153"></a>    <span class="c">!==========================</span>
<a name="ln-154"></a>    <span class="k">call </span><span class="n">beam_potential</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">)</span>
<a name="ln-155"></a>    <span class="c">!exit sin/cos fourier components for beam potential</span>
<a name="ln-156"></a>    <span class="k">call </span><span class="n">pftw3d_sc</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
<a name="ln-157"></a>   <span class="k">else</span>
<a name="ln-158"></a><span class="k">    call </span><span class="n">pftw3d</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-159"></a>    <span class="n">wb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n2_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n3_loc</span><span class="p">)</span> <span class="o">=</span> <span class="n">omp0</span><span class="o">*</span><span class="n">wb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n2_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n3_loc</span><span class="p">)</span>
<a name="ln-160"></a>    <span class="c">!==========================</span>
<a name="ln-161"></a>    <span class="k">call </span><span class="n">beam_potential</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">)</span>
<a name="ln-162"></a>    <span class="c">!exit fourier components for beam potential</span>
<a name="ln-163"></a>    <span class="k">call </span><span class="n">pftw3d</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-164"></a>   <span class="k">end if</span>
<a name="ln-165"></a><span class="k">   call </span><span class="n">mpi_ftw_dalloc</span>
<a name="ln-166"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">s_ind</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-167"></a>    <span class="c">!Two new routines added</span>
<a name="ln-168"></a>    <span class="k">allocate</span> <span class="p">(</span><span class="n">wa</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">n2_loc</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">n3_loc</span><span class="p">))</span>
<a name="ln-169"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">fp1</span><span class="p">))</span> <span class="k">allocate</span> <span class="p">(</span><span class="n">fp1</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">))</span>
<a name="ln-170"></a>    <span class="k">call </span><span class="n">mpi_yzft_ord</span><span class="p">(</span><span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">)</span>
<a name="ln-171"></a>    <span class="k">call </span><span class="n">ft_overset_grid</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">wa</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">)</span>    <span class="c">!in fft/prl_fft  module</span>
<a name="ln-172"></a>    <span class="k">call </span><span class="n">unif_to_str_field_interp</span><span class="p">(</span><span class="n">wa</span><span class="p">,</span> <span class="n">pot1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>           <span class="c">!put data in in fields/grid_fields module</span>
<a name="ln-173"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">wa</span><span class="p">))</span> <span class="k">deallocate</span> <span class="p">(</span><span class="n">wa</span><span class="p">)</span>
<a name="ln-174"></a>    <span class="k">deallocate</span> <span class="p">(</span><span class="n">fp1</span><span class="p">)</span>
<a name="ln-175"></a>   <span class="k">else</span>
<a name="ln-176"></a><span class="k">    </span><span class="n">rho</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">:</span><span class="n">k2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">wb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n2_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n3_loc</span><span class="p">)</span>
<a name="ln-177"></a>   <span class="k">end if</span>
<a name="ln-178"></a>   <span class="c">!EXIT rho(1) 3D beam potential</span>
<a name="ln-179"></a>   <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">wb</span><span class="p">))</span> <span class="k">deallocate</span> <span class="p">(</span><span class="n">wb</span><span class="p">)</span>
<a name="ln-180"></a>   <span class="k">call </span><span class="n">ftw_end</span>
<a name="ln-181"></a>  <span class="k">end subroutine</span>
<a name="ln-182"></a>  <span class="c">!===============================</span>
<a name="ln-183"></a>  <span class="k">subroutine </span><span class="n">fft_2d_psolv</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">pot1</span><span class="p">,</span> <span class="n">omp0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n1_loc</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-184"></a>                          <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">sind</span><span class="p">)</span>
<a name="ln-185"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rho</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="n">pot1</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-186"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">omp0</span>
<a name="ln-187"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n1_loc</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n3_loc</span>
<a name="ln-188"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">sind</span>
<a name="ln-189"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span>
<a name="ln-190"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-191"></a>
<a name="ln-192"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">wb</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">))</span>
<a name="ln-193"></a>   <span class="k">call </span><span class="n">mpi_ftw_alloc</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">)</span>
<a name="ln-194"></a>   <span class="k">call </span><span class="n">ftw_init</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">)</span>
<a name="ln-195"></a>
<a name="ln-196"></a>   <span class="n">wb</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-197"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prlx</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-198"></a><span class="k">    do </span><span class="n">k</span> <span class="o">=</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span>
<a name="ln-199"></a>     <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span>
<a name="ln-200"></a>      <span class="n">aux1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-201"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span>
<a name="ln-202"></a>       <span class="n">ii</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-203"></a>       <span class="n">aux1</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="o">=</span> <span class="n">rho</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-204"></a>      <span class="k">end do</span>
<a name="ln-205"></a><span class="k">      call </span><span class="n">all_gather_dpreal</span><span class="p">(</span><span class="n">aux1</span><span class="p">,</span> <span class="n">aux2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">n1_loc</span><span class="p">)</span>
<a name="ln-206"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n1</span>
<a name="ln-207"></a>       <span class="n">wb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">aux2</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-208"></a>      <span class="k">end do</span>
<a name="ln-209"></a><span class="k">     end do</span>
<a name="ln-210"></a><span class="k">    end do</span>
<a name="ln-211"></a><span class="k">   else</span>
<a name="ln-212"></a><span class="k">    </span><span class="n">wb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n2_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n3_loc</span><span class="p">)</span> <span class="o">=</span> <span class="n">rho</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">:</span><span class="n">k2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-213"></a>   <span class="k">end if</span>
<a name="ln-214"></a><span class="k">   if</span> <span class="p">(</span><span class="n">ft_mod</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-215"></a>    <span class="c">!sin/cosine transform</span>
<a name="ln-216"></a>    <span class="k">call </span><span class="n">pftw2d_sc</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
<a name="ln-217"></a>    <span class="n">wb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n2_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n3_loc</span><span class="p">)</span> <span class="o">=</span> <span class="n">omp0</span><span class="o">*</span><span class="n">wb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n2_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n3_loc</span><span class="p">)</span>
<a name="ln-218"></a>    <span class="c">!==========================</span>
<a name="ln-219"></a>    <span class="k">call </span><span class="n">beam_2d_potential</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">)</span>
<a name="ln-220"></a>    <span class="c">!exit fourier components for potential</span>
<a name="ln-221"></a>    <span class="k">call </span><span class="n">pftw2d_sc</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
<a name="ln-222"></a>   <span class="k">else</span>
<a name="ln-223"></a>    <span class="c">!periodic fft transform</span>
<a name="ln-224"></a>    <span class="k">call </span><span class="n">pftw2d</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-225"></a>    <span class="n">wb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n2_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n3_loc</span><span class="p">)</span> <span class="o">=</span> <span class="n">omp0</span><span class="o">*</span><span class="n">wb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n2_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n3_loc</span><span class="p">)</span>
<a name="ln-226"></a>    <span class="c">!==========================</span>
<a name="ln-227"></a>    <span class="k">call </span><span class="n">beam_2d_potential</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">)</span>
<a name="ln-228"></a>    <span class="c">!exit fourier components for potential</span>
<a name="ln-229"></a>    <span class="k">call </span><span class="n">pftw2d</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-230"></a>   <span class="k">end if</span>
<a name="ln-231"></a><span class="k">   call </span><span class="n">mpi_ftw_dalloc</span>
<a name="ln-232"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sind</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-233"></a>    <span class="c">!Two new routines added</span>
<a name="ln-234"></a>    <span class="k">allocate</span> <span class="p">(</span><span class="n">wa</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">))</span>
<a name="ln-235"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">fp1</span><span class="p">))</span> <span class="k">allocate</span> <span class="p">(</span><span class="n">fp1</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">))</span>
<a name="ln-236"></a>    <span class="k">call </span><span class="n">mpi_yzft_ord</span><span class="p">(</span><span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">)</span>
<a name="ln-237"></a>    <span class="k">call </span><span class="n">ft_overset_grid</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">wa</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">)</span>    <span class="c">!in fft/prl_fft  module</span>
<a name="ln-238"></a>    <span class="k">call </span><span class="n">unif_to_str_field_interp</span><span class="p">(</span><span class="n">wa</span><span class="p">,</span> <span class="n">pot1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>           <span class="c">!in fields/grid_fields module</span>
<a name="ln-239"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">wa</span><span class="p">))</span> <span class="k">deallocate</span> <span class="p">(</span><span class="n">wa</span><span class="p">)</span>
<a name="ln-240"></a>    <span class="k">deallocate</span> <span class="p">(</span><span class="n">fp1</span><span class="p">)</span>
<a name="ln-241"></a>   <span class="k">else</span>
<a name="ln-242"></a><span class="k">    </span><span class="n">rho</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">:</span><span class="n">k2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">wb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n2_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">n3_loc</span><span class="p">)</span>
<a name="ln-243"></a>   <span class="k">end if</span>
<a name="ln-244"></a>   <span class="c">!EXIT rho(1) 2D beam potential</span>
<a name="ln-245"></a>   <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">wb</span><span class="p">))</span> <span class="k">deallocate</span> <span class="p">(</span><span class="n">wb</span><span class="p">)</span>
<a name="ln-246"></a>   <span class="k">call </span><span class="n">ftw_end</span>
<a name="ln-247"></a>  <span class="k">end subroutine</span>
<a name="ln-248"></a>  <span class="c">!==========================</span>
<a name="ln-249"></a> <span class="k">end module</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-07-30 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> ALaDyn was developed by The ALaDyn Collaboration</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>