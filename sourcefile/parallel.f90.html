<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A High-Accuracy PIC Code for the Maxwell-Vlasov Equations">
    
    <meta name="author" content="The ALaDyn Collaboration" >
    <link rel="icon" href="../favicon.png">

    <title>parallel.F90 &ndash; ALaDyn</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">ALaDyn <small>3.0.1</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Guide</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/aladyn.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/aladyn.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>parallel.F90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 2.9% of total for source files.">724 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/parallel.F90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">parallel.F90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/parallel.html">parallel</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/parallel.f90.html#src">parallel.F90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~parallel.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefileparallelf90EfferentGraph" width="500pt" height="126pt"
 viewBox="0.00 0.00 500.00 125.78" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~parallel.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 121.7766)">
<title>sourcefile~~parallel.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-121.7766 496,-121.7766 496,4 -4,4"/>
<!-- sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~parallel.f90</title>
<polygon fill="none" stroke="#000000" points="492,-77.7766 416,-77.7766 416,-53.7766 492,-53.7766 492,-77.7766"/>
<text text-anchor="middle" x="454" y="-63.3766" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">parallel.F90</text>
</g>
<!-- sourcefile~mpi_var.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~mpi_var.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/mpi_var.f90.html" xlink:title="mpi_var.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="220,-117.7766 145,-117.7766 145,-93.7766 220,-93.7766 220,-117.7766"/>
<text text-anchor="middle" x="182.5" y="-103.3766" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_var.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M416.6674,-77.789C405.0266,-81.1501 392.0738,-84.502 380,-86.7766 329.397,-96.3099 270.5482,-101.1881 230.3382,-103.5972"/>
<polygon fill="#ff0000" stroke="#ff0000" points="230.0631,-100.1071 220.279,-104.1716 230.4623,-107.0957 230.0631,-100.1071"/>
</g>
<!-- sourcefile~common_param.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~common_param.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/common_param.f90.html" xlink:title="common_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="380,-77.7766 259,-77.7766 259,-53.7766 380,-53.7766 380,-77.7766"/>
<text text-anchor="middle" x="319.5" y="-63.3766" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">common_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M415.8175,-65.7766C407.835,-65.7766 399.176,-65.7766 390.4338,-65.7766"/>
<polygon fill="#ff0000" stroke="#ff0000" points="390.1684,-62.2767 380.1684,-65.7766 390.1684,-69.2767 390.1684,-62.2767"/>
</g>
<!-- sourcefile~util.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~util.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/util.f90.html" xlink:title="util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="346.5,-35.7766 292.5,-35.7766 292.5,-11.7766 346.5,-11.7766 346.5,-35.7766"/>
<text text-anchor="middle" x="319.5" y="-21.3766" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M415.8175,-53.8534C397.121,-48.0152 374.7129,-41.0178 356.2167,-35.2421"/>
<polygon fill="#ff0000" stroke="#ff0000" points="357.2562,-31.9 346.6675,-32.2601 355.1696,-38.5818 357.2562,-31.9"/>
</g>
<!-- sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~precision_def.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/precision_def.f90.html" xlink:title="precision_def.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="106,-57.7766 0,-57.7766 0,-33.7766 106,-33.7766 106,-57.7766"/>
<text text-anchor="middle" x="53" y="-43.3766" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">precision_def.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M156.2937,-93.6347C136.7223,-84.5669 109.7641,-72.0766 88.2957,-62.1298"/>
<polygon fill="#ff0000" stroke="#ff0000" points="89.7121,-58.9287 79.1673,-57.9005 86.7693,-65.2801 89.7121,-58.9287"/>
</g>
<!-- sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M258.6936,-61.2133C216.1695,-58.022 159.5031,-53.7693 116.4157,-50.5358"/>
<polygon fill="#00ff00" stroke="#00ff00" points="116.563,-47.0371 106.3291,-49.7788 116.0391,-54.0174 116.563,-47.0371"/>
</g>
<!-- sourcefile~code_util.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~code_util.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/code_util.f90.html" xlink:title="code_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="223,-37.7766 142,-37.7766 142,-13.7766 223,-13.7766 223,-37.7766"/>
<text text-anchor="middle" x="182.5" y="-23.3766" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">code_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M292.4332,-24.1718C275.5663,-24.418 253.3308,-24.7426 233.2729,-25.0354"/>
<polygon fill="#0000ff" stroke="#0000ff" points="232.9702,-21.5394 223.0224,-25.185 233.0725,-28.5386 232.9702,-21.5394"/>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M292.4431,-15.5406C257.383,-6.0811 194.5234,6.7398 142,-4.7766 120.6882,-9.4495 98.3929,-19.7305 81.4482,-28.8277"/>
<polygon fill="#0000ff" stroke="#0000ff" points="79.6756,-25.8084 72.6252,-33.7168 83.0685,-31.9312 79.6756,-25.8084"/>
</g>
<!-- sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M141.8807,-32.0499C133.777,-33.3014 125.0848,-34.6438 116.4242,-35.9814"/>
<polygon fill="#ff0000" stroke="#ff0000" points="115.6578,-32.5582 106.3092,-37.5435 116.7263,-39.4761 115.6578,-32.5582"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~parallel.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileparallelf90AfferentGraph" width="641pt" height="355pt"
 viewBox="0.00 0.00 641.00 354.70" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~parallel.f90~~AfferentGraph" class="graph" transform="scale(.7036 .7036) rotate(0) translate(4 500.1045)">
<title>sourcefile~~parallel.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-500.1045 907,-500.1045 907,4 -4,4"/>
<!-- sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~parallel.f90</title>
<polygon fill="none" stroke="#000000" points="76,-298.4639 0,-298.4639 0,-274.4639 76,-274.4639 76,-298.4639"/>
<text text-anchor="middle" x="38" y="-284.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">parallel.F90</text>
</g>
<!-- sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~mpi_curr_interface.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/mpi_curr_interface.f90.html" xlink:title="mpi_curr_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="424,-380.4639 291,-380.4639 291,-356.4639 424,-356.4639 424,-380.4639"/>
<text text-anchor="middle" x="357.5" y="-366.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_curr_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M290.815,-362.9445C258.1271,-359.6039 218.2948,-354.5857 183,-347.4639"/>
</g>
<!-- sourcefile~diag_part_and_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~diag_part_and_fields.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/diag_part_and_fields.f90.html" xlink:title="diag_part_and_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="254,-457.4639 112,-457.4639 112,-433.4639 254,-433.4639 254,-457.4639"/>
<text text-anchor="middle" x="183" y="-443.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">diag_part_and_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~diag_part_and_fields.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~diag_part_and_fields.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M135.3473,-433.3742C126.9772,-429.8148 118.7865,-425.2623 112,-419.4639 76.5734,-389.1953 54.8402,-337.5182 44.7453,-308.2894"/>
<polygon fill="#ff0000" stroke="#ff0000" points="48.0101,-307.0144 41.5488,-298.6178 41.3637,-309.211 48.0101,-307.0144"/>
</g>
<!-- sourcefile~run_data_info.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~run_data_info.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/run_data_info.f90.html" xlink:title="run_data_info.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="410.5,-197.4639 304.5,-197.4639 304.5,-173.4639 410.5,-173.4639 410.5,-197.4639"/>
<text text-anchor="middle" x="357.5" y="-183.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">run_data_info.f90</text>
</a>
</g>
</g>
<!-- sourcefile~run_data_info.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~run_data_info.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M305.4638,-197.5026C270.7121,-205.6618 224.0278,-216.8521 183,-227.4639"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M183,-227.4639C143.2855,-237.7361 99.9963,-256.4053 71.1535,-269.999"/>
<polygon fill="#ff0000" stroke="#ff0000" points="69.4663,-266.926 61.9519,-274.3949 72.4839,-273.2423 69.4663,-266.926"/>
</g>
<!-- sourcefile~prl_fft.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~prl_fft.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node5"><a xlink:href=".././sourcefile/prl_fft.f90.html" xlink:title="prl_fft.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="215,-410.4639 151,-410.4639 151,-386.4639 215,-386.4639 215,-410.4639"/>
<text text-anchor="middle" x="183" y="-396.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">prl_fft.f90</text>
</a>
</g>
</g>
<!-- sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M155.1926,-386.4602C141.5812,-379.9782 125.3041,-371.2922 112,-361.4639 90.0747,-345.2668 68.5997,-322.5121 54.4805,-306.3231"/>
<polygon fill="#ff0000" stroke="#ff0000" points="56.9665,-303.8451 47.8041,-298.5253 51.6492,-308.3978 56.9665,-303.8451"/>
</g>
<!-- sourcefile~pic_dump.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node6" class="node">
<title>sourcefile~pic_dump.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node6"><a xlink:href=".././sourcefile/pic_dump.f90.html" xlink:title="pic_dump.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="225.5,-165.4639 140.5,-165.4639 140.5,-141.4639 225.5,-141.4639 225.5,-165.4639"/>
<text text-anchor="middle" x="183" y="-151.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_dump.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_dump.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~pic_dump.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M168.0294,-165.5504C153.4606,-177.4434 130.828,-196.2684 112,-213.4639 92.7095,-231.0818 71.5725,-252.1181 56.8461,-267.0728"/>
<polygon fill="#ff0000" stroke="#ff0000" points="54.2738,-264.6971 49.7732,-274.2885 59.2727,-269.5971 54.2738,-264.6971"/>
</g>
<!-- sourcefile~mpi_part_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node7" class="node">
<title>sourcefile~mpi_part_interface.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node7"><a xlink:href=".././sourcefile/mpi_part_interface.f90.html" xlink:title="mpi_part_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="424,-239.4639 291,-239.4639 291,-215.4639 424,-215.4639 424,-239.4639"/>
<text text-anchor="middle" x="357.5" y="-225.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_part_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_part_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~mpi_part_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M290.6343,-219.6838C257.7252,-217.8071 217.756,-218.4743 183,-227.4639"/>
</g>
<!-- sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node8" class="node">
<title>sourcefile~grid_fields.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node8"><a xlink:href=".././sourcefile/grid_fields.f90.html" xlink:title="grid_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="227,-298.4639 139,-298.4639 139,-274.4639 227,-274.4639 227,-298.4639"/>
<text text-anchor="middle" x="183" y="-284.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge7" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M138.7073,-286.4639C122.1545,-286.4639 103.2775,-286.4639 86.375,-286.4639"/>
<polygon fill="#ff0000" stroke="#ff0000" points="86.1445,-282.964 76.1444,-286.4639 86.1444,-289.964 86.1445,-282.964"/>
</g>
<!-- sourcefile~pic_out.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node9" class="node">
<title>sourcefile~pic_out.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node9"><a xlink:href=".././sourcefile/pic_out.f90.html" xlink:title="pic_out.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="218.5,-55.4639 147.5,-55.4639 147.5,-31.4639 218.5,-31.4639 218.5,-55.4639"/>
<text text-anchor="middle" x="183" y="-41.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_out.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge8" class="edge">
<title>sourcefile~pic_out.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M171.9521,-55.4746C157.1199,-71.9838 130.4981,-103.0019 112,-132.4639 83.9225,-177.1831 59.1121,-234.1731 46.6014,-264.746"/>
<polygon fill="#ff0000" stroke="#ff0000" points="43.204,-263.8118 42.7039,-274.3948 49.6945,-266.4336 43.204,-263.8118"/>
</g>
<!-- sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node10" class="node">
<title>sourcefile~mpi_field_interface.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node10"><a xlink:href=".././sourcefile/mpi_field_interface.f90.html" xlink:title="mpi_field_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="425,-338.4639 290,-338.4639 290,-314.4639 425,-314.4639 425,-338.4639"/>
<text text-anchor="middle" x="357.5" y="-324.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_field_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge9" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M317.3621,-338.4994C281.8067,-347.4541 228.6141,-356.668 183,-347.4639"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M183,-347.4639C141.39,-339.0678 96.8557,-318.3808 68.2868,-303.4226"/>
<polygon fill="#ff0000" stroke="#ff0000" points="69.708,-300.214 59.2375,-298.5955 66.4134,-306.3902 69.708,-300.214"/>
</g>
<!-- sourcefile~curr_and_fields_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node11" class="node">
<title>sourcefile~curr_and_fields_util.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node11"><a xlink:href=".././sourcefile/curr_and_fields_util.f90.html" xlink:title="curr_and_fields_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="607.5,-339.4639 471.5,-339.4639 471.5,-315.4639 607.5,-315.4639 607.5,-339.4639"/>
<text text-anchor="middle" x="539.5" y="-325.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">curr_and_fields_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge11" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M485.8784,-339.5435C465.5116,-344.1316 442.1214,-349.4008 420.933,-354.1741"/>
<polygon fill="#ff0000" stroke="#ff0000" points="420.0389,-350.7877 411.0526,-356.3999 421.5773,-357.6166 420.0389,-350.7877"/>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge24" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M494.0846,-315.4128C449.2132,-303.8374 383.615,-287.8945 357.5,-286.4639"/>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge27" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M471.4711,-327.0901C459.6392,-327.0251 447.2529,-326.9571 435.1858,-326.8908"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="435.1629,-323.3907 425.1438,-326.8356 435.1244,-330.3906 435.1629,-323.3907"/>
</g>
<!-- sourcefile~pic_evolve_in_time.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node12" class="node">
<title>sourcefile~pic_evolve_in_time.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node12"><a xlink:href=".././sourcefile/pic_evolve_in_time.f90.html" xlink:title="pic_evolve_in_time.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="789,-216.4639 656,-216.4639 656,-192.4639 789,-192.4639 789,-216.4639"/>
<text text-anchor="middle" x="722.5" y="-202.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_evolve_in_time.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~mpi_part_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge19" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~mpi_part_interface.f90</title>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M680.4051,-192.4524C627.9829,-179.4776 536.1684,-163.3141 461,-184.4639 442.9498,-189.5426 442.0824,-198.731 425,-206.4639 420.6186,-208.4473 415.9969,-210.3155 411.3112,-212.0574"/>
<polygon fill="#00a9ff" stroke="#00a9ff" points="409.9319,-208.8323 401.6595,-215.4518 412.2543,-215.4358 409.9319,-208.8323"/>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge32" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M667.4629,-216.5191C662.5945,-218.9691 658.0034,-221.917 654,-225.4639 624.5131,-251.5891 647.9533,-280.8749 618,-306.4639 616.4715,-307.7697 614.8699,-308.9952 613.2081,-310.1453"/>
<polygon fill="#ff0000" stroke="#ff0000" points="611.304,-307.2047 604.4572,-315.29 614.8517,-313.2391 611.304,-307.2047"/>
</g>
<!-- sourcefile~window.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node16" class="node">
<title>sourcefile~window.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node16"><a xlink:href=".././sourcefile/window.f90.html" xlink:title="window.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="575.5,-217.4639 503.5,-217.4639 503.5,-193.4639 575.5,-193.4639 575.5,-217.4639"/>
<text text-anchor="middle" x="539.5" y="-203.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">window.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~window.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge38" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~window.f90</title>
<path fill="none" stroke="#00ffb9" stroke-dasharray="5,2" d="M655.9151,-204.8278C632.6416,-204.9549 607.0402,-205.0948 585.7862,-205.211"/>
<polygon fill="#00ffb9" stroke="#00ffb9" points="585.7116,-201.7112 575.7309,-205.2659 585.7499,-208.7111 585.7116,-201.7112"/>
</g>
<!-- sourcefile~fluid_density_momenta.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node18" class="node">
<title>sourcefile~fluid_density_momenta.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node18"><a xlink:href=".././sourcefile/fluid_density_momenta.f90.html" xlink:title="fluid_density_momenta.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="618,-297.4639 461,-297.4639 461,-273.4639 618,-273.4639 618,-297.4639"/>
<text text-anchor="middle" x="539.5" y="-283.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fluid_density_momenta.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~fluid_density_momenta.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge41" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~fluid_density_momenta.f90</title>
<path fill="none" stroke="#002eff" stroke-dasharray="5,2" d="M678.9531,-216.4853C670.5732,-219.1704 661.938,-222.2003 654,-225.4639 623.899,-237.8397 591.158,-255.4483 568.4276,-268.3897"/>
<polygon fill="#002eff" stroke="#002eff" points="566.5586,-265.427 559.6355,-273.4471 570.0489,-271.4948 566.5586,-265.427"/>
</g>
<!-- sourcefile~env_evolve_in_time.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node13" class="node">
<title>sourcefile~env_evolve_in_time.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node13"><a xlink:href=".././sourcefile/env_evolve_in_time.f90.html" xlink:title="env_evolve_in_time.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="791,-258.4639 654,-258.4639 654,-234.4639 791,-234.4639 791,-258.4639"/>
<text text-anchor="middle" x="722.5" y="-244.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">env_evolve_in_time.f90</text>
</a>
</g>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~mpi_part_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge21" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~mpi_part_interface.f90</title>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M653.8463,-242.8902C591.4138,-239.6403 499.3854,-234.8497 434.4808,-231.4711"/>
<polygon fill="#00a9ff" stroke="#00a9ff" points="434.4741,-227.9661 424.3056,-230.9415 434.1101,-234.9567 434.4741,-227.9661"/>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge33" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M704.7373,-258.586C684.5113,-271.923 650.1025,-293.2192 618,-306.4639 612.865,-308.5825 607.4525,-310.5462 601.9694,-312.3525"/>
<polygon fill="#ff0000" stroke="#ff0000" points="600.5767,-309.1202 592.0681,-315.4333 602.6565,-315.8041 600.5767,-309.1202"/>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~window.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge39" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~window.f90</title>
<path fill="none" stroke="#00ffb9" stroke-dasharray="5,2" d="M668.5837,-234.3843C642.2673,-228.4883 610.9305,-221.4675 585.7231,-215.8199"/>
<polygon fill="#00ffb9" stroke="#00ffb9" points="586.2055,-212.3413 575.6822,-213.5703 584.6751,-219.172 586.2055,-212.3413"/>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~fluid_density_momenta.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge42" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~fluid_density_momenta.f90</title>
<path fill="none" stroke="#002eff" stroke-dasharray="5,2" d="M666.1007,-258.4834C647.0546,-262.5425 625.6168,-267.1112 605.8714,-271.3192"/>
<polygon fill="#002eff" stroke="#002eff" points="605.0789,-267.9094 596.028,-273.417 606.538,-274.7557 605.0789,-267.9094"/>
</g>
<!-- sourcefile~pic_out_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node14" class="node">
<title>sourcefile~pic_out_util.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node14"><a xlink:href=".././sourcefile/pic_out_util.f90.html" xlink:title="pic_out_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="586,-423.4639 493,-423.4639 493,-399.4639 586,-399.4639 586,-423.4639"/>
<text text-anchor="middle" x="539.5" y="-409.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_out_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge10" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M492.6305,-400.3903C469.9511,-395.032 442.4465,-388.5337 418.1868,-382.802"/>
<polygon fill="#ff0000" stroke="#ff0000" points="418.9022,-379.3747 408.3654,-380.4816 417.2927,-386.1872 418.9022,-379.3747"/>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge28" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M492.7009,-403.9379C481.7512,-400.8574 470.5165,-396.5313 461,-390.4639 439.9836,-377.0645 445.7427,-361.2832 425,-347.4639 422.4274,-345.75 419.7077,-344.1701 416.8946,-342.7143"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="418.207,-339.4657 407.6585,-338.4758 415.2874,-345.8278 418.207,-339.4657"/>
</g>
<!-- sourcefile~psolve.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node20" class="node">
<title>sourcefile~psolve.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node20"><a xlink:href=".././sourcefile/psolve.f90.html" xlink:title="psolve.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="391,-422.4639 324,-422.4639 324,-398.4639 391,-398.4639 391,-422.4639"/>
<text text-anchor="middle" x="357.5" y="-408.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">psolve.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~psolve.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge44" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~psolve.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M492.6305,-411.2064C464.5196,-411.0519 428.9954,-410.8567 401.426,-410.7053"/>
<polygon fill="#e700ff" stroke="#e700ff" points="401.3005,-407.2046 391.2813,-410.6495 401.2619,-414.2045 401.3005,-407.2046"/>
</g>
<!-- sourcefile~init_laser_field.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node15" class="node">
<title>sourcefile~init_laser_field.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node15"><a xlink:href=".././sourcefile/init_laser_field.f90.html" xlink:title="init_laser_field.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="412,-118.4639 303,-118.4639 303,-94.4639 412,-94.4639 412,-118.4639"/>
<text text-anchor="middle" x="357.5" y="-104.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">init_laser_field.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_laser_field.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge22" class="edge">
<title>sourcefile~init_laser_field.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M339.5714,-118.5652C324.7763,-129.2623 304.01,-146.0019 290,-164.4639 267.1631,-194.5577 278.9559,-213.1026 254,-241.4639 244.1478,-252.6605 230.847,-262.0889 218.421,-269.3767"/>
<polygon fill="#0000ff" stroke="#0000ff" points="216.6199,-266.3735 209.5894,-274.2996 220.0281,-272.4878 216.6199,-266.3735"/>
</g>
<!-- sourcefile~window.f90&#45;&gt;sourcefile~run_data_info.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge15" class="edge">
<title>sourcefile~window.f90&#45;&gt;sourcefile~run_data_info.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M503.107,-201.4647C479.5479,-198.8758 448.2399,-195.4353 420.6929,-192.4082"/>
<polygon fill="#aaff00" stroke="#aaff00" points="421.058,-188.9273 410.7355,-191.314 420.2933,-195.8854 421.058,-188.9273"/>
</g>
<!-- sourcefile~window.f90&#45;&gt;sourcefile~mpi_part_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge20" class="edge">
<title>sourcefile~window.f90&#45;&gt;sourcefile~mpi_part_interface.f90</title>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M503.107,-209.8631C483.3196,-212.255 458.0659,-215.3076 434.1654,-218.1967"/>
<polygon fill="#00a9ff" stroke="#00a9ff" points="433.5327,-214.7476 424.0251,-219.4224 434.3728,-221.697 433.5327,-214.7476"/>
</g>
<!-- sourcefile~window.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge29" class="edge">
<title>sourcefile~window.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M521.8027,-217.6786C505.5227,-229.1652 480.9543,-247.1398 461,-264.4639 443.9136,-279.2981 443.9699,-288.1292 425,-300.4639 419.2704,-304.1895 412.9264,-307.506 406.4881,-310.4191"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="404.9031,-307.2889 397.0483,-314.3991 407.6226,-313.7391 404.9031,-307.2889"/>
</g>
<!-- sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node17" class="node">
<title>sourcefile~init_beam_part_distrib.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node17"><a xlink:href=".././sourcefile/init_beam_part_distrib.f90.html" xlink:title="init_beam_part_distrib.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="615,-381.4639 464,-381.4639 464,-357.4639 615,-357.4639 615,-381.4639"/>
<text text-anchor="middle" x="539.5" y="-367.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">init_beam_part_distrib.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge12" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M463.8967,-369.0485C454.1112,-368.9947 444.081,-368.9396 434.2767,-368.8858"/>
<polygon fill="#ff0000" stroke="#ff0000" points="434.1802,-365.3853 424.1611,-368.8302 434.1416,-372.3852 434.1802,-365.3853"/>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge30" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M488.3185,-357.3716C466.5211,-352.2217 440.9269,-346.1747 418.1847,-340.8015"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="418.8342,-337.3587 408.2973,-338.4655 417.2246,-344.1711 418.8342,-337.3587"/>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~psolve.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge45" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~psolve.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M485.8784,-381.5435C458.7563,-387.6534 426.2725,-394.9712 400.7668,-400.717"/>
<polygon fill="#e700ff" stroke="#e700ff" points="399.9938,-397.3033 391.0075,-402.9155 401.5322,-404.1322 399.9938,-397.3033"/>
</g>
<!-- sourcefile~fluid_density_momenta.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge23" class="edge">
<title>sourcefile~fluid_density_momenta.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M460.615,-287.9653C428.5925,-288.4419 391.2589,-288.3132 357.5,-286.4639"/>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M357.5,-286.4639C317.3387,-284.2639 271.9,-284.3458 237.4597,-284.9345"/>
<polygon fill="#0000ff" stroke="#0000ff" points="237.0738,-281.4411 227.1425,-285.1315 237.2075,-288.4398 237.0738,-281.4411"/>
</g>
<!-- sourcefile~fluid_density_momenta.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge31" class="edge">
<title>sourcefile~fluid_density_momenta.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M485.8784,-297.5435C465.5116,-302.1316 442.1214,-307.4008 420.933,-312.1741"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="420.0389,-308.7877 411.0526,-314.3999 421.5773,-315.6166 420.0389,-308.7877"/>
</g>
<!-- sourcefile~start_all.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node19" class="node">
<title>sourcefile~start_all.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node19"><a xlink:href=".././sourcefile/start_all.f90.html" xlink:title="start_all.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="761,-99.4639 684,-99.4639 684,-75.4639 761,-75.4639 761,-99.4639"/>
<text text-anchor="middle" x="722.5" y="-85.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">start_all.F90</text>
</a>
</g>
</g>
<!-- sourcefile~start_all.f90&#45;&gt;sourcefile~run_data_info.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge14" class="edge">
<title>sourcefile~start_all.f90&#45;&gt;sourcefile~run_data_info.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M683.974,-96.0376C646.9622,-104.2382 589.4502,-116.8862 539.5,-127.4639"/>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M539.5,-127.4639C490.1239,-137.92 435.1319,-156.4427 398.6522,-169.7453"/>
<polygon fill="#aaff00" stroke="#aaff00" points="397.0474,-166.6065 388.874,-173.3479 399.4675,-173.1749 397.0474,-166.6065"/>
</g>
<!-- sourcefile~start_all.f90&#45;&gt;sourcefile~pic_dump.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge18" class="edge">
<title>sourcefile~start_all.f90&#45;&gt;sourcefile~pic_dump.f90</title>
<path fill="none" stroke="#00ffa9" stroke-dasharray="5,2" d="M683.5754,-77.7313C664.0339,-73.3348 639.9129,-68.6439 618,-66.4639 472.6951,-52.0084 427.7413,-36.989 290,-85.4639 258.0264,-96.7163 225.8001,-119.0383 205.1957,-135.0399"/>
<polygon fill="#00ffa9" stroke="#00ffa9" points="202.7658,-132.5001 197.1114,-141.46 207.1191,-137.9818 202.7658,-132.5001"/>
</g>
<!-- sourcefile~pic_in.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node22" class="node">
<title>sourcefile~pic_in.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node22"><a xlink:href=".././sourcefile/pic_in.f90.html" xlink:title="pic_in.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="571.5,-99.4639 507.5,-99.4639 507.5,-75.4639 571.5,-75.4639 571.5,-99.4639"/>
<text text-anchor="middle" x="539.5" y="-85.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_in.f90</text>
</a>
</g>
</g>
<!-- sourcefile~start_all.f90&#45;&gt;sourcefile~pic_in.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge46" class="edge">
<title>sourcefile~start_all.f90&#45;&gt;sourcefile~pic_in.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M683.6904,-87.4639C653.8453,-87.4639 612.655,-87.4639 581.9385,-87.4639"/>
<polygon fill="#ff0000" stroke="#ff0000" points="581.5463,-83.964 571.5463,-87.4639 581.5462,-90.964 581.5463,-83.964"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge17" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M323.8546,-408.1502C295.7707,-406.2189 255.5891,-403.4557 225.3247,-401.3745"/>
<polygon fill="#00ff00" stroke="#00ff00" points="225.2861,-397.8637 215.0695,-400.6693 224.8058,-404.8472 225.2861,-397.8637"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge25" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M323.7321,-404.8536C312.2022,-401.7267 299.7662,-396.8965 290,-389.4639 266.455,-371.5449 274.7812,-354.5257 254,-333.4639 242.6117,-321.9219 227.948,-311.6422 214.9064,-303.662"/>
<polygon fill="#0000ff" stroke="#0000ff" points="216.5871,-300.5898 206.1969,-298.5174 213.0269,-306.6169 216.5871,-300.5898"/>
</g>
<!-- sourcefile~aladyn.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node21" class="node">
<title>sourcefile~aladyn.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node21"><a xlink:href=".././sourcefile/aladyn.f90.html" xlink:title="ALaDyn.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="903,-178.4639 827,-178.4639 827,-154.4639 903,-154.4639 903,-178.4639"/>
<text text-anchor="middle" x="865" y="-164.0639" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALaDyn.F90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~diag_part_and_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge13" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~diag_part_and_fields.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M722.5,-451.4639C558.3487,-529.5951 333.0037,-485.8085 233.603,-460.0579"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="234.3771,-456.6424 223.815,-457.4743 232.5905,-463.4106 234.3771,-456.6424"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~run_data_info.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge16" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~run_data_info.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M828.5282,-154.3914C767.966,-136.0581 643.0645,-105.5326 539.5,-127.4639"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge26" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M860.0395,-154.3524C850.3852,-132.5145 826.8255,-86.9144 791,-66.4639 605.9281,39.1819 334.963,-7.3981 228.4173,-31.8885"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="227.5651,-28.4933 218.6281,-34.1837 229.1631,-35.3085 227.5651,-28.4933"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_evolve_in_time.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge34" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_evolve_in_time.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M826.8126,-176.6472C811.7245,-180.6707 794.0947,-185.372 777.6681,-189.7524"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="776.3897,-186.4709 767.6292,-192.4295 778.1934,-193.2346 776.3897,-186.4709"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~env_evolve_in_time.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge35" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~env_evolve_in_time.f90</title>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M852.9382,-178.4957C839.0785,-191.7105 815.126,-212.7412 791,-225.4639 787.45,-227.336 783.7066,-229.0698 779.8752,-230.6704"/>
<polygon fill="#e7ff00" stroke="#e7ff00" points="778.3081,-227.523 770.2294,-234.3776 780.8194,-234.057 778.3081,-227.523"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge36" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out_util.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M722.5,-451.4639C710.6625,-457.0982 641.1318,-439.7645 591.2844,-426.1617"/>
<polygon fill="#5cff00" stroke="#5cff00" points="592.1703,-422.7755 581.6002,-423.4988 590.3143,-429.525 592.1703,-422.7755"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge40" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~init_beam_part_distrib.f90</title>
<path fill="none" stroke="#00b9ff" stroke-dasharray="5,2" d="M863.8579,-178.6837C858.6464,-226.2736 832.3899,-399.1596 722.5,-451.4639"/>
<path fill="none" stroke="#00b9ff" stroke-dasharray="5,2" d="M722.5,-451.4639C673.9416,-474.5763 667.6395,-411.1524 618,-390.4639 612.954,-388.3609 607.637,-386.4133 602.2466,-384.6224"/>
<polygon fill="#00b9ff" stroke="#00b9ff" points="603.0966,-381.2209 592.5075,-381.5681 601.0019,-387.9002 603.0966,-381.2209"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~start_all.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge43" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~start_all.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M850.4437,-154.2965C836.0354,-142.6853 813.0047,-125.2617 791,-113.4639 784.0635,-109.7449 776.4784,-106.3048 768.9634,-103.226"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="770.1236,-99.9215 759.5362,-99.5256 767.5659,-106.4375 770.1236,-99.9215"/>
</g>
<!-- sourcefile~pic_in.f90&#45;&gt;sourcefile~init_laser_field.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge37" class="edge">
<title>sourcefile~pic_in.f90&#45;&gt;sourcefile~init_laser_field.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M507.381,-90.817C483.8294,-93.2757 451.0566,-96.697 422.1609,-99.7136"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="421.7059,-96.242 412.1233,-100.7615 422.4327,-103.2042 421.7059,-96.242"/>
</g>
</g>
</svg>
</div><script>var pansourcefileparallelf90AfferentGraph = svgPanZoom('#sourcefileparallelf90AfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/parallel.html">parallel</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/parallel.f90.html#src">parallel.F90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-2"></a><span class="c">!                            Copyright 2008-2020  The ALaDyn Collaboration                            !</span>
<a name="ln-3"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-4"></a>
<a name="ln-5"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-6"></a><span class="c">!  This file is part of ALaDyn.                                                                       !</span>
<a name="ln-7"></a><span class="c">!                                                                                                     !</span>
<a name="ln-8"></a><span class="c">!  ALaDyn is free software: you can redistribute it and/or modify                                     !</span>
<a name="ln-9"></a><span class="c">!  it under the terms of the GNU General Public License as published by                               !</span>
<a name="ln-10"></a><span class="c">!  the Free Software Foundation, either version 3 of the License, or                                  !</span>
<a name="ln-11"></a><span class="c">!  (at your option) any later version.                                                                !</span>
<a name="ln-12"></a><span class="c">!                                                                                                     !</span>
<a name="ln-13"></a><span class="c">!  ALaDyn is distributed in the hope that it will be useful,                                          !</span>
<a name="ln-14"></a><span class="c">!  but WITHOUT ANY WARRANTY; without even the implied warranty of                                     !</span>
<a name="ln-15"></a><span class="c">!  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                      !</span>
<a name="ln-16"></a><span class="c">!  GNU General Public License for more details.                                                       !</span>
<a name="ln-17"></a><span class="c">!                                                                                                     !</span>
<a name="ln-18"></a><span class="c">!  You should have received a copy of the GNU General Public License                                  !</span>
<a name="ln-19"></a><span class="c">!  along with ALaDyn.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                                    !</span>
<a name="ln-20"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-21"></a>
<a name="ln-22"></a> <span class="k">module </span><span class="n">parallel</span>
<a name="ln-23"></a>  <span class="k">use </span><span class="n">mpi_var</span>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">common_param</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">util</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">init_random_seed</span>
<a name="ln-26"></a>
<a name="ln-27"></a><span class="cp">#if !defined (_CRESCO)</span>
<a name="ln-28"></a><span class="cp">#define ENABLE_MPI_LONG_INT</span>
<a name="ln-29"></a><span class="cp">#endif</span>
<a name="ln-30"></a>
<a name="ln-31"></a><span class="cp">#if defined (FORCE_OLD_MPI)</span>
<a name="ln-32"></a>  <span class="k">implicit none</span>
<a name="ln-33"></a><span class="k">  include</span> <span class="s1">&#39;mpif.h&#39;</span>
<a name="ln-34"></a><span class="cp">#else</span>
<a name="ln-35"></a>  <span class="k">use </span><span class="n">mpi</span>
<a name="ln-36"></a>  <span class="k">implicit none</span>
<a name="ln-37"></a><span class="cp">#endif</span>
<a name="ln-38"></a>
<a name="ln-39"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">offset_kind</span> <span class="o">=</span> <span class="n">mpi_offset_kind</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-40"></a>                        <span class="n">whence</span> <span class="o">=</span> <span class="n">mpi_seek_set</span>
<a name="ln-41"></a>
<a name="ln-42"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">mpi_err</span>
<a name="ln-43"></a>
<a name="ln-44"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">fp0x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="n">fp1x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-45"></a>
<a name="ln-46"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">status</span><span class="p">(</span><span class="n">mpi_status_size</span><span class="p">),</span> <span class="n">error</span><span class="p">,</span> <span class="n">mpi_sd</span>
<a name="ln-47"></a>
<a name="ln-48"></a> <span class="k">contains</span>
<a name="ln-49"></a>  <span class="c">!==================</span>
<a name="ln-50"></a>
<a name="ln-51"></a>  <span class="k">subroutine </span><span class="n">check_decomposition</span>
<a name="ln-52"></a>
<a name="ln-53"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">npe_yz</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-54"></a><span class="k">    </span><span class="n">nprocy</span> <span class="o">=</span> <span class="n">npe_yz</span>
<a name="ln-55"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">nz</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-56"></a><span class="k">     </span><span class="n">nprocz</span> <span class="o">=</span> <span class="n">npe_yz</span>
<a name="ln-57"></a>    <span class="k">else</span>
<a name="ln-58"></a><span class="k">     </span><span class="n">nprocz</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-59"></a>    <span class="k">end if</span>
<a name="ln-60"></a><span class="k">    </span><span class="n">nprocx</span> <span class="o">=</span> <span class="n">mpi_size</span><span class="o">/</span><span class="n">nprocy</span><span class="o">/</span><span class="n">nprocz</span>
<a name="ln-61"></a>   <span class="k">end if</span>
<a name="ln-62"></a><span class="k">   if</span> <span class="p">(</span><span class="n">nprocx</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">nprocy</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">nprocz</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-63"></a>       <span class="n">nprocx</span><span class="o">*</span><span class="n">nprocy</span><span class="o">*</span><span class="n">nprocz</span> <span class="o">/=</span> <span class="n">mpi_size</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-64"></a><span class="k">    if</span> <span class="p">(</span><span class="n">mpi_rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-65"></a><span class="k">     write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Invalid MPI decomposition&#39;</span>
<a name="ln-66"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;mpi_size =&#39;</span><span class="p">,</span> <span class="n">mpi_size</span>
<a name="ln-67"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nprocx =&#39;</span><span class="p">,</span> <span class="n">nprocx</span><span class="p">,</span> <span class="s1">&#39;nprocy =&#39;</span><span class="p">,</span> <span class="n">nprocy</span><span class="p">,</span> <span class="s1">&#39;nprocz =&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-68"></a>      <span class="n">nprocz</span>
<a name="ln-69"></a>     <span class="k">stop </span><span class="mi">674</span>
<a name="ln-70"></a>    <span class="k">end if</span>
<a name="ln-71"></a><span class="k">   end if</span>
<a name="ln-72"></a><span class="k">  end subroutine</span>
<a name="ln-73"></a>
<a name="ln-74"></a><span class="k">  subroutine </span><span class="n">start_parallel</span><span class="p">(</span><span class="n">ncmp</span><span class="p">,</span> <span class="n">p_ind</span><span class="p">,</span> <span class="n">b_ind</span><span class="p">)</span>
<a name="ln-75"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ncmp</span><span class="p">,</span> <span class="n">p_ind</span><span class="p">,</span> <span class="n">b_ind</span>
<a name="ln-76"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">pen</span><span class="p">,</span> <span class="n">pkind</span><span class="p">,</span> <span class="n">bkind</span>
<a name="ln-77"></a>
<a name="ln-78"></a>   <span class="k">call </span><span class="n">mpi_init</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<a name="ln-79"></a>   <span class="k">call </span><span class="n">mpi_comm_size</span><span class="p">(</span><span class="n">mpi_comm_world</span><span class="p">,</span> <span class="n">mpi_size</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-80"></a>   <span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">mpi_comm_world</span><span class="p">,</span> <span class="n">mpi_rank</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-81"></a>
<a name="ln-82"></a>   <span class="k">call </span><span class="n">check_decomposition</span>
<a name="ln-83"></a>   <span class="c">!===================================</span>
<a name="ln-84"></a>   <span class="n">npe_xloc</span> <span class="o">=</span> <span class="n">nprocx</span>
<a name="ln-85"></a>   <span class="n">npe_yloc</span> <span class="o">=</span> <span class="n">nprocy</span>
<a name="ln-86"></a>   <span class="n">npe_zloc</span> <span class="o">=</span> <span class="n">nprocz</span>
<a name="ln-87"></a>   <span class="n">npe</span> <span class="o">=</span> <span class="n">mpi_size</span>
<a name="ln-88"></a>
<a name="ln-89"></a>   <span class="n">pe_min</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-90"></a>   <span class="n">pe_max</span> <span class="o">=</span> <span class="n">npe</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-91"></a>
<a name="ln-92"></a>   <span class="n">mype</span> <span class="o">=</span> <span class="n">mpi_rank</span>
<a name="ln-93"></a>   <span class="n">pe0</span> <span class="o">=</span> <span class="p">(</span><span class="n">mype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-94"></a>   <span class="n">pe1</span> <span class="o">=</span> <span class="p">(</span><span class="n">mype</span> <span class="o">==</span> <span class="n">pe_max</span><span class="p">)</span>
<a name="ln-95"></a>
<a name="ln-96"></a>   <span class="n">prl</span> <span class="o">=</span> <span class="p">(</span><span class="n">npe</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-97"></a>   <span class="n">prlx</span> <span class="o">=</span> <span class="p">(</span><span class="n">npe_xloc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-98"></a>   <span class="n">prly</span> <span class="o">=</span> <span class="p">(</span><span class="n">npe_yloc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-99"></a>   <span class="n">prlz</span> <span class="o">=</span> <span class="p">(</span><span class="n">npe_zloc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-100"></a>
<a name="ln-101"></a>   <span class="n">comm</span> <span class="o">=</span> <span class="n">mpi_comm_world</span>
<a name="ln-102"></a>
<a name="ln-103"></a>   <span class="n">mpi_sd</span> <span class="o">=</span> <span class="n">mpi_double_precision</span>
<a name="ln-104"></a>
<a name="ln-105"></a>   <span class="k">call </span><span class="n">mpi_type_contiguous</span><span class="p">(</span><span class="n">ncmp</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">partype</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-106"></a>   <span class="k">call </span><span class="n">mpi_type_commit</span><span class="p">(</span><span class="n">partype</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-107"></a>
<a name="ln-108"></a>   <span class="c">!================</span>
<a name="ln-109"></a>   <span class="n">ndims</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-110"></a>   <span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">npe_yloc</span>
<a name="ln-111"></a>   <span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">npe_zloc</span>
<a name="ln-112"></a>   <span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">npe_xloc</span>
<a name="ln-113"></a>   <span class="c">!================</span>
<a name="ln-114"></a>   <span class="n">imodzx</span> <span class="o">=</span> <span class="n">mype</span><span class="o">/</span><span class="n">npe_yloc</span>
<a name="ln-115"></a>   <span class="n">imody</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">mype</span><span class="p">,</span> <span class="n">npe_yloc</span><span class="p">)</span>
<a name="ln-116"></a>   <span class="n">imodz</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">imodzx</span><span class="p">,</span> <span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-117"></a>   <span class="n">imodx</span> <span class="o">=</span> <span class="n">imodzx</span><span class="o">/</span><span class="n">npe_zloc</span>
<a name="ln-118"></a>
<a name="ln-119"></a>   <span class="n">imodyx</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="n">npe_zloc</span><span class="o">*</span><span class="n">imodx</span>
<a name="ln-120"></a>   <span class="n">imodyz</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="n">imodz</span>
<a name="ln-121"></a>   <span class="c">!======================</span>
<a name="ln-122"></a>   <span class="c">!=================</span>
<a name="ln-123"></a>
<a name="ln-124"></a>   <span class="c">!================= MPI cartesiantopology with (imody,imodz,imodx) coordinates</span>
<a name="ln-125"></a>   <span class="c">! mype=imody+npe_yloc*imodzx</span>
<a name="ln-126"></a>   <span class="c">! imodzx=imodz+npe_zloc*imodx</span>
<a name="ln-127"></a>   <span class="c">!----------------------------</span>
<a name="ln-128"></a>   <span class="c">! mype=imodyx+npe_yloc*imodz</span>
<a name="ln-129"></a>   <span class="c">! imodyx=imody+npe_yloc*npe_zloc*imodx</span>
<a name="ln-130"></a>   <span class="c">!===================</span>
<a name="ln-131"></a>   <span class="c">! mype=imodyz+npe_yloc*npe_zloc*imodx</span>
<a name="ln-132"></a>   <span class="n">col_or</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">imodz</span> <span class="o">+</span> <span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">imodx</span><span class="p">)</span>
<a name="ln-133"></a>   <span class="c">! imodyz=imody+npe_yloc*imodz</span>
<a name="ln-134"></a>   <span class="n">col_or</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">imodx</span>
<a name="ln-135"></a>   <span class="c">!==========================</span>
<a name="ln-136"></a>   <span class="n">col_or</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">imodz</span>
<a name="ln-137"></a>   <span class="c">!======================</span>
<a name="ln-138"></a>   <span class="k">call </span><span class="n">mpi_comm_split</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">col_or</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">imody</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-139"></a>   <span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">coor</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-140"></a>   <span class="k">call </span><span class="n">mpi_comm_split</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">col_or</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-141"></a>   <span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">coor</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-142"></a>   <span class="k">call </span><span class="n">mpi_comm_split</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">col_or</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-143"></a>   <span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">coor</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-144"></a>   <span class="c">!imodzx=&gt;&gt; all pes in the (imodz,imodx) plane for given imody</span>
<a name="ln-145"></a>   <span class="c">!imodyx=&gt; all pes in the (imody,imodx) plane for given imodz</span>
<a name="ln-146"></a>   <span class="c">!all pes in the (imody,imodz) plane for given imodx</span>
<a name="ln-147"></a>   <span class="c">!============ for diagnostic</span>
<a name="ln-148"></a>   <span class="n">pe0y</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">==</span> <span class="mi">0</span>
<a name="ln-149"></a>   <span class="n">pe1y</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">==</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-150"></a>   <span class="n">pe0z</span> <span class="o">=</span> <span class="n">imodz</span> <span class="o">==</span> <span class="mi">0</span>
<a name="ln-151"></a>   <span class="n">pe1z</span> <span class="o">=</span> <span class="n">imodz</span> <span class="o">==</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-152"></a>   <span class="n">pex0</span> <span class="o">=</span> <span class="n">imodx</span> <span class="o">==</span> <span class="mi">0</span>
<a name="ln-153"></a>   <span class="n">pex1</span> <span class="o">=</span> <span class="n">imodx</span> <span class="o">==</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-154"></a>   <span class="c">!===========================</span>
<a name="ln-155"></a>   <span class="n">pe_min_y</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-156"></a>   <span class="n">pe_max_y</span> <span class="o">=</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-157"></a>   <span class="n">pe_min_z</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-158"></a>   <span class="n">pe_max_z</span> <span class="o">=</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-159"></a>   <span class="n">pe_min_x</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-160"></a>   <span class="n">pe_max_x</span> <span class="o">=</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-161"></a>   <span class="c">!===========================</span>
<a name="ln-162"></a>   <span class="n">xl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-163"></a>   <span class="n">xr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-164"></a>   <span class="n">yl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-165"></a>   <span class="n">yr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-166"></a>   <span class="n">zl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-167"></a>   <span class="n">zr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-168"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pex0</span><span class="p">)</span> <span class="n">xl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-169"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pex1</span><span class="p">)</span> <span class="n">xr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-170"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0y</span><span class="p">)</span> <span class="n">yl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-171"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe1y</span><span class="p">)</span> <span class="n">yr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-172"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0z</span><span class="p">)</span> <span class="n">zl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-173"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe1z</span><span class="p">)</span> <span class="n">zr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-174"></a>   <span class="n">pe0x</span> <span class="o">=</span> <span class="n">pex0</span>
<a name="ln-175"></a>   <span class="n">pe1x</span> <span class="o">=</span> <span class="n">pex1</span>
<a name="ln-176"></a>   <span class="c">! Logical idensification of mpi boundary coordinates</span>
<a name="ln-177"></a>   <span class="n">pkind</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p_ind</span><span class="p">)</span>
<a name="ln-178"></a>   <span class="n">bkind</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b_ind</span><span class="p">)</span>
<a name="ln-179"></a>   <span class="c">!====================</span>
<a name="ln-180"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_npart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">pkind</span><span class="p">))</span>
<a name="ln-181"></a>   <span class="n">loc_npart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">pkind</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-182"></a>   <span class="c">!========================================</span>
<a name="ln-183"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_ne_ionz</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-184"></a>   <span class="n">loc_ne_ionz</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-185"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_tpart</span><span class="p">(</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-186"></a>   <span class="n">loc_tpart</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-187"></a>
<a name="ln-188"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">bkind</span><span class="p">))</span>
<a name="ln-189"></a>   <span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">bkind</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-190"></a>
<a name="ln-191"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">yp_next</span><span class="p">(</span><span class="n">npe_yloc</span><span class="p">),</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">npe_yloc</span><span class="p">))</span>
<a name="ln-192"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">zp_next</span><span class="p">(</span><span class="n">npe_zloc</span><span class="p">),</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">npe_zloc</span><span class="p">))</span>
<a name="ln-193"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">xp_next</span><span class="p">(</span><span class="n">npe_xloc</span><span class="p">),</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">npe_xloc</span><span class="p">))</span>
<a name="ln-194"></a>
<a name="ln-195"></a>   <span class="n">yp_next</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-196"></a>   <span class="n">yp_prev</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-197"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">npe_yloc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-198"></a><span class="k">    do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-199"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-200"></a>     <span class="n">yp_next</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">npe_yloc</span><span class="p">)</span>
<a name="ln-201"></a>     <span class="c">!============================</span>
<a name="ln-202"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">-</span> <span class="n">ipe</span>
<a name="ln-203"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">pen</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pen</span> <span class="o">=</span> <span class="n">pen</span> <span class="o">+</span> <span class="n">npe_yloc</span>
<a name="ln-204"></a>     <span class="n">yp_prev</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="n">pen</span>
<a name="ln-205"></a>    <span class="k">end do</span>
<a name="ln-206"></a><span class="k">   end if</span>
<a name="ln-207"></a><span class="k">   </span><span class="n">zp_next</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-208"></a>   <span class="n">zp_prev</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-209"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">npe_zloc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-210"></a><span class="k">    do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-211"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imodz</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-212"></a>     <span class="n">zp_next</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-213"></a>
<a name="ln-214"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imodz</span> <span class="o">-</span> <span class="n">ipe</span>
<a name="ln-215"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">pen</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pen</span> <span class="o">=</span> <span class="n">pen</span> <span class="o">+</span> <span class="n">npe_zloc</span>
<a name="ln-216"></a>     <span class="n">zp_prev</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="n">pen</span>
<a name="ln-217"></a>    <span class="k">end do</span>
<a name="ln-218"></a><span class="k">   end if</span>
<a name="ln-219"></a><span class="k">   </span><span class="n">xp_next</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-220"></a>   <span class="n">xp_prev</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-221"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prlx</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-222"></a><span class="k">    do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-223"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imodx</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-224"></a>     <span class="n">xp_next</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">npe_xloc</span><span class="p">)</span>
<a name="ln-225"></a>     <span class="c">!============= output arrays</span>
<a name="ln-226"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imodx</span> <span class="o">-</span> <span class="n">ipe</span>
<a name="ln-227"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">pen</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pen</span> <span class="o">=</span> <span class="n">pen</span> <span class="o">+</span> <span class="n">npe_xloc</span>
<a name="ln-228"></a>     <span class="n">xp_prev</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="n">pen</span>
<a name="ln-229"></a>    <span class="k">end do</span>
<a name="ln-230"></a><span class="k">   end if</span>
<a name="ln-231"></a>
<a name="ln-232"></a>   <span class="c">!==========================================</span>
<a name="ln-233"></a>   <span class="c">! INITIALIZE THE RANDOM SEED FOR EVERY MYPE</span>
<a name="ln-234"></a>   <span class="c">!==========================================</span>
<a name="ln-235"></a>
<a name="ln-236"></a>   <span class="k">call </span><span class="n">init_random_seed</span><span class="p">(</span><span class="n">mype</span><span class="p">)</span>
<a name="ln-237"></a>   <span class="c">!call processor_grid_diag</span>
<a name="ln-238"></a>
<a name="ln-239"></a>  <span class="k">end subroutine</span>
<a name="ln-240"></a>
<a name="ln-241"></a><span class="k">  subroutine </span><span class="n">mpi_write_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-242"></a>
<a name="ln-243"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-244"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-245"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-246"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-247"></a>   <span class="c">!===========================</span>
<a name="ln-248"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-249"></a>   <span class="c">!========================</span>
<a name="ln-250"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-251"></a>                      <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-252"></a>
<a name="ln-253"></a>   <span class="k">call </span><span class="n">mpi_file_write_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-254"></a>                          <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-255"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-256"></a>
<a name="ln-257"></a>  <span class="k">end subroutine</span>
<a name="ln-258"></a>  <span class="c">!======== each process acces thefile and writes at disp(byte) coordinate</span>
<a name="ln-259"></a>  <span class="k">subroutine </span><span class="n">mpi_write_row_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-260"></a>
<a name="ln-261"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-262"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-263"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-264"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-265"></a>
<a name="ln-266"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-267"></a>   <span class="c">!=======================================</span>
<a name="ln-268"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span> <span class="p">&amp;</span>
<a name="ln-269"></a>                      <span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-270"></a>
<a name="ln-271"></a>   <span class="c">!call mpi_file_set_view(thefile, disp, mpi_sd, &amp;</span>
<a name="ln-272"></a>   <span class="k">call </span><span class="n">mpi_file_write_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-273"></a>                          <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-274"></a>   <span class="c">! mpi_sd, &#39;native&#39;, &amp;</span>
<a name="ln-275"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-276"></a>  <span class="k">end subroutine</span>
<a name="ln-277"></a>  <span class="c">!mpi_info_null, ierr)</span>
<a name="ln-278"></a>  <span class="k">subroutine </span><span class="n">mpi_write_col_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-279"></a>
<a name="ln-280"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-281"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-282"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-283"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-284"></a>
<a name="ln-285"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-286"></a>   <span class="c">!===================</span>
<a name="ln-287"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span> <span class="p">&amp;</span>
<a name="ln-288"></a>                      <span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-289"></a>
<a name="ln-290"></a>   <span class="c">!call mpi_file_set_view(thefile, disp, mpi_sd, &amp;</span>
<a name="ln-291"></a>   <span class="k">call </span><span class="n">mpi_file_write_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-292"></a>                          <span class="n">mpi_double_precision</span><span class="p">,</span> <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-293"></a>   <span class="c">! mpi_sd, &#39;native&#39;, &amp;</span>
<a name="ln-294"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-295"></a>   <span class="c">! mpi_info_null, ierr)</span>
<a name="ln-296"></a>  <span class="k">end subroutine</span>
<a name="ln-297"></a>
<a name="ln-298"></a><span class="k">  subroutine </span><span class="n">mpi_read_col_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-299"></a>
<a name="ln-300"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-301"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-302"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-303"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-304"></a>
<a name="ln-305"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-306"></a>   <span class="c">!========================</span>
<a name="ln-307"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_rdonly</span><span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-308"></a>                      <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-309"></a>
<a name="ln-310"></a>   <span class="c">!call mpi_file_set_view(thefile, disp, mpi_sd, &amp;</span>
<a name="ln-311"></a>   <span class="k">call </span><span class="n">mpi_file_read_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-312"></a>                         <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-313"></a>   <span class="c">!mpi_sd, &#39;native&#39;, &amp;</span>
<a name="ln-314"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-315"></a>   <span class="c">!mpi_info_null, ierr)</span>
<a name="ln-316"></a>  <span class="k">end subroutine</span>
<a name="ln-317"></a>
<a name="ln-318"></a><span class="k">  subroutine </span><span class="n">mpi_read_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-319"></a>
<a name="ln-320"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-321"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-322"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-323"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-324"></a>
<a name="ln-325"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-326"></a>   <span class="c">!=======================================</span>
<a name="ln-327"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_rdonly</span><span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-328"></a>                      <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-329"></a>
<a name="ln-330"></a>   <span class="k">call </span><span class="n">mpi_file_read_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-331"></a>                         <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-332"></a>   <span class="c">!call mpi_file_set_view(thefile, disp, mpi_sd, &amp;</span>
<a name="ln-333"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-334"></a>   <span class="c">! mpi_sd, &#39;native&#39;, mpi_info_null, ierr)</span>
<a name="ln-335"></a>  <span class="k">end subroutine</span>
<a name="ln-336"></a>  <span class="c">!call mpi_file_seek(thefile,disp,whence,ierr)</span>
<a name="ln-337"></a>  <span class="k">subroutine </span><span class="n">mpi_write_part</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">loc_np</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-338"></a>
<a name="ln-339"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-340"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">loc_np</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-341"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-342"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-343"></a>
<a name="ln-344"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-345"></a>   <span class="c">!===============================</span>
<a name="ln-346"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-347"></a>                      <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-348"></a>
<a name="ln-349"></a>   <span class="k">call </span><span class="n">mpi_file_set_view</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-350"></a>                          <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-351"></a>
<a name="ln-352"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">loc_np</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-353"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-354"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-355"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-356"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-357"></a>   <span class="c">!mpi_file_set_view is broken on Windows 10 with Intel MPI 5 (don&#39;t have money to upgrade MPI-Lib and check)</span>
<a name="ln-358"></a>  <span class="k">end subroutine</span>
<a name="ln-359"></a>  <span class="c">!please disable any binary output in Windows/IFORT if it doesn&#39;t work for you</span>
<a name="ln-360"></a>
<a name="ln-361"></a>  <span class="k">subroutine </span><span class="n">mpi_write_part_col</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-362"></a>
<a name="ln-363"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-364"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-365"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-366"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-367"></a>   <span class="c">!========================</span>
<a name="ln-368"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-369"></a>   <span class="c">!========================</span>
<a name="ln-370"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span> <span class="p">&amp;</span>
<a name="ln-371"></a>                      <span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-372"></a>
<a name="ln-373"></a>   <span class="k">call </span><span class="n">mpi_file_set_view</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-374"></a>                          <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-375"></a>
<a name="ln-376"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-377"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-378"></a>   <span class="c">!mpi_file_set_view is broken on Windows 10 with Intel MPI 5 (don&#39;t have money to upgrade MPI-Lib and check)</span>
<a name="ln-379"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-380"></a>   <span class="c">!please disable any binary output in Windows/IFORT if it doesn&#39;t work for you</span>
<a name="ln-381"></a>  <span class="k">end subroutine</span>
<a name="ln-382"></a>
<a name="ln-383"></a><span class="k">  subroutine </span><span class="n">mpi_write_field</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-384"></a>                             <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-385"></a>
<a name="ln-386"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-387"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">header</span><span class="p">(:)</span>
<a name="ln-388"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-389"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-390"></a>
<a name="ln-391"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-392"></a>   <span class="c">!========================</span>
<a name="ln-393"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-394"></a>                      <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-395"></a>
<a name="ln-396"></a>   <span class="k">call </span><span class="n">mpi_file_set_view</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-397"></a>                          <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-398"></a>
<a name="ln-399"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-400"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-401"></a>   <span class="c">!mpi_file_set_view is broken on Windows 10 with Intel MPI 5 (don&#39;t have money to upgrade MPI-Lib and check)</span>
<a name="ln-402"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-403"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-404"></a>   <span class="c">!please disable any binary output in Windows/IFORT if it doesn&#39;t work for you</span>
<a name="ln-405"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-406"></a>  <span class="k">end subroutine</span>
<a name="ln-407"></a>
<a name="ln-408"></a><span class="k">  subroutine </span><span class="n">mpi_write_field_col</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-409"></a>                                 <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-410"></a>   <span class="c">!========================</span>
<a name="ln-411"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-412"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">header</span><span class="p">(:)</span>
<a name="ln-413"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-414"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-415"></a>   <span class="c">!different from mpi_write_field because of the different communicator in</span>
<a name="ln-416"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-417"></a>   <span class="c">!mpi_file_open</span>
<a name="ln-418"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span> <span class="p">&amp;</span>
<a name="ln-419"></a>                      <span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-420"></a>
<a name="ln-421"></a>   <span class="k">call </span><span class="n">mpi_file_set_view</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-422"></a>                          <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-423"></a>
<a name="ln-424"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-425"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-426"></a>   <span class="c">!mpi_file_set_view is broken on Windows 10 with Intel MPI 5 (don&#39;t have money to upgrade MPI-Lib and check)</span>
<a name="ln-427"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-428"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-429"></a>   <span class="c">!please disable any binary output in Windows/IFORT if it doesn&#39;t work for you</span>
<a name="ln-430"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-431"></a>  <span class="k">end subroutine</span>
<a name="ln-432"></a>
<a name="ln-433"></a><span class="k">  subroutine </span><span class="n">End_parallel</span>
<a name="ln-434"></a>
<a name="ln-435"></a>   <span class="k">call </span><span class="n">MPI_FINALIZE</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<a name="ln-436"></a>
<a name="ln-437"></a>  <span class="k">end subroutine</span>
<a name="ln-438"></a>
<a name="ln-439"></a><span class="k">  subroutine </span><span class="n">exchange_idata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">idat</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-440"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-441"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">idat</span><span class="p">(:)</span>
<a name="ln-442"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-443"></a>
<a name="ln-444"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-445"></a>    <span class="c">!=======================</span>
<a name="ln-446"></a>    <span class="k">call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">idat</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-447"></a>    <span class="c">!=====================================</span>
<a name="ln-448"></a>   <span class="k">else</span>
<a name="ln-449"></a>
<a name="ln-450"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">idat</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-451"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-452"></a>   <span class="k">end if</span>
<a name="ln-453"></a>
<a name="ln-454"></a><span class="k">  end subroutine</span>
<a name="ln-455"></a>
<a name="ln-456"></a><span class="k">  subroutine </span><span class="n">exchange_2d_idata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">idat</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-457"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-458"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">idat</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-459"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-460"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">lenw</span>
<a name="ln-461"></a>
<a name="ln-462"></a>   <span class="n">lenw</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span>
<a name="ln-463"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-464"></a>
<a name="ln-465"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">idat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-466"></a>
<a name="ln-467"></a>   <span class="k">else</span>
<a name="ln-468"></a>
<a name="ln-469"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">idat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-470"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-471"></a>   <span class="k">end if</span>
<a name="ln-472"></a>
<a name="ln-473"></a><span class="k">  end subroutine</span>
<a name="ln-474"></a>
<a name="ln-475"></a><span class="k">  subroutine </span><span class="n">exchange_3d_sp_data</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-476"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-477"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-478"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-479"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">lenw</span>
<a name="ln-480"></a>
<a name="ln-481"></a>   <span class="n">lenw</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span><span class="o">*</span><span class="n">n3</span>
<a name="ln-482"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-483"></a>
<a name="ln-484"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-485"></a>    <span class="c">!====================</span>
<a name="ln-486"></a>   <span class="k">else</span>
<a name="ln-487"></a>
<a name="ln-488"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-489"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-490"></a>   <span class="k">end if</span>
<a name="ln-491"></a>
<a name="ln-492"></a><span class="k">  end subroutine</span>
<a name="ln-493"></a>
<a name="ln-494"></a><span class="k">  subroutine </span><span class="n">exchange_1d_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-495"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-496"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:)</span>
<a name="ln-497"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-498"></a>
<a name="ln-499"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-500"></a>
<a name="ln-501"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-502"></a>
<a name="ln-503"></a>   <span class="k">else</span>
<a name="ln-504"></a>    <span class="c">!====================</span>
<a name="ln-505"></a>    <span class="k">call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-506"></a>   <span class="k">end if</span>
<a name="ln-507"></a>
<a name="ln-508"></a><span class="k">  end subroutine</span>
<a name="ln-509"></a>
<a name="ln-510"></a><span class="k">  subroutine </span><span class="n">exchange_2d_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-511"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-512"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-513"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-514"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">lenw</span>
<a name="ln-515"></a>
<a name="ln-516"></a>   <span class="n">lenw</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span>
<a name="ln-517"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-518"></a>
<a name="ln-519"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-520"></a>
<a name="ln-521"></a>   <span class="k">else</span>
<a name="ln-522"></a>
<a name="ln-523"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-524"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-525"></a>   <span class="k">end if</span>
<a name="ln-526"></a>
<a name="ln-527"></a><span class="k">  end subroutine</span>
<a name="ln-528"></a><span class="c">!====================</span>
<a name="ln-529"></a>  <span class="k">subroutine </span><span class="n">exchange_3d_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ipe</span><span class="p">)</span>
<a name="ln-530"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ipe</span>
<a name="ln-531"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-532"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-533"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">tag</span>
<a name="ln-534"></a>
<a name="ln-535"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-536"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-537"></a>
<a name="ln-538"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-539"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-540"></a>    <span class="c">!=========================</span>
<a name="ln-541"></a>   <span class="k">else</span>
<a name="ln-542"></a>
<a name="ln-543"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-544"></a>                  <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-545"></a>   <span class="k">end if</span>
<a name="ln-546"></a><span class="k">  end subroutine</span>
<a name="ln-547"></a><span class="k">  subroutine </span><span class="n">exchange_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ipe</span><span class="p">)</span>
<a name="ln-548"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ipe</span>
<a name="ln-549"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-550"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-551"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">tag</span>
<a name="ln-552"></a>
<a name="ln-553"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-554"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-555"></a>
<a name="ln-556"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-557"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-558"></a>    <span class="c">!=========================</span>
<a name="ln-559"></a>   <span class="k">else</span>
<a name="ln-560"></a>
<a name="ln-561"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-562"></a>                  <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-563"></a>   <span class="k">end if</span>
<a name="ln-564"></a>
<a name="ln-565"></a><span class="k">  end subroutine</span>
<a name="ln-566"></a>
<a name="ln-567"></a><span class="k">  subroutine </span><span class="n">realvec_distribute</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nproc</span><span class="p">)</span>
<a name="ln-568"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nproc</span>
<a name="ln-569"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rs</span>
<a name="ln-570"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rv</span><span class="p">(:),</span> <span class="n">rc</span>
<a name="ln-571"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ipe</span>
<a name="ln-572"></a>
<a name="ln-573"></a>   <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-574"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="mi">20</span> <span class="o">+</span> <span class="n">mype</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-575"></a>   <span class="k">else</span>
<a name="ln-576"></a><span class="k">    </span><span class="n">rv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">rs</span>
<a name="ln-577"></a>    <span class="k">do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nproc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-578"></a>     <span class="k">call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="mi">20</span> <span class="o">+</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-579"></a>     <span class="n">rv</span><span class="p">(</span><span class="n">ipe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">rc</span>
<a name="ln-580"></a>    <span class="k">end do</span>
<a name="ln-581"></a><span class="k">   end if</span>
<a name="ln-582"></a>
<a name="ln-583"></a><span class="k">  end subroutine</span>
<a name="ln-584"></a>
<a name="ln-585"></a><span class="k">  subroutine </span><span class="n">intvec_distribute</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">nproc</span><span class="p">)</span>
<a name="ln-586"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nproc</span>
<a name="ln-587"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nc</span><span class="p">(:)</span>
<a name="ln-588"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">nr</span>
<a name="ln-589"></a>
<a name="ln-590"></a>   <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-591"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">mype</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-592"></a>   <span class="k">else</span>
<a name="ln-593"></a><span class="k">    </span><span class="n">nc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ns</span>
<a name="ln-594"></a>    <span class="k">do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nproc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-595"></a>     <span class="k">call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-596"></a>     <span class="n">nc</span><span class="p">(</span><span class="n">ipe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">nr</span>
<a name="ln-597"></a>    <span class="k">end do</span>
<a name="ln-598"></a><span class="k">   end if</span>
<a name="ln-599"></a><span class="k">   call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">nproc</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-600"></a>
<a name="ln-601"></a>  <span class="k">end subroutine</span>
<a name="ln-602"></a>
<a name="ln-603"></a><span class="k">  subroutine </span><span class="n">sr_idata</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-604"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ns</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span>
<a name="ln-605"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nr</span>
<a name="ln-606"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-607"></a>
<a name="ln-608"></a>   <span class="n">nr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-609"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">dir</span>
<a name="ln-610"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-611"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-612"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-613"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-614"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> <span class="c">!=============</span>
<a name="ln-615"></a>    <span class="k">else</span>
<a name="ln-616"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-617"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span> <span class="c">!sends to left ns data</span>
<a name="ln-618"></a>    <span class="k">end if</span>
<a name="ln-619"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-620"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-621"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-622"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-623"></a>    <span class="k">else</span>
<a name="ln-624"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-625"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-626"></a>    <span class="k">end if</span>
<a name="ln-627"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-628"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-629"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-630"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-631"></a>    <span class="k">else</span>
<a name="ln-632"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-633"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-634"></a>    <span class="k">end if</span>
<a name="ln-635"></a><span class="k">   end select</span>
<a name="ln-636"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-637"></a>                     <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-638"></a>   <span class="c">!receives from right nr daata</span>
<a name="ln-639"></a>  <span class="k">end subroutine</span>
<a name="ln-640"></a>  <span class="c">!sends to right ns data</span>
<a name="ln-641"></a>  <span class="k">subroutine </span><span class="n">sr_pdata</span><span class="p">(</span><span class="n">sdata</span><span class="p">,</span> <span class="n">rdata</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-642"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sdata</span><span class="p">(:)</span>
<a name="ln-643"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rdata</span><span class="p">(:)</span>
<a name="ln-644"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span>
<a name="ln-645"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">per</span>
<a name="ln-646"></a>   <span class="c">!receives form left nr data</span>
<a name="ln-647"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">dir</span>
<a name="ln-648"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-649"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-650"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-651"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-652"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-653"></a>    <span class="k">else</span>
<a name="ln-654"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-655"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-656"></a>    <span class="k">end if</span>
<a name="ln-657"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-658"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-659"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-660"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-661"></a>    <span class="k">else</span>
<a name="ln-662"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-663"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-664"></a>    <span class="k">end if</span>
<a name="ln-665"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-666"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-667"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-668"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-669"></a>    <span class="k">else</span>
<a name="ln-670"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-671"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-672"></a>    <span class="k">end if</span>
<a name="ln-673"></a><span class="k">   end select</span>
<a name="ln-674"></a><span class="k">   if</span> <span class="p">(</span><span class="n">ns</span><span class="o">*</span><span class="n">nr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-675"></a><span class="k">    call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">sdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ns</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">nr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-676"></a>                      <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-677"></a>   <span class="k">else</span>
<a name="ln-678"></a><span class="k">    if</span> <span class="p">(</span><span class="n">ns</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">sdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ns</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-679"></a>                              <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-680"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">nr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">rdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">nr</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-681"></a>                              <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-682"></a>   <span class="k">end if</span>
<a name="ln-683"></a><span class="k">  end subroutine</span>
<a name="ln-684"></a>
<a name="ln-685"></a><span class="k">  subroutine </span><span class="n">sr_vidata</span><span class="p">(</span><span class="n">sidat</span><span class="p">,</span> <span class="n">ridat</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-686"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span>
<a name="ln-687"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sidat</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span>
<a name="ln-688"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ridat</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span>
<a name="ln-689"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">nq</span>
<a name="ln-690"></a>   <span class="c">!==================</span>
<a name="ln-691"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">dir</span>
<a name="ln-692"></a>   <span class="n">nq</span> <span class="o">=</span> <span class="n">n2</span><span class="o">*</span><span class="n">n3</span>
<a name="ln-693"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-694"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-695"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-696"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-697"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-698"></a>    <span class="k">else</span>
<a name="ln-699"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-700"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-701"></a>    <span class="k">end if</span>
<a name="ln-702"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-703"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-704"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-705"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-706"></a>    <span class="k">else</span>
<a name="ln-707"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-708"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-709"></a>    <span class="k">end if</span>
<a name="ln-710"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-711"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-712"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-713"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-714"></a>    <span class="k">else</span>
<a name="ln-715"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-716"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-717"></a>    <span class="k">end if</span>
<a name="ln-718"></a><span class="k">   end select</span>
<a name="ln-719"></a>
<a name="ln-720"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">sidat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">nq</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">ridat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-721"></a>                     <span class="n">nq</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-722"></a>   <span class="c">!====================</span>
<a name="ln-723"></a>  <span class="k">end subroutine</span>
<a name="ln-724"></a>
<a name="ln-725"></a><span class="k">  subroutine </span><span class="n">exchange_pdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-726"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-727"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-728"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">pdata</span><span class="p">(:)</span>
<a name="ln-729"></a>
<a name="ln-730"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-731"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">pdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-732"></a>
<a name="ln-733"></a>   <span class="k">else</span>
<a name="ln-734"></a>
<a name="ln-735"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">pdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-736"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-737"></a>   <span class="k">end if</span>
<a name="ln-738"></a>
<a name="ln-739"></a><span class="k">  end subroutine</span>
<a name="ln-740"></a>
<a name="ln-741"></a><span class="k">  subroutine </span><span class="n">exchange_rdata</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-742"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff</span><span class="p">(:)</span>
<a name="ln-743"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-744"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-745"></a>
<a name="ln-746"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-747"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">buff</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-748"></a>   <span class="k">else</span>
<a name="ln-749"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">buff</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-750"></a>                  <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-751"></a>   <span class="k">end if</span>
<a name="ln-752"></a>
<a name="ln-753"></a><span class="k">  end subroutine</span>
<a name="ln-754"></a>
<a name="ln-755"></a><span class="k">  subroutine </span><span class="n">exchange_rdata_int</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-756"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff</span><span class="p">(:)</span>
<a name="ln-757"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-758"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-759"></a>
<a name="ln-760"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-761"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">buff</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-762"></a>   <span class="k">else</span>
<a name="ln-763"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">buff</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-764"></a>                  <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-765"></a>   <span class="k">end if</span>
<a name="ln-766"></a>
<a name="ln-767"></a><span class="k">  end subroutine</span>
<a name="ln-768"></a>  <span class="c">!=======================</span>
<a name="ln-769"></a>  <span class="k">subroutine </span><span class="n">vint_2d_bcast</span><span class="p">(</span><span class="n">mydat</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
<a name="ln-770"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span>
<a name="ln-771"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:)</span> <span class="kd">::</span> <span class="n">mydat</span>
<a name="ln-772"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-773"></a>
<a name="ln-774"></a>   <span class="n">nt</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span>
<a name="ln-775"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">mydat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-776"></a>
<a name="ln-777"></a>  <span class="k">end subroutine</span>
<a name="ln-778"></a>
<a name="ln-779"></a><span class="k">  subroutine </span><span class="n">vint_bcast</span><span class="p">(</span><span class="n">mydat</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-780"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-781"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mydat</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-782"></a>
<a name="ln-783"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">mydat</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-784"></a>
<a name="ln-785"></a>  <span class="k">end subroutine</span>
<a name="ln-786"></a>
<a name="ln-787"></a><span class="k">  subroutine </span><span class="n">int_bcast</span><span class="p">(</span><span class="n">mydat</span><span class="p">)</span>
<a name="ln-788"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mydat</span>
<a name="ln-789"></a>
<a name="ln-790"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">mydat</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-791"></a>
<a name="ln-792"></a>  <span class="k">end subroutine</span>
<a name="ln-793"></a>
<a name="ln-794"></a><span class="k">  subroutine </span><span class="n">all_gather_dpreal</span><span class="p">(</span><span class="n">rv_send</span><span class="p">,</span> <span class="n">rv_recv</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-795"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rv_send</span><span class="p">(:),</span> <span class="n">rv_recv</span><span class="p">(:)</span>
<a name="ln-796"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dir</span><span class="p">,</span> <span class="n">nt</span>
<a name="ln-797"></a>
<a name="ln-798"></a>   <span class="k">call </span><span class="n">mpi_allgather</span><span class="p">(</span><span class="n">rv_send</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">rv_recv</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-799"></a>                      <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-800"></a>  <span class="k">end subroutine</span>
<a name="ln-801"></a><span class="k">  subroutine </span><span class="n">allreduce_dpreal</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">rv_loc</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-802"></a>
<a name="ln-803"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ib</span><span class="p">,</span> <span class="n">nt</span>
<a name="ln-804"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rv_loc</span><span class="p">(:)</span>
<a name="ln-805"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rv</span><span class="p">(:)</span>
<a name="ln-806"></a>
<a name="ln-807"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-808"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">ib</span><span class="p">)</span>
<a name="ln-809"></a>    <span class="k">case</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!min</span>
<a name="ln-810"></a>
<a name="ln-811"></a>     <span class="k">call </span><span class="n">mpi_allreduce</span><span class="p">(</span><span class="n">rv_loc</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">mpi_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-812"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c">!sum</span>
<a name="ln-813"></a>
<a name="ln-814"></a>     <span class="k">call </span><span class="n">mpi_allreduce</span><span class="p">(</span><span class="n">rv_loc</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-815"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c">!max</span>
<a name="ln-816"></a>
<a name="ln-817"></a>     <span class="k">call </span><span class="n">mpi_allreduce</span><span class="p">(</span><span class="n">rv_loc</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">mpi_max</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-818"></a>    <span class="k">end select</span>
<a name="ln-819"></a>
<a name="ln-820"></a><span class="k">   else</span>
<a name="ln-821"></a><span class="k">    </span><span class="n">rv</span> <span class="o">=</span> <span class="n">rv_loc</span>
<a name="ln-822"></a>   <span class="k">end if</span>
<a name="ln-823"></a>
<a name="ln-824"></a><span class="k">  end subroutine</span>
<a name="ln-825"></a>
<a name="ln-826"></a><span class="cp">#ifdef ENABLE_MPI_LONG_INT</span>
<a name="ln-827"></a>  <span class="c">! WARNING: unsupported on some architecture!!</span>
<a name="ln-828"></a>  <span class="k">subroutine </span><span class="n">allreduce_big_int</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>
<a name="ln-829"></a>
<a name="ln-830"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n0</span>
<a name="ln-831"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span>
<a name="ln-832"></a>
<a name="ln-833"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-834"></a>
<a name="ln-835"></a><span class="k">    call </span><span class="n">mpi_allreduce</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_long_int</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-836"></a>   <span class="k">end if</span>
<a name="ln-837"></a>   <span class="c">!===========================</span>
<a name="ln-838"></a>  <span class="k">end subroutine</span>
<a name="ln-839"></a><span class="cp">#endif</span>
<a name="ln-840"></a>
<a name="ln-841"></a>  <span class="k">subroutine </span><span class="n">allreduce_sint</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">)</span>
<a name="ln-842"></a>
<a name="ln-843"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ib</span>
<a name="ln-844"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt0</span>
<a name="ln-845"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span>
<a name="ln-846"></a>
<a name="ln-847"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-848"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">ib</span><span class="p">)</span>
<a name="ln-849"></a>    <span class="k">case</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!---------------------------------------------</span>
<a name="ln-850"></a>
<a name="ln-851"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_min</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-852"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-853"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-854"></a>
<a name="ln-855"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-856"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-857"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-858"></a>
<a name="ln-859"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_max</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-860"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-861"></a>    <span class="k">end select</span>
<a name="ln-862"></a><span class="k">    call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-863"></a>   <span class="k">else</span>
<a name="ln-864"></a><span class="k">    </span><span class="n">dt_tot</span> <span class="o">=</span> <span class="n">dt0</span>
<a name="ln-865"></a>   <span class="k">end if</span>
<a name="ln-866"></a>
<a name="ln-867"></a><span class="k">  end subroutine</span>
<a name="ln-868"></a>
<a name="ln-869"></a><span class="k">  subroutine </span><span class="n">allreduce_vint</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-870"></a>
<a name="ln-871"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ib</span><span class="p">,</span> <span class="n">nt</span>
<a name="ln-872"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt0</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-873"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-874"></a>
<a name="ln-875"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-876"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">ib</span><span class="p">)</span>
<a name="ln-877"></a>    <span class="k">case</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!max</span>
<a name="ln-878"></a>
<a name="ln-879"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_min</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-880"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-881"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-882"></a>     <span class="c">!==============================</span>
<a name="ln-883"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-884"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-885"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-886"></a>
<a name="ln-887"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_max</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-888"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-889"></a>    <span class="k">end select</span>
<a name="ln-890"></a><span class="k">    call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-891"></a>   <span class="k">else</span>
<a name="ln-892"></a><span class="k">    </span><span class="n">dt_tot</span> <span class="o">=</span> <span class="n">dt0</span>
<a name="ln-893"></a>   <span class="k">end if</span>
<a name="ln-894"></a>
<a name="ln-895"></a><span class="k">  end subroutine</span>
<a name="ln-896"></a>
<a name="ln-897"></a><span class="k">  subroutine </span><span class="n">bcast_grdata</span><span class="p">(</span><span class="n">dat0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>
<a name="ln-898"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">nc</span>
<a name="ln-899"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-900"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">lenw</span>
<a name="ln-901"></a>
<a name="ln-902"></a>   <span class="n">lenw</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span><span class="o">*</span><span class="n">n3</span><span class="o">*</span><span class="n">nc</span>
<a name="ln-903"></a>
<a name="ln-904"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-905"></a>
<a name="ln-906"></a>  <span class="k">end subroutine</span>
<a name="ln-907"></a>
<a name="ln-908"></a><span class="k">  subroutine </span><span class="n">bcast_realv_sum</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">dt_prl</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-909"></a>
<a name="ln-910"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ib</span>
<a name="ln-911"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-912"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_prl</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-913"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-914"></a>
<a name="ln-915"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-916"></a>
<a name="ln-917"></a><span class="k">    call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt_prl</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-918"></a>                    <span class="n">error</span><span class="p">)</span>
<a name="ln-919"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ib</span><span class="p">)</span> <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-920"></a>   <span class="k">else</span>
<a name="ln-921"></a><span class="k">    </span><span class="n">dt_tot</span> <span class="o">=</span> <span class="n">dt_prl</span>
<a name="ln-922"></a>   <span class="k">end if</span>
<a name="ln-923"></a>
<a name="ln-924"></a><span class="k">  end subroutine</span>
<a name="ln-925"></a>
<a name="ln-926"></a><span class="k">  subroutine </span><span class="n">bcast_int_sum</span><span class="p">(</span><span class="n">dt_prl</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">)</span>
<a name="ln-927"></a>
<a name="ln-928"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_prl</span>
<a name="ln-929"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span>
<a name="ln-930"></a>
<a name="ln-931"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-932"></a>
<a name="ln-933"></a><span class="k">    call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt_prl</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-934"></a>                    <span class="n">error</span><span class="p">)</span>
<a name="ln-935"></a>    <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-936"></a>   <span class="k">else</span>
<a name="ln-937"></a><span class="k">    </span><span class="n">dt</span> <span class="o">=</span> <span class="n">dt_prl</span>
<a name="ln-938"></a>   <span class="k">end if</span>
<a name="ln-939"></a><span class="k">  end subroutine</span>
<a name="ln-940"></a>
<a name="ln-941"></a><span class="k">  subroutine </span><span class="n">real_bcast</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="n">ndt</span><span class="p">)</span>
<a name="ln-942"></a>
<a name="ln-943"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ndt</span>
<a name="ln-944"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span><span class="p">(</span><span class="n">ndt</span><span class="p">)</span>
<a name="ln-945"></a>
<a name="ln-946"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="n">ndt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-947"></a>
<a name="ln-948"></a>  <span class="k">end subroutine</span>
<a name="ln-949"></a>
<a name="ln-950"></a><span class="k">  subroutine </span><span class="n">local_to_global_grdata</span><span class="p">(</span><span class="n">buff1</span><span class="p">,</span> <span class="n">buff2</span><span class="p">,</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">dir</span><span class="p">)</span>
<a name="ln-951"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff1</span><span class="p">(:)</span>
<a name="ln-952"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff2</span><span class="p">(:)</span>
<a name="ln-953"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">dir</span>
<a name="ln-954"></a>   <span class="kt">integer </span><span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-955"></a>
<a name="ln-956"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">250</span> <span class="o">+</span> <span class="n">ip</span>
<a name="ln-957"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-958"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-959"></a>    <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-960"></a>    <span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-961"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-962"></a>    <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-963"></a>    <span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-964"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-965"></a>    <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-966"></a>    <span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-967"></a>   <span class="k">end select</span>
<a name="ln-968"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">buff1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">buff2</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenws</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-969"></a>                     <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-970"></a>
<a name="ln-971"></a>  <span class="k">end subroutine</span>
<a name="ln-972"></a>
<a name="ln-973"></a><span class="k">  subroutine </span><span class="n">exchange_bd_3d_data</span><span class="p">(</span><span class="n">buff1</span><span class="p">,</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">buff2</span><span class="p">,</span> <span class="n">lenwr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-974"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff1</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-975"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff2</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-976"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">lenwr</span><span class="p">,</span> <span class="n">dir</span>
<a name="ln-977"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">hp_int</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">side</span>
<a name="ln-978"></a>   <span class="kt">integer </span><span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-979"></a>
<a name="ln-980"></a>   <span class="c">!===============================</span>
<a name="ln-981"></a>   <span class="c">! side &gt; recievies next sends left</span>
<a name="ln-982"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">610</span>
<a name="ln-983"></a>
<a name="ln-984"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-985"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-986"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-987"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-988"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-989"></a>    <span class="k">else</span>
<a name="ln-990"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-991"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-992"></a>    <span class="k">end if</span>
<a name="ln-993"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-994"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-995"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-996"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-997"></a>    <span class="k">else</span>
<a name="ln-998"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-999"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1000"></a>    <span class="k">end if</span>
<a name="ln-1001"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1002"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1003"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1004"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1005"></a>    <span class="k">else</span>
<a name="ln-1006"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1007"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1008"></a>    <span class="k">end if</span>
<a name="ln-1009"></a><span class="k">   end select</span>
<a name="ln-1010"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">buff1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">buff2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenwr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1011"></a>                     <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-1012"></a>
<a name="ln-1013"></a>  <span class="k">end subroutine</span>
<a name="ln-1014"></a>
<a name="ln-1015"></a><span class="k">  subroutine </span><span class="n">exchange_bdx_data</span><span class="p">(</span><span class="n">buff1</span><span class="p">,</span> <span class="n">buff2</span><span class="p">,</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">lenwr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-1016"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff1</span><span class="p">(:)</span>
<a name="ln-1017"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff2</span><span class="p">(:)</span>
<a name="ln-1018"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">lenwr</span><span class="p">,</span> <span class="n">dir</span>
<a name="ln-1019"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">hp_int</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">side</span>
<a name="ln-1020"></a>   <span class="kt">integer </span><span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-1021"></a>
<a name="ln-1022"></a>   <span class="c">!===============================</span>
<a name="ln-1023"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">610</span>
<a name="ln-1024"></a>
<a name="ln-1025"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-1026"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1027"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1028"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1029"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1030"></a>    <span class="k">else</span>
<a name="ln-1031"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1032"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1033"></a>    <span class="k">end if</span>
<a name="ln-1034"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1035"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1036"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1037"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1038"></a>    <span class="k">else</span>
<a name="ln-1039"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1040"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1041"></a>    <span class="k">end if</span>
<a name="ln-1042"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1043"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1044"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1045"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1046"></a>    <span class="k">else</span>
<a name="ln-1047"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1048"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1049"></a>    <span class="k">end if</span>
<a name="ln-1050"></a><span class="k">   end select</span>
<a name="ln-1051"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">buff1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">buff2</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenwr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1052"></a>                     <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-1053"></a>
<a name="ln-1054"></a>  <span class="k">end subroutine</span>
<a name="ln-1055"></a>
<a name="ln-1056"></a><span class="k">  subroutine </span><span class="n">processor_grid_diag</span>
<a name="ln-1057"></a>   <span class="c">!============================</span>
<a name="ln-1058"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-1059"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;          &#39;</span>
<a name="ln-1060"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">lun</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-1061"></a>
<a name="ln-1062"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">mype</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1063"></a><span class="k">    write</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;(a9,i1)&#39;</span><span class="p">)</span> <span class="s1">&#39;proc_map0&#39;</span><span class="p">,</span> <span class="n">mype</span>
<a name="ln-1064"></a>   <span class="k">else</span>
<a name="ln-1065"></a><span class="k">    write</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;(a8,i2)&#39;</span><span class="p">)</span> <span class="s1">&#39;proc_map&#39;</span><span class="p">,</span> <span class="n">mype</span>
<a name="ln-1066"></a>   <span class="k">end if</span>
<a name="ln-1067"></a><span class="k">   open</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">fname</span><span class="o">//</span><span class="s1">&#39;.dat&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">)</span>
<a name="ln-1068"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;== local carteisan ranks&#39;</span>
<a name="ln-1069"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span>
<a name="ln-1070"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">coor</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1071"></a>   <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1072"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;====== y-neighbors=========&#39;</span>
<a name="ln-1073"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1074"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;====== z-neighbors=========&#39;</span>
<a name="ln-1075"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1076"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;====== x-neighbors=========&#39;</span>
<a name="ln-1077"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1078"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;======== comm_col===========&#39;</span>
<a name="ln-1079"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1080"></a>   <span class="k">close</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span>
<a name="ln-1081"></a>
<a name="ln-1082"></a>  <span class="k">end subroutine</span>
<a name="ln-1083"></a>  <span class="c">!================== side &lt;0 receives from left   side &gt;0 receives from right</span>
<a name="ln-1084"></a> <span class="k">end module</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-07-30 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> ALaDyn was developed by The ALaDyn Collaboration</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>