<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A High-Accuracy PIC Code for the Maxwell-Vlasov Equations">
    
    <meta name="author" content="The ALaDyn Collaboration" >
    <link rel="icon" href="../favicon.png">

    <title>init_beam_part_distrib.f90 &ndash; ALaDyn</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">ALaDyn <small>3.0.1</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Guide</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/aladyn.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/aladyn.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>init_beam_part_distrib.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 2.0% of total for source files.">485 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/init_beam_part_distrib.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">init_beam_part_distrib.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/init_beam_part_distrib.html">init_beam_part_distrib</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/init_beam_part_distrib.f90.html#src">init_beam_part_distrib.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~init_beam_part_distrib.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefileinit_beam_part_distribf90EfferentGraph" width="641pt" height="337pt"
 viewBox="0.00 0.00 641.00 337.29" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph" class="graph" transform="scale(.5886 .5886) rotate(0) translate(4 569.0215)">
<title>sourcefile~~init_beam_part_distrib.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-569.0215 1085,-569.0215 1085,4 -4,4"/>
<!-- sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~init_beam_part_distrib.f90</title>
<polygon fill="none" stroke="#000000" points="1081,-353.3175 930,-353.3175 930,-329.3175 1081,-329.3175 1081,-353.3175"/>
<text text-anchor="middle" x="1005.5" y="-338.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">init_beam_part_distrib.f90</text>
</g>
<!-- sourcefile~phys_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~phys_param.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/phys_param.f90.html" xlink:title="phys_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="722.5,-515.3175 624.5,-515.3175 624.5,-491.3175 722.5,-491.3175 722.5,-515.3175"/>
<text text-anchor="middle" x="673.5" y="-500.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">phys_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~phys_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~phys_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M999.9584,-353.5414C981.822,-391.7338 919.9834,-508.3588 826.5,-543.3175"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M826.5,-543.3175C805.8443,-551.0418 750.8642,-533.3207 712.7717,-519.0474"/>
<polygon fill="#ff0000" stroke="#ff0000" points="713.5917,-515.6144 703.0008,-515.3241 711.0991,-522.1556 713.5917,-515.6144"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~mpi_curr_interface.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/mpi_curr_interface.f90.html" xlink:title="mpi_curr_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="893,-311.3175 760,-311.3175 760,-287.3175 893,-287.3175 893,-311.3175"/>
<text text-anchor="middle" x="826.5" y="-296.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_curr_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M954.2058,-329.282C933.4213,-324.4052 909.2527,-318.7343 887.5687,-313.6464"/>
<polygon fill="#ff0000" stroke="#ff0000" points="888.3368,-310.2317 877.8017,-311.3547 886.7378,-317.0466 888.3368,-310.2317"/>
</g>
<!-- sourcefile~util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~util.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/util.f90.html" xlink:title="util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="377.5,-37.3175 323.5,-37.3175 323.5,-13.3175 377.5,-13.3175 377.5,-37.3175"/>
<text text-anchor="middle" x="350.5" y="-22.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M517.5,-25.3175C473.1041,-22.6685 421.951,-23.1941 388.0794,-24.041"/>
<polygon fill="#ff0000" stroke="#ff0000" points="387.6206,-20.5521 377.7198,-24.3236 387.8116,-27.5495 387.6206,-20.5521"/>
</g>
<!-- sourcefile~control_bunch_input.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~control_bunch_input.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/control_bunch_input.f90.html" xlink:title="control_bunch_input.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="588,-555.3175 447,-555.3175 447,-531.3175 588,-531.3175 588,-555.3175"/>
<text text-anchor="middle" x="517.5" y="-540.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">control_bunch_input.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~control_bunch_input.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~control_bunch_input.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M826.5,-543.3175C748.5174,-572.4795 651.5215,-566.2832 587.2261,-556.882"/>
<polygon fill="#ff0000" stroke="#ff0000" points="587.6095,-553.4 577.1958,-555.3506 586.553,-560.3199 587.6095,-553.4"/>
</g>
<!-- sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~mpi_field_interface.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/mpi_field_interface.f90.html" xlink:title="mpi_field_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="894,-353.3175 759,-353.3175 759,-329.3175 894,-329.3175 894,-353.3175"/>
<text text-anchor="middle" x="826.5" y="-338.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_field_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M929.8473,-341.3175C921.4358,-341.3175 912.857,-341.3175 904.418,-341.3175"/>
<polygon fill="#ff0000" stroke="#ff0000" points="904.2141,-337.8176 894.2141,-341.3175 904.2141,-344.8176 904.2141,-337.8176"/>
</g>
<!-- sourcefile~array_alloc.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~array_alloc.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/array_alloc.f90.html" xlink:title="array_alloc.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="872.5,-437.3175 780.5,-437.3175 780.5,-413.3175 872.5,-413.3175 872.5,-437.3175"/>
<text text-anchor="middle" x="826.5" y="-422.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">array_alloc.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~array_alloc.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~array_alloc.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M986.7995,-353.525C965.1477,-367.2649 928.0834,-389.5863 894,-404.3175 889.5184,-406.2545 884.7997,-408.0965 880.0257,-409.8265"/>
<polygon fill="#ff0000" stroke="#ff0000" points="878.5188,-406.6439 870.2073,-413.2143 880.8021,-413.261 878.5188,-406.6439"/>
</g>
<!-- sourcefile~init_grid_fields.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~init_grid_fields.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/init_grid_fields.f90.html" xlink:title="init_grid_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="881,-479.3175 772,-479.3175 772,-455.3175 881,-455.3175 881,-479.3175"/>
<text text-anchor="middle" x="826.5" y="-464.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">init_grid_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~init_grid_fields.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~init_grid_fields.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M995.7875,-353.5764C977.9145,-375.3437 937.6279,-420.8429 894,-446.3175 890.9397,-448.1044 887.7111,-449.7554 884.3909,-451.2783"/>
<polygon fill="#ff0000" stroke="#ff0000" points="882.7487,-448.1704 874.8557,-455.238 885.4334,-454.6352 882.7487,-448.1704"/>
</g>
<!-- sourcefile~code_util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~code_util.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/code_util.f90.html" xlink:title="code_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="238.5,-37.3175 157.5,-37.3175 157.5,-13.3175 238.5,-13.3175 238.5,-37.3175"/>
<text text-anchor="middle" x="198" y="-22.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">code_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~code_util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~code_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1000.1565,-329.301C986.1434,-298.7376 945.8122,-216.6202 894,-162.3175 830.2567,-95.5102 809.8001,-75.8161 723,-44.3175 636.7787,-13.0289 609.06,-30.7806 517.5,-25.3175"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M517.5,-25.3175C469.4575,-20.9042 459.0164,-9.0063 411,-4.3175 357.4768,.9091 343.4396,1.7042 290,-4.3175 276.5079,-5.8378 262.1097,-8.5746 248.8061,-11.5809"/>
<polygon fill="#ff0000" stroke="#ff0000" points="247.8116,-8.2192 238.8791,-13.9167 249.415,-15.0331 247.8116,-8.2192"/>
</g>
<!-- sourcefile~psolve.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~psolve.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/psolve.f90.html" xlink:title="psolve.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="860,-195.3175 793,-195.3175 793,-171.3175 860,-171.3175 860,-195.3175"/>
<text text-anchor="middle" x="826.5" y="-180.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">psolve.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~psolve.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~psolve.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M998.1348,-328.9756C982.221,-303.2797 942.1478,-243.5838 894,-209.3175 886.6406,-204.0798 878.0878,-199.7329 869.5934,-196.1895"/>
<polygon fill="#ff0000" stroke="#ff0000" points="870.684,-192.8589 860.0944,-192.5259 868.165,-199.39 870.684,-192.8589"/>
</g>
<!-- sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~grid_param.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/grid_param.f90.html" xlink:title="grid_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="397.5,-279.3175 303.5,-279.3175 303.5,-255.3175 397.5,-255.3175 397.5,-279.3175"/>
<text text-anchor="middle" x="350.5" y="-264.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M991.042,-329.0634C944.9939,-291.5716 797.5059,-183.3266 673.5,-223.3175"/>
</g>
<!-- sourcefile~grid_part_util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~grid_part_util.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/grid_part_util.f90.html" xlink:title="grid_part_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="878,-395.3175 775,-395.3175 775,-371.3175 878,-371.3175 878,-395.3175"/>
<text text-anchor="middle" x="826.5" y="-380.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_part_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~grid_part_util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~grid_part_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M954.2058,-353.353C933.4213,-358.2298 909.2527,-363.9006 887.5687,-368.9885"/>
<polygon fill="#ff0000" stroke="#ff0000" points="886.7378,-365.5883 877.8017,-371.2802 888.3368,-372.4033 886.7378,-365.5883"/>
</g>
<!-- sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node22" class="node">
<title>sourcefile~precision_def.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node22"><a xlink:href=".././sourcefile/precision_def.f90.html" xlink:title="precision_def.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="106,-217.3175 0,-217.3175 0,-193.3175 106,-193.3175 106,-217.3175"/>
<text text-anchor="middle" x="53" y="-202.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">precision_def.F90</text>
</a>
</g>
</g>
<!-- sourcefile~phys_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~phys_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M624.4695,-500.1813C593.6419,-498.9835 553.1032,-498.8256 517.5,-503.3175"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M787.3009,-311.4063C745.8635,-323.9718 684.9225,-341.7643 673.5,-341.3175"/>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M673.5,-341.3175C602.5933,-338.544 588.3416,-311.4309 517.5,-307.3175"/>
</g>
<!-- sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~pstruct_data.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node15"><a xlink:href=".././sourcefile/pstruct_data.f90.html" xlink:title="pstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="723,-393.3175 624,-393.3175 624,-369.3175 723,-369.3175 723,-393.3175"/>
<text text-anchor="middle" x="673.5" y="-378.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M777.7381,-311.4456C771.2263,-313.9307 764.8018,-316.8675 759,-320.3175 739.8195,-331.7229 741.0645,-342.216 723,-355.3175 718.5308,-358.5588 713.6041,-361.6433 708.6439,-364.4805"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="706.887,-361.4518 699.7708,-369.3011 710.2287,-367.6027 706.887,-361.4518"/>
</g>
<!-- sourcefile~parallel.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node18" class="node">
<title>sourcefile~parallel.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node18"><a xlink:href=".././sourcefile/parallel.f90.html" xlink:title="parallel.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="555.5,-157.3175 479.5,-157.3175 479.5,-133.3175 555.5,-133.3175 555.5,-157.3175"/>
<text text-anchor="middle" x="517.5" y="-142.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">parallel.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M817.6646,-287.0686C793.8723,-254.1604 729.7898,-166.0547 723,-162.3175 674.5126,-135.6289 609.6393,-134.9758 565.8566,-138.6453"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="565.3789,-135.1747 555.7525,-139.6 566.0374,-142.1437 565.3789,-135.1747"/>
</g>
<!-- sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node21" class="node">
<title>sourcefile~fstruct_data.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node21"><a xlink:href=".././sourcefile/fstruct_data.f90.html" xlink:title="fstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="721.5,-435.3175 625.5,-435.3175 625.5,-411.3175 721.5,-411.3175 721.5,-435.3175"/>
<text text-anchor="middle" x="673.5" y="-420.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M772.2453,-311.4353C767.4521,-313.8729 762.9347,-316.8007 759,-320.3175 729.3237,-346.8413 751.319,-374.3491 723,-402.3175 721.8999,-403.4039 720.735,-404.4377 719.5182,-405.421"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="717.2393,-402.7346 710.873,-411.2034 721.131,-408.5531 717.2393,-402.7346"/>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90</title>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M323.2361,-25.3175C302.529,-25.3175 273.4636,-25.3175 248.5457,-25.3175"/>
<polygon fill="#e7ff00" stroke="#e7ff00" points="248.5153,-21.8176 238.5152,-25.3175 248.5152,-28.8176 248.5153,-21.8176"/>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M323.3187,-36.5072C312.7622,-41.0959 300.6676,-46.6554 290,-52.3175 209.2271,-95.1895 120.2015,-156.9154 77.9313,-187.1852"/>
<polygon fill="#e7ff00" stroke="#e7ff00" points="75.7148,-184.4681 69.6408,-193.1489 79.8025,-190.1506 75.7148,-184.4681"/>
</g>
<!-- sourcefile~control_bunch_input.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~control_bunch_input.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M472.7681,-531.2285C439.2957,-522.5187 392.2843,-510.9944 350.5,-503.3175"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M758.6913,-342.4553C732.116,-342.6035 701.3693,-342.4076 673.5,-341.3175"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M780.595,-353.3188C764.4808,-357.5316 746.1982,-362.3114 729.3581,-366.7141"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="728.4264,-363.3399 719.6369,-369.2556 730.197,-370.1123 728.4264,-363.3399"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M776.8132,-329.2644C770.5792,-326.7826 764.4769,-323.8265 759,-320.3175 738.8612,-307.4148 740.5596,-296.5566 723,-280.3175 682.2754,-242.6553 665.2027,-241.4561 624,-204.3175 606.7194,-188.7414 607.8218,-178.4966 588,-166.3175 581.0377,-162.0397 573.1516,-158.5884 565.2385,-155.8177"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="566.2234,-152.4582 555.633,-152.7658 564.1036,-159.1296 566.2234,-152.4582"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M776.8132,-353.3705C770.5792,-355.8523 764.4769,-358.8085 759,-362.3175 738.8612,-375.2201 742.4715,-388.4282 723,-402.3175 720.9386,-403.7879 718.7582,-405.1825 716.5074,-406.5009"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="714.7931,-403.4479 707.5783,-411.2066 718.0568,-409.6406 714.7931,-403.4479"/>
</g>
<!-- sourcefile~array_alloc.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~array_alloc.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#00ffb9" stroke-dasharray="5,2" d="M784.6921,-413.2943C766.2238,-407.9831 744.3331,-401.6878 724.8801,-396.0935"/>
<polygon fill="#00ffb9" stroke="#00ffb9" points="725.8352,-392.7263 715.2574,-393.3261 723.9005,-399.4537 725.8352,-392.7263"/>
</g>
<!-- sourcefile~array_alloc.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~array_alloc.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#00ffb9" stroke-dasharray="5,2" d="M780.1798,-424.712C764.9563,-424.513 747.834,-424.2892 731.8364,-424.08"/>
<polygon fill="#00ffb9" stroke="#00ffb9" points="731.5623,-420.5763 721.5174,-423.9452 731.4708,-427.5757 731.5623,-420.5763"/>
</g>
<!-- sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~phys_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~phys_param.f90</title>
<path fill="none" stroke="#00b9ff" stroke-dasharray="5,2" d="M775.1276,-479.4051C761.5055,-482.6103 746.6875,-486.0969 732.6862,-489.3913"/>
<polygon fill="#00b9ff" stroke="#00b9ff" points="731.5967,-486.052 722.6642,-491.7494 733.2,-492.8659 731.5967,-486.052"/>
</g>
<!-- sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge29" class="edge">
<title>sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#00b9ff" stroke-dasharray="5,2" d="M775.9523,-455.2183C769.9899,-452.7559 764.1893,-449.8172 759,-446.3175 738.0518,-432.1898 743.2189,-417.4705 723,-402.3175 721.1488,-400.9301 719.1922,-399.6146 717.1679,-398.3699"/>
<polygon fill="#00b9ff" stroke="#00b9ff" points="718.4323,-395.0732 707.9762,-393.3643 715.0844,-401.2207 718.4323,-395.0732"/>
</g>
<!-- sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node20" class="node">
<title>sourcefile~grid_field_param.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node20"><a xlink:href=".././sourcefile/grid_field_param.f90.html" xlink:title="grid_field_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="579,-237.3175 456,-237.3175 456,-213.3175 579,-213.3175 579,-237.3175"/>
<text text-anchor="middle" x="517.5" y="-222.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_field_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90</title>
<path fill="none" stroke="#00b9ff" stroke-dasharray="5,2" d="M771.9384,-477.3032C726.4603,-482.2584 663.0185,-480.8144 624,-444.3175 558.679,-383.2178 647.6848,-312.9337 588,-246.3175 587.1132,-245.3277 586.1819,-244.3836 585.2114,-243.4832"/>
<polygon fill="#00b9ff" stroke="#00b9ff" points="587.1883,-240.5911 577.0849,-237.4016 582.9941,-246.1955 587.1883,-240.5911"/>
</g>
<!-- sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#00b9ff" stroke-dasharray="5,2" d="M784.6921,-455.2943C766.2238,-449.9831 744.3331,-443.6878 724.8801,-438.0935"/>
<polygon fill="#00b9ff" stroke="#00b9ff" points="725.8352,-434.7263 715.2574,-435.3261 723.9005,-441.4537 725.8352,-434.7263"/>
</g>
<!-- sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge30" class="edge">
<title>sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#002eff" stroke-dasharray="5,2" d="M180.6934,-37.4157C169.003,-46.0732 153.6394,-58.4338 142,-71.3175 109.343,-107.4657 79.8688,-156.566 64.402,-184.1849"/>
<polygon fill="#002eff" stroke="#002eff" points="61.3034,-182.5559 59.5331,-193.0018 67.4311,-185.9398 61.3034,-182.5559"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge36" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M792.7589,-190.984C761.547,-198.3475 714.0016,-210.256 673.5,-223.3175"/>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M673.5,-223.3175C628.0696,-237.9684 630.8436,-267.27 588,-288.3175 558.8736,-302.6262 549.8967,-309.1986 517.5,-307.3175"/>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M517.5,-307.3175C475.1528,-304.8586 428.2916,-292.777 395.015,-282.5286"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="395.7335,-279.0854 385.1439,-279.4196 393.6305,-285.7621 395.7335,-279.0854"/>
</g>
<!-- sourcefile~prl_fft.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~prl_fft.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/prl_fft.f90.html" xlink:title="prl_fft.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="705.5,-77.3175 641.5,-77.3175 641.5,-53.3175 705.5,-53.3175 705.5,-77.3175"/>
<text text-anchor="middle" x="673.5" y="-62.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">prl_fft.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge31" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M814.8783,-171.2467C796.5243,-152.6036 759.183,-116.3458 723,-91.3175 718.4096,-88.1422 713.384,-85.0817 708.3504,-82.2445"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="709.8362,-79.0693 699.3734,-77.4022 706.513,-85.2302 709.8362,-79.0693"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge32" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M816.8017,-195.4381C802.9687,-213.0471 777.2317,-247.0252 759,-278.3175 739.9821,-310.9592 749.0873,-327.9933 723,-355.3175 719.8998,-358.5647 716.3041,-361.4872 712.4932,-364.0964"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="710.6413,-361.1261 703.9153,-369.3122 714.2782,-367.1072 710.6413,-361.1261"/>
</g>
<!-- sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node16" class="node">
<title>sourcefile~common_param.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node16"><a xlink:href=".././sourcefile/common_param.f90.html" xlink:title="common_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="411,-195.3175 290,-195.3175 290,-171.3175 411,-171.3175 411,-195.3175"/>
<text text-anchor="middle" x="350.5" y="-180.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">common_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge33" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M806.7271,-171.2382C786.4967,-159.5463 753.756,-142.4351 723,-134.3175 604.3172,-102.9926 565.1556,-91.0592 447,-124.3175 419.0965,-132.1717 391.2857,-150.5864 372.7391,-164.7706"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="370.3516,-162.1957 364.6609,-171.1326 374.6826,-167.6951 370.3516,-162.1957"/>
</g>
<!-- sourcefile~grid_fields.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node19" class="node">
<title>sourcefile~grid_fields.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node19"><a xlink:href=".././sourcefile/grid_fields.f90.html" xlink:title="grid_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="717.5,-195.3175 629.5,-195.3175 629.5,-171.3175 717.5,-171.3175 717.5,-195.3175"/>
<text text-anchor="middle" x="673.5" y="-180.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge34" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M792.9235,-183.3175C773.8629,-183.3175 749.5461,-183.3175 727.8358,-183.3175"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="727.7484,-179.8176 717.7483,-183.3175 727.7483,-186.8176 727.7484,-179.8176"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge35" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M815.8836,-195.3703C801.1823,-212.6292 774.6697,-245.8915 759,-278.3175 734.0307,-329.9873 761.1007,-359.404 723,-402.3175 722.1284,-403.2991 721.2032,-404.2363 720.233,-405.131"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="718.0067,-402.4244 712.0529,-411.1881 722.1723,-408.05 718.0067,-402.4244"/>
</g>
<!-- sourcefile~struct_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~struct_def.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/struct_def.f90.html" xlink:title="struct_def.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="240.5,-279.3175 155.5,-279.3175 155.5,-255.3175 240.5,-255.3175 240.5,-279.3175"/>
<text text-anchor="middle" x="198" y="-264.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">struct_def.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_param.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge37" class="edge">
<title>sourcefile~grid_param.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M303.084,-267.3175C286.5752,-267.3175 267.9516,-267.3175 251.018,-267.3175"/>
<polygon fill="#e700ff" stroke="#e700ff" points="250.727,-263.8176 240.7269,-267.3175 250.7269,-270.8176 250.727,-263.8176"/>
</g>
<!-- sourcefile~grid_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge38" class="edge">
<title>sourcefile~grid_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M313.2393,-255.2136C275.7067,-243.3565 220.26,-226.8454 198,-225.3175"/>
</g>
<!-- sourcefile~grid_part_util.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge41" class="edge">
<title>sourcefile~grid_part_util.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#ff008b" stroke-dasharray="5,2" d="M774.7012,-382.6404C761.4373,-382.467 747.0635,-382.2791 733.4277,-382.1008"/>
<polygon fill="#ff008b" stroke="#ff008b" points="733.2196,-378.5979 723.1747,-381.9668 733.1281,-385.5973 733.2196,-378.5979"/>
</g>
<!-- sourcefile~grid_part_lib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node17" class="node">
<title>sourcefile~grid_part_lib.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node17"><a xlink:href=".././sourcefile/grid_part_lib.f90.html" xlink:title="grid_part_lib.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="723,-313.3175 624,-313.3175 624,-289.3175 723,-289.3175 723,-313.3175"/>
<text text-anchor="middle" x="673.5" y="-298.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_part_lib.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_part_util.f90&#45;&gt;sourcefile~grid_part_lib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge40" class="edge">
<title>sourcefile~grid_part_util.f90&#45;&gt;sourcefile~grid_part_lib.f90</title>
<path fill="none" stroke="#ff008b" stroke-dasharray="5,2" d="M777.7381,-371.1893C771.2263,-368.7043 764.8018,-365.7674 759,-362.3175 739.8195,-350.912 741.0645,-340.419 723,-327.3175 718.5308,-324.0761 713.6041,-320.9917 708.6439,-318.1544"/>
<polygon fill="#ff008b" stroke="#ff008b" points="710.2287,-315.0323 699.7708,-313.3339 706.887,-321.1831 710.2287,-315.0323"/>
</g>
<!-- sourcefile~grid_part_util.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge39" class="edge">
<title>sourcefile~grid_part_util.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#ff008b" stroke-dasharray="5,2" d="M780.595,-395.3188C764.4808,-399.5316 746.1982,-404.3114 729.3581,-408.7141"/>
<polygon fill="#ff008b" stroke="#ff008b" points="728.4264,-405.3399 719.6369,-411.2556 730.197,-412.1123 728.4264,-405.3399"/>
</g>
<!-- sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge42" class="edge">
<title>sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M169.6983,-255.2161C147.143,-245.5717 115.3585,-231.9811 90.6554,-221.4184"/>
<polygon fill="#ff0000" stroke="#ff0000" points="91.8011,-218.1018 81.2303,-217.3884 89.049,-224.5381 91.8011,-218.1018"/>
</g>
<!-- sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge44" class="edge">
<title>sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M649.807,-77.4678C623.1955,-91.1146 579.8417,-113.3474 550.0592,-128.6204"/>
<polygon fill="#ff9900" stroke="#ff9900" points="548.2059,-125.6374 540.9049,-133.315 551.4002,-131.8661 548.2059,-125.6374"/>
</g>
<!-- sourcefile~modern_fft_lib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node23" class="node">
<title>sourcefile~modern_fft_lib.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node23"><a xlink:href=".././sourcefile/modern_fft_lib.f90.html" xlink:title="modern_fft_lib.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="254,-177.3175 142,-177.3175 142,-153.3175 254,-153.3175 254,-177.3175"/>
<text text-anchor="middle" x="198" y="-162.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modern_fft_lib.F90</text>
</a>
</g>
</g>
<!-- sourcefile~prl_fft.f90&#45;&gt;sourcefile~modern_fft_lib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge43" class="edge">
<title>sourcefile~prl_fft.f90&#45;&gt;sourcefile~modern_fft_lib.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M641.4444,-69.4456C597.4034,-75.3367 515.8103,-87.0389 447,-101.3175 378.1673,-115.6007 299.7813,-136.5337 249.6511,-150.5278"/>
<polygon fill="#ff9900" stroke="#ff9900" points="248.6968,-147.1603 240.013,-153.23 250.5866,-153.9004 248.6968,-147.1603"/>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge45" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M643.4262,-393.3714C574.4443,-420.3335 406.4736,-481.8927 350.5,-465.3175"/>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M350.5,-465.3175C265.5351,-447.9234 220.2805,-336.9836 204.5229,-289.1817"/>
<polygon fill="#cbff00" stroke="#cbff00" points="207.8079,-287.9618 201.4494,-279.4871 201.1352,-290.0773 207.8079,-287.9618"/>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge46" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M350.5,-465.3175C284.0994,-451.7239 254.2056,-503.1957 198,-465.3175"/>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M198,-465.3175C111.3709,-406.9362 71.1468,-278.6656 58.0529,-227.2606"/>
<polygon fill="#cbff00" stroke="#cbff00" points="61.4432,-226.3904 55.6636,-217.5108 54.6444,-228.0565 61.4432,-226.3904"/>
</g>
<!-- sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge47" class="edge">
<title>sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#33ff00" stroke-dasharray="5,2" d="M311.796,-195.4156C270.4826,-208.0985 209.404,-226.1003 198,-225.3175"/>
<path fill="none" stroke="#33ff00" stroke-dasharray="5,2" d="M198,-225.3175C171.1498,-223.4745 141.6988,-219.7334 116.3944,-215.9801"/>
<polygon fill="#33ff00" stroke="#33ff00" points="116.6006,-212.4714 106.189,-214.433 115.5514,-219.3924 116.6006,-212.4714"/>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge49" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M623.9447,-305.6604C593.27,-307.7438 553.081,-309.3835 517.5,-307.3175"/>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge48" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M643.2108,-289.1898C636.3299,-285.461 629.4515,-280.848 624,-275.3175 599.163,-250.1207 617.3027,-224.1443 588,-204.3175 539.4888,-171.4939 472.0444,-168.5401 421.4183,-172.4641"/>
<polygon fill="#00ff66" stroke="#00ff66" points="420.8595,-168.9997 411.206,-173.3655 421.475,-175.9726 420.8595,-168.9997"/>
</g>
<!-- sourcefile~stretched_grid.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node25" class="node">
<title>sourcefile~stretched_grid.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node25"><a xlink:href=".././sourcefile/stretched_grid.f90.html" xlink:title="stretched_grid.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="572,-279.3175 463,-279.3175 463,-255.3175 572,-255.3175 572,-279.3175"/>
<text text-anchor="middle" x="517.5" y="-264.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">stretched_grid.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~stretched_grid.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge50" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~stretched_grid.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M623.7117,-290.4662C610.5091,-287.5887 596.0603,-284.4396 582.1901,-281.4166"/>
<polygon fill="#00ff66" stroke="#00ff66" points="582.7347,-277.9532 572.2187,-279.2434 581.244,-284.7927 582.7347,-277.9532"/>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge53" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M500.5681,-133.1509C471.0607,-111.9479 410.0809,-68.1301 375.6288,-43.3741"/>
<polygon fill="#00ffff" stroke="#00ffff" points="377.64,-40.5094 367.4767,-37.5163 373.5552,-46.194 377.64,-40.5094"/>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge52" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M479.1868,-154.0354C459.7295,-158.4628 435.5879,-163.9562 413.4893,-168.9846"/>
<polygon fill="#00ffff" stroke="#00ffff" points="412.478,-165.6251 403.5038,-171.2567 414.0312,-172.4507 412.478,-165.6251"/>
</g>
<!-- sourcefile~mpi_var.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node24" class="node">
<title>sourcefile~mpi_var.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node24"><a xlink:href=".././sourcefile/mpi_var.f90.html" xlink:title="mpi_var.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="388,-237.3175 313,-237.3175 313,-213.3175 388,-213.3175 388,-237.3175"/>
<text text-anchor="middle" x="350.5" y="-222.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_var.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge51" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M498.0019,-157.4572C477.0335,-170.1909 442.4594,-190.2686 411,-204.3175 406.66,-206.2556 402.0824,-208.132 397.4676,-209.9133"/>
<polygon fill="#00ffff" stroke="#00ffff" points="396.1637,-206.6639 388.0069,-213.4253 398.5998,-213.2263 396.1637,-206.6639"/>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge55" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M629.2139,-172.5298C609.3325,-167.6869 585.8325,-161.9626 565.5281,-157.0166"/>
<polygon fill="#0066ff" stroke="#0066ff" points="566.0877,-153.5507 555.5434,-154.5845 564.4309,-160.3518 566.0877,-153.5507"/>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge54" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M629.2139,-195.2406C611.423,-200.0305 590.7344,-205.6005 572.031,-210.636"/>
<polygon fill="#0066ff" stroke="#0066ff" points="570.9137,-207.3122 562.1674,-213.2916 572.7335,-214.0715 570.9137,-207.3122"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge58" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#3200ff" stroke-dasharray="5,2" d="M469.6445,-237.353C450.2625,-242.2275 427.726,-247.8954 407.503,-252.9814"/>
<polygon fill="#3200ff" stroke="#3200ff" points="406.6294,-249.592 397.7851,-255.4254 408.3368,-256.3806 406.6294,-249.592"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge57" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#3200ff" stroke-dasharray="5,2" d="M469.6445,-213.282C450.5155,-208.4711 428.3139,-202.8874 408.2961,-197.853"/>
<polygon fill="#3200ff" stroke="#3200ff" points="408.9142,-194.3995 398.3625,-195.3547 407.2068,-201.1881 408.9142,-194.3995"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge56" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#3200ff" stroke-dasharray="5,2" d="M455.7898,-225.3175C436.8382,-225.3175 416.2765,-225.3175 398.3952,-225.3175"/>
<polygon fill="#3200ff" stroke="#3200ff" points="398.2091,-221.8176 388.2091,-225.3175 398.2091,-228.8176 398.2091,-221.8176"/>
</g>
<!-- sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge59" class="edge">
<title>sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M658.7647,-435.4087C632.4036,-455.9437 574.5734,-496.1168 517.5,-503.3175"/>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M517.5,-503.3175C443.8615,-512.608 423.5004,-516.7296 350.5,-503.3175"/>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M350.5,-503.3175C281.7996,-490.6954 255.9242,-504.3539 198,-465.3175"/>
</g>
<!-- sourcefile~modern_fft_lib.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge60" class="edge">
<title>sourcefile~modern_fft_lib.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M154.4952,-177.3188C139.3664,-181.4923 122.2207,-186.2221 106.3852,-190.5905"/>
<polygon fill="#ff0000" stroke="#ff0000" points="105.4336,-187.2222 96.7245,-193.2556 107.2952,-193.9702 105.4336,-187.2222"/>
</g>
<!-- sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge61" class="edge">
<title>sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M312.8483,-226.7502C281.9538,-227.5815 237.092,-228.0008 198,-225.3175"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge64" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M462.818,-267.3175C445.2443,-267.3175 425.7294,-267.3175 407.9623,-267.3175"/>
<polygon fill="#0000ff" stroke="#0000ff" points="407.7312,-263.8176 397.7311,-267.3175 407.7311,-270.8176 407.7312,-263.8176"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge63" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M464.7884,-255.3087C458.5472,-252.8312 452.4629,-249.8642 447,-246.3175 426.3793,-232.9298 431.3171,-218.1616 411,-204.3175 408.5882,-202.674 406.0348,-201.1468 403.3944,-199.7293"/>
<polygon fill="#0000ff" stroke="#0000ff" points="404.6927,-196.4709 394.1602,-195.3228 401.6779,-202.7884 404.6927,-196.4709"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge62" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M469.6445,-255.282C447.1609,-249.6274 420.4326,-242.9053 397.9946,-237.2622"/>
<polygon fill="#0000ff" stroke="#0000ff" points="398.5696,-233.7979 388.0179,-234.7531 396.8622,-240.5865 398.5696,-233.7979"/>
</g>
</g>
</svg>
</div><script>var pansourcefileinit_beam_part_distribf90EfferentGraph = svgPanZoom('#sourcefileinit_beam_part_distribf90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~init_beam_part_distrib.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileinit_beam_part_distribf90AfferentGraph" width="271pt" height="32pt"
 viewBox="0.00 0.00 271.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~init_beam_part_distrib.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>sourcefile~~init_beam_part_distrib.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 267,-28 267,4 -4,4"/>
<!-- sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~init_beam_part_distrib.f90</title>
<polygon fill="none" stroke="#000000" points="151,-24 0,-24 0,0 151,0 151,-24"/>
<text text-anchor="middle" x="75.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">init_beam_part_distrib.f90</text>
</g>
<!-- sourcefile~aladyn.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~aladyn.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/aladyn.f90.html" xlink:title="ALaDyn.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="263,-24 187,-24 187,0 263,0 263,-24"/>
<text text-anchor="middle" x="225" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALaDyn.F90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~init_beam_part_distrib.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M186.888,-12C178.9054,-12 170.1823,-12 161.2447,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="161.0909,-8.5001 151.0909,-12 161.0909,-15.5001 161.0909,-8.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/init_beam_part_distrib.html">init_beam_part_distrib</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/init_beam_part_distrib.f90.html#src">init_beam_part_distrib.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-2"></a><span class="c">!                            Copyright 2008-2020  The ALaDyn Collaboration                            !</span>
<a name="ln-3"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-4"></a>
<a name="ln-5"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-6"></a><span class="c">!  This file is part of ALaDyn.                                                                       !</span>
<a name="ln-7"></a><span class="c">!                                                                                                     !</span>
<a name="ln-8"></a><span class="c">!  ALaDyn is free software: you can redistribute it and/or modify                                     !</span>
<a name="ln-9"></a><span class="c">!  it under the terms of the GNU General Public License as published by                               !</span>
<a name="ln-10"></a><span class="c">!  the Free Software Foundation, either version 3 of the License, or                                  !</span>
<a name="ln-11"></a><span class="c">!  (at your option) any later version.                                                                !</span>
<a name="ln-12"></a><span class="c">!                                                                                                     !</span>
<a name="ln-13"></a><span class="c">!  ALaDyn is distributed in the hope that it will be useful,                                          !</span>
<a name="ln-14"></a><span class="c">!  but WITHOUT ANY WARRANTY; without even the implied warranty of                                     !</span>
<a name="ln-15"></a><span class="c">!  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                      !</span>
<a name="ln-16"></a><span class="c">!  GNU General Public License for more details.                                                       !</span>
<a name="ln-17"></a><span class="c">!                                                                                                     !</span>
<a name="ln-18"></a><span class="c">!  You should have received a copy of the GNU General Public License                                  !</span>
<a name="ln-19"></a><span class="c">!  along with ALaDyn.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                                    !</span>
<a name="ln-20"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-21"></a>
<a name="ln-22"></a> <span class="k">module </span><span class="n">init_beam_part_distrib</span>
<a name="ln-23"></a>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">util</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">psolve</span>
<a name="ln-26"></a>  <span class="k">use </span><span class="n">array_alloc</span>
<a name="ln-27"></a>  <span class="k">use </span><span class="n">grid_param</span>
<a name="ln-28"></a>  <span class="k">use </span><span class="n">mpi_field_interface</span>
<a name="ln-29"></a>  <span class="k">use </span><span class="n">mpi_curr_interface</span>
<a name="ln-30"></a>  <span class="k">use </span><span class="n">init_grid_field</span>
<a name="ln-31"></a>  <span class="k">use </span><span class="n">grid_part_util</span>
<a name="ln-32"></a>  <span class="k">use </span><span class="n">code_util</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">maxv</span><span class="p">,</span> <span class="n">mem_psize</span>
<a name="ln-33"></a>  <span class="k">use </span><span class="n">control_bunch_input</span>
<a name="ln-34"></a>  <span class="k">use </span><span class="n">phys_param</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">t_unit</span>
<a name="ln-35"></a>
<a name="ln-36"></a>  <span class="k">implicit none</span>
<a name="ln-37"></a>
<a name="ln-38"></a><span class="k">  </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">bpart</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-39"></a>  <span class="c">!--------------------------</span>
<a name="ln-40"></a>
<a name="ln-41"></a> <span class="k">contains</span>
<a name="ln-42"></a>  <span class="c">!=========================</span>
<a name="ln-43"></a>  <span class="k">subroutine </span><span class="n">beam_data</span><span class="p">(</span><span class="n">ndm</span><span class="p">)</span> <span class="c">!generates bunch phase space distribution in</span>
<a name="ln-44"></a>   <span class="c">!                             ebfb(npart,nch)</span>
<a name="ln-45"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ndm</span>
<a name="ln-46"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">np_tot</span>
<a name="ln-47"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">ip</span>
<a name="ln-48"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cut</span><span class="p">,</span> <span class="n">xb</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">jp_norm</span>
<a name="ln-49"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nch</span>
<a name="ln-50"></a>   <span class="kt">logical</span> <span class="kd">::</span> <span class="n">data_snd</span>
<a name="ln-51"></a>   <span class="c">!==========================================================</span>
<a name="ln-52"></a>   <span class="c">! bconf defines only the configuration of bunch charges</span>
<a name="ln-53"></a>   <span class="c">!=======================</span>
<a name="ln-54"></a>   <span class="c">! default values</span>
<a name="ln-55"></a>   <span class="c">!=======================</span>
<a name="ln-56"></a>   <span class="n">jp_norm</span> <span class="o">=</span> <span class="mf">1.</span>
<a name="ln-57"></a>   <span class="n">np_tot</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-58"></a>   <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-59"></a>    <span class="n">np_tot</span> <span class="o">=</span> <span class="n">np_tot</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-60"></a>   <span class="k">end do</span>
<a name="ln-61"></a><span class="k">   </span><span class="n">cut</span> <span class="o">=</span> <span class="mf">3.</span>
<a name="ln-62"></a>   <span class="n">nch</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">ndm</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-63"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">np_tot</span><span class="p">,</span> <span class="n">nch</span><span class="p">))</span>
<a name="ln-64"></a>   <span class="c">!---!</span>
<a name="ln-65"></a>   <span class="n">i1</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-66"></a>   <span class="n">charge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">unit_charge</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">hp_int</span><span class="p">)</span> <span class="c">!the particle charge of each electron bunche</span>
<a name="ln-67"></a>   <span class="c">!===============================</span>
<a name="ln-68"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>                 <span class="c">!only pe0 generates particle distribution</span>
<a name="ln-69"></a>    <span class="k">select case</span> <span class="p">(</span><span class="n">ndm</span><span class="p">)</span>
<a name="ln-70"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-71"></a>     <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-72"></a>      <span class="n">xb</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="o">=</span> <span class="n">xc_bunch</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-73"></a>      <span class="n">wgh</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">jp_norm</span><span class="o">*</span><span class="n">jb_norm</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">sp</span><span class="p">)</span> <span class="c">!the bunch particle weight</span>
<a name="ln-74"></a>      <span class="n">part_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">hp_int</span><span class="p">)</span>
<a name="ln-75"></a>      <span class="n">i2</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-76"></a>      <span class="k">call </span><span class="n">bunch_gen</span><span class="p">(</span><span class="n">ndm</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">sxb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">syb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">syb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">gam</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-77"></a>                     <span class="n">epsy</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">epsz</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">cut</span><span class="p">,</span> <span class="n">dg</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">)</span>
<a name="ln-78"></a>
<a name="ln-79"></a>      <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">xb</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="c">!x-shifting</span>
<a name="ln-80"></a>      <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">yc_bunch</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="c">!y-shifting</span>
<a name="ln-81"></a>      <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="n">nch</span><span class="p">)</span> <span class="o">=</span> <span class="n">wgh_cmp</span>
<a name="ln-82"></a>      <span class="n">i1</span> <span class="o">=</span> <span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-83"></a>     <span class="k">end do</span>
<a name="ln-84"></a><span class="k">    case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-85"></a>     <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-86"></a>      <span class="n">xb</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="o">=</span> <span class="n">xc_bunch</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-87"></a>      <span class="n">wgh</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">jp_norm</span><span class="o">*</span><span class="n">jb_norm</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">sp</span><span class="p">)</span> <span class="c">!the bunch particle weights</span>
<a name="ln-88"></a>      <span class="n">part_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">hp_int</span><span class="p">)</span>
<a name="ln-89"></a>      <span class="n">i2</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-90"></a><span class="c">!====================</span>
<a name="ln-91"></a>      <span class="k">call </span><span class="n">bunch_gen</span><span class="p">(</span><span class="n">ndm</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">sxb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">syb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">syb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">gam</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-92"></a>                     <span class="n">epsy</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">epsz</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">cut</span><span class="p">,</span> <span class="n">dg</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">)</span>
<a name="ln-93"></a><span class="c">!=====================</span>
<a name="ln-94"></a>      <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">xb</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="c">!x-shifting</span>
<a name="ln-95"></a>      <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">yc_bunch</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="c">!y-shifting</span>
<a name="ln-96"></a>      <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">zc_bunch</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="c">!y-shifting</span>
<a name="ln-97"></a>      <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="n">nch</span><span class="p">)</span> <span class="o">=</span> <span class="n">wgh_cmp</span>
<a name="ln-98"></a>      <span class="n">i1</span> <span class="o">=</span> <span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-99"></a>     <span class="k">end do</span>
<a name="ln-100"></a><span class="k">    end select</span>
<a name="ln-101"></a><span class="k">    </span><span class="n">data_snd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>            <span class="c">!pe0 sends data to all mpi-task</span>
<a name="ln-102"></a>    <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-103"></a>     <span class="k">call </span><span class="n">exchange_2d_grdata</span><span class="p">(</span><span class="n">data_snd</span><span class="p">,</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">nch</span><span class="p">,</span> <span class="n">np_tot</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">ip</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
<a name="ln-104"></a>    <span class="k">end do</span>
<a name="ln-105"></a><span class="k">   else</span>
<a name="ln-106"></a><span class="k">    </span><span class="n">data_snd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>           <span class="c">!current mype mpi-task receves particle data for pe0</span>
<a name="ln-107"></a>    <span class="k">call </span><span class="n">exchange_2d_grdata</span><span class="p">(</span><span class="n">data_snd</span><span class="p">,</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">nch</span><span class="p">,</span> <span class="n">np_tot</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mype</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
<a name="ln-108"></a>   <span class="k">end if</span>
<a name="ln-109"></a>   <span class="c">!==============================</span>
<a name="ln-110"></a>  <span class="k">end subroutine</span>
<a name="ln-111"></a>  <span class="c">!===================</span>
<a name="ln-112"></a>  <span class="k">subroutine </span><span class="n">mpi_beam_ftgrid_distribute</span><span class="p">(</span><span class="n">ndm</span><span class="p">)</span>
<a name="ln-113"></a>
<a name="ln-114"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ndm</span>
<a name="ln-115"></a>
<a name="ln-116"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-117"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ic</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">ipp</span><span class="p">,</span> <span class="n">nb_loc</span>
<a name="ln-118"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span>
<a name="ln-119"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nps_loc</span><span class="p">(</span><span class="n">nsb</span><span class="p">),</span> <span class="n">npmax</span><span class="p">,</span> <span class="n">np_tot</span>
<a name="ln-120"></a>   <span class="c">!========= count bunch particles on each (yz) MPI domain in uniform ftgrid</span>
<a name="ln-121"></a>   <span class="n">np_tot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nb_tot</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-122"></a>   <span class="c">! ALL MPI tasks do</span>
<a name="ln-123"></a>   <span class="n">x1</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-124"></a>   <span class="n">x2</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-125"></a>   <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-126"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">ndm</span><span class="p">)</span>
<a name="ln-127"></a><span class="c">!================== 1:   counts local bunch particles of each bunch</span>
<a name="ln-128"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-129"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-130"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-131"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-132"></a>      <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-133"></a>       <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-134"></a>       <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-135"></a>       <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-136"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-137"></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">j</span>
<a name="ln-138"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-139"></a><span class="k">         if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-140"></a><span class="k">          </span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-141"></a>         <span class="k">end if</span>
<a name="ln-142"></a><span class="k">        end if</span>
<a name="ln-143"></a><span class="k">       end do</span>
<a name="ln-144"></a><span class="k">      end do</span>
<a name="ln-145"></a><span class="k">     end do</span>
<a name="ln-146"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-147"></a>    <span class="k">end do</span>
<a name="ln-148"></a><span class="k">    </span><span class="n">nb_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-149"></a>                               <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-150"></a>    <span class="n">nb_min</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-151"></a>                               <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-152"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-153"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-154"></a>      <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-155"></a>       <span class="n">i</span> <span class="o">=</span> <span class="n">ipp</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="p">(</span><span class="n">ip</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-156"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">==</span> <span class="n">nb_max</span><span class="p">)</span> <span class="n">pe_nbmax</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-157"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">==</span> <span class="n">nb_min</span><span class="p">)</span> <span class="n">pe_nbmin</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-158"></a>      <span class="k">end do</span>
<a name="ln-159"></a><span class="k">     end do</span>
<a name="ln-160"></a><span class="k">    end do</span>
<a name="ln-161"></a>    <span class="c">!==================</span>
<a name="ln-162"></a>    <span class="c">! The local particle number of each bunch</span>
<a name="ln-163"></a>    <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-164"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-165"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-166"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-167"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-168"></a>    <span class="k">else</span>
<a name="ln-169"></a><span class="k">     deallocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">)</span>
<a name="ln-170"></a>     <span class="k">allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-171"></a>    <span class="k">end if</span>
<a name="ln-172"></a>    <span class="c">!=================================</span>
<a name="ln-173"></a>    <span class="c">!                            2: selected particle coordinates are copied in</span>
<a name="ln-174"></a>    <span class="c">!                            bunch%part array</span>
<a name="ln-175"></a>    <span class="n">nb_loc</span> <span class="o">=</span> <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-176"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-177"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-178"></a>    <span class="n">ipp</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-179"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-180"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-181"></a>    <span class="c">!=========================</span>
<a name="ln-182"></a>    <span class="c">! Here 2D MPI decomp. allowed</span>
<a name="ln-183"></a>    <span class="c">!===================================</span>
<a name="ln-184"></a>    <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-185"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-186"></a>     <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-187"></a>     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-188"></a>      <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">i1</span>
<a name="ln-189"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-190"></a><span class="k">       if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-191"></a><span class="k">        </span><span class="n">ii</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-192"></a>        <span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-193"></a>       <span class="k">end if</span>
<a name="ln-194"></a><span class="k">      end if</span>
<a name="ln-195"></a><span class="k">     end do</span>
<a name="ln-196"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-197"></a>    <span class="k">end do</span>
<a name="ln-198"></a><span class="c">!================== 1:   counts local bunch particles of each bunch</span>
<a name="ln-199"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-200"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-201"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-202"></a>      <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-203"></a>       <span class="n">z1</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-204"></a>       <span class="n">z2</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-205"></a>       <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-206"></a>        <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-207"></a>        <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-208"></a>        <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-209"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-210"></a>         <span class="n">i</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">j</span>
<a name="ln-211"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-212"></a><span class="k">          if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">z1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">z2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-213"></a><span class="k">           if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-214"></a><span class="k">            </span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-215"></a>           <span class="k">end if</span>
<a name="ln-216"></a><span class="k">          end if</span>
<a name="ln-217"></a><span class="k">         end if</span>
<a name="ln-218"></a><span class="k">        end do</span>
<a name="ln-219"></a><span class="k">       end do</span>
<a name="ln-220"></a><span class="k">      end do</span>
<a name="ln-221"></a><span class="k">     end do</span>
<a name="ln-222"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-223"></a>    <span class="k">end do</span>
<a name="ln-224"></a><span class="k">    </span><span class="n">nb_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-225"></a>                               <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-226"></a>    <span class="n">nb_min</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-227"></a>                               <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-228"></a>    <span class="c">!==================</span>
<a name="ln-229"></a>    <span class="c">! The local MPI task</span>
<a name="ln-230"></a>    <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-231"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-232"></a>    <span class="c">!==================</span>
<a name="ln-233"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-234"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-235"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-236"></a>    <span class="k">else</span>
<a name="ln-237"></a><span class="k">     deallocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">)</span>
<a name="ln-238"></a>     <span class="k">allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-239"></a>    <span class="k">end if</span>
<a name="ln-240"></a>    <span class="c">!=================================</span>
<a name="ln-241"></a>    <span class="c">!                            2: selected particle coordinates are copied in</span>
<a name="ln-242"></a>    <span class="c">!                            bunch%part array</span>
<a name="ln-243"></a>    <span class="n">nb_loc</span> <span class="o">=</span> <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-244"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-245"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-246"></a>    <span class="n">z1</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-247"></a>    <span class="n">z2</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-248"></a>    <span class="n">ipp</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-249"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-250"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-251"></a>    <span class="c">!=========================</span>
<a name="ln-252"></a>    <span class="c">! Here 3D MPI decomp. allowed</span>
<a name="ln-253"></a>    <span class="c">!===================================</span>
<a name="ln-254"></a>    <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-255"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-256"></a>     <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-257"></a>     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-258"></a>      <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">i1</span>
<a name="ln-259"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-260"></a><span class="k">       if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">z1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">z2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-261"></a><span class="k">        if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-262"></a><span class="k">         </span><span class="n">ii</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-263"></a>         <span class="n">bunch</span><span class="p">(</span><span class="n">ic</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-264"></a>        <span class="k">end if</span>
<a name="ln-265"></a><span class="k">       end if</span>
<a name="ln-266"></a><span class="k">      end if</span>
<a name="ln-267"></a><span class="k">     end do</span>
<a name="ln-268"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-269"></a>    <span class="k">end do</span>
<a name="ln-270"></a><span class="k">   end select</span>
<a name="ln-271"></a><span class="k">  end subroutine</span>
<a name="ln-272"></a>  <span class="c">!=================================</span>
<a name="ln-273"></a>  <span class="k">subroutine </span><span class="n">mpi_beam_distribute</span><span class="p">(</span><span class="n">ndm</span><span class="p">)</span>
<a name="ln-274"></a>
<a name="ln-275"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ndm</span>
<a name="ln-276"></a>
<a name="ln-277"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-278"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ic</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">ipp</span><span class="p">,</span> <span class="n">nb_loc</span>
<a name="ln-279"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span>
<a name="ln-280"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nps_loc</span><span class="p">(</span><span class="n">nsb</span><span class="p">),</span> <span class="n">npmax</span><span class="p">,</span> <span class="n">np_tot</span>
<a name="ln-281"></a>   <span class="c">!========= count bunch particles on each (yz) MPI domain</span>
<a name="ln-282"></a>   <span class="n">np_tot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nb_tot</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-283"></a>   <span class="c">! ALL MPI tasks do</span>
<a name="ln-284"></a>   <span class="n">x1</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-285"></a>   <span class="n">x2</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-286"></a>   <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-287"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">ndm</span><span class="p">)</span>
<a name="ln-288"></a><span class="c">!================== 1:   counts local bunch particles of each bunch</span>
<a name="ln-289"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-290"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-291"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-292"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-293"></a>      <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-294"></a>       <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-295"></a>       <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-296"></a>       <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-297"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-298"></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">j</span>
<a name="ln-299"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-300"></a><span class="k">         if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-301"></a><span class="k">          </span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-302"></a>         <span class="k">end if</span>
<a name="ln-303"></a><span class="k">        end if</span>
<a name="ln-304"></a><span class="k">       end do</span>
<a name="ln-305"></a><span class="k">      end do</span>
<a name="ln-306"></a><span class="k">     end do</span>
<a name="ln-307"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-308"></a>    <span class="k">end do</span>
<a name="ln-309"></a><span class="k">    </span><span class="n">nb_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-310"></a>                               <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-311"></a>    <span class="n">nb_min</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-312"></a>                               <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-313"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-314"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-315"></a>      <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-316"></a>       <span class="n">i</span> <span class="o">=</span> <span class="n">ipp</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="p">(</span><span class="n">ip</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-317"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">==</span> <span class="n">nb_max</span><span class="p">)</span> <span class="n">pe_nbmax</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-318"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">==</span> <span class="n">nb_min</span><span class="p">)</span> <span class="n">pe_nbmin</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-319"></a>      <span class="k">end do</span>
<a name="ln-320"></a><span class="k">     end do</span>
<a name="ln-321"></a><span class="k">    end do</span>
<a name="ln-322"></a>    <span class="c">!==================</span>
<a name="ln-323"></a>    <span class="c">! The local particle number of each bunch</span>
<a name="ln-324"></a>    <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-325"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-326"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-327"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-328"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-329"></a>    <span class="k">end if</span>
<a name="ln-330"></a>    <span class="c">!=================================</span>
<a name="ln-331"></a>    <span class="c">!              2: selected particle coordinates are copied in</span>
<a name="ln-332"></a>    <span class="c">!                            bunch%part array</span>
<a name="ln-333"></a>    <span class="n">nb_loc</span> <span class="o">=</span> <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-334"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-335"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-336"></a>    <span class="n">ipp</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-337"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-338"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-339"></a>    <span class="c">!=========================</span>
<a name="ln-340"></a>    <span class="c">! Here 2D MPI decomp. allowed</span>
<a name="ln-341"></a>    <span class="c">!===================================</span>
<a name="ln-342"></a>    <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-343"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-344"></a>     <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-345"></a>     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-346"></a>      <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">i1</span>
<a name="ln-347"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-348"></a><span class="k">       if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-349"></a><span class="k">        </span><span class="n">ii</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-350"></a>        <span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-351"></a>       <span class="k">end if</span>
<a name="ln-352"></a><span class="k">      end if</span>
<a name="ln-353"></a><span class="k">     end do</span>
<a name="ln-354"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-355"></a>    <span class="k">end do</span>
<a name="ln-356"></a><span class="c">!================== 1:   counts local bunch particles of each bunch</span>
<a name="ln-357"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-358"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-359"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-360"></a>      <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-361"></a>       <span class="n">z1</span> <span class="o">=</span> <span class="n">loc_zgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-362"></a>       <span class="n">z2</span> <span class="o">=</span> <span class="n">loc_zgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-363"></a>       <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-364"></a>        <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-365"></a>        <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-366"></a>        <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-367"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-368"></a>         <span class="n">i</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">j</span>
<a name="ln-369"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-370"></a><span class="k">          if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">z1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">z2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-371"></a><span class="k">           if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-372"></a><span class="k">            </span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-373"></a>           <span class="k">end if</span>
<a name="ln-374"></a><span class="k">          end if</span>
<a name="ln-375"></a><span class="k">         end if</span>
<a name="ln-376"></a><span class="k">        end do</span>
<a name="ln-377"></a><span class="k">       end do</span>
<a name="ln-378"></a><span class="k">      end do</span>
<a name="ln-379"></a><span class="k">     end do</span>
<a name="ln-380"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-381"></a>    <span class="k">end do</span>
<a name="ln-382"></a><span class="k">    </span><span class="n">nb_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-383"></a>                               <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-384"></a>    <span class="n">nb_min</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-385"></a>                               <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-386"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-387"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-388"></a>      <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-389"></a>       <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-390"></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">ipp</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="p">(</span><span class="n">ip</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-391"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">==</span> <span class="n">nb_max</span><span class="p">)</span> <span class="n">pe_nbmax</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-392"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">==</span> <span class="n">nb_min</span><span class="p">)</span> <span class="n">pe_nbmin</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-393"></a>       <span class="k">end do</span>
<a name="ln-394"></a><span class="k">      end do</span>
<a name="ln-395"></a><span class="k">     end do</span>
<a name="ln-396"></a><span class="k">    end do</span>
<a name="ln-397"></a>    <span class="c">!==================</span>
<a name="ln-398"></a>    <span class="c">! The local MPI task</span>
<a name="ln-399"></a>    <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-400"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-401"></a>    <span class="c">!==================</span>
<a name="ln-402"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-403"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-404"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-405"></a>    <span class="k">end if</span>
<a name="ln-406"></a>    <span class="c">!=================================</span>
<a name="ln-407"></a>    <span class="c">!                            2: selected particle coordinates are copied in</span>
<a name="ln-408"></a>    <span class="c">!                            bunch%part array</span>
<a name="ln-409"></a>    <span class="n">nb_loc</span> <span class="o">=</span> <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-410"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-411"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-412"></a>    <span class="n">z1</span> <span class="o">=</span> <span class="n">loc_zgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-413"></a>    <span class="n">z2</span> <span class="o">=</span> <span class="n">loc_zgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-414"></a>    <span class="n">ipp</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-415"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-416"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-417"></a>    <span class="c">!=========================</span>
<a name="ln-418"></a>    <span class="c">! Here 3D MPI decomp. allowed</span>
<a name="ln-419"></a>    <span class="c">!===================================</span>
<a name="ln-420"></a>    <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-421"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-422"></a>     <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-423"></a>     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-424"></a>      <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">i1</span>
<a name="ln-425"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-426"></a><span class="k">       if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">z1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">z2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-427"></a><span class="k">        if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-428"></a><span class="k">         </span><span class="n">ii</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-429"></a>         <span class="n">bunch</span><span class="p">(</span><span class="n">ic</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-430"></a>        <span class="k">end if</span>
<a name="ln-431"></a><span class="k">       end if</span>
<a name="ln-432"></a><span class="k">      end if</span>
<a name="ln-433"></a><span class="k">     end do</span>
<a name="ln-434"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-435"></a>    <span class="k">end do</span>
<a name="ln-436"></a><span class="k">   end select</span>
<a name="ln-437"></a>   <span class="c">!=================================</span>
<a name="ln-438"></a>  <span class="k">end subroutine</span>
<a name="ln-439"></a>  <span class="c">!========================</span>
<a name="ln-440"></a>  <span class="k">subroutine </span><span class="n">beam_model_pot</span><span class="p">(</span><span class="n">poten</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">b_am</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-441"></a>                            <span class="n">k2</span><span class="p">)</span>
<a name="ln-442"></a>
<a name="ln-443"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">poten</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-444"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">b_am</span>
<a name="ln-445"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span>
<a name="ln-446"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-447"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">r2</span><span class="p">,</span> <span class="n">brad2</span><span class="p">,</span> <span class="n">sx2_inv</span><span class="p">,</span> <span class="n">fact</span><span class="p">,</span> <span class="n">r2max</span><span class="p">,</span> <span class="n">pot0</span>
<a name="ln-448"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zz</span>
<a name="ln-449"></a>   <span class="c">!-----------------------</span>
<a name="ln-450"></a>   <span class="n">brad2</span> <span class="o">=</span> <span class="n">sy</span><span class="o">*</span><span class="n">sy</span> <span class="o">+</span> <span class="n">sz</span><span class="o">*</span><span class="n">sz</span>
<a name="ln-451"></a>   <span class="n">r2max</span> <span class="o">=</span> <span class="n">ymax</span><span class="o">*</span><span class="n">ymax</span> <span class="o">+</span> <span class="n">zmax</span><span class="o">*</span><span class="n">zmax</span>
<a name="ln-452"></a>   <span class="n">pot0</span> <span class="o">=</span> <span class="nb">log</span><span class="p">(</span><span class="n">r2max</span><span class="o">/</span><span class="n">brad2</span><span class="p">)</span>
<a name="ln-453"></a>   <span class="n">sx2_inv</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">sx</span><span class="o">*</span><span class="n">sx</span><span class="p">)</span>
<a name="ln-454"></a>   <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span>
<a name="ln-455"></a>    <span class="n">kk</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-456"></a>    <span class="n">zz</span> <span class="o">=</span> <span class="n">loc_zg</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imodz</span><span class="p">)</span>
<a name="ln-457"></a>    <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span>
<a name="ln-458"></a>     <span class="n">jj</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-459"></a>     <span class="n">yy</span> <span class="o">=</span> <span class="n">loc_yg</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imody</span><span class="p">)</span>
<a name="ln-460"></a>     <span class="n">r2</span> <span class="o">=</span> <span class="n">zz</span><span class="o">*</span><span class="n">zz</span> <span class="o">+</span> <span class="n">yy</span><span class="o">*</span><span class="n">yy</span>
<a name="ln-461"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">r2</span> <span class="o">&gt;</span> <span class="n">brad2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-462"></a><span class="k">      </span><span class="n">fact</span> <span class="o">=</span> <span class="nb">log</span><span class="p">(</span><span class="n">r2</span><span class="o">/</span><span class="n">brad2</span><span class="p">)</span> <span class="o">-</span> <span class="n">pot0</span>
<a name="ln-463"></a>     <span class="k">else</span>
<a name="ln-464"></a><span class="k">      </span><span class="n">fact</span> <span class="o">=</span> <span class="p">(</span><span class="n">r2</span><span class="o">/</span><span class="n">brad2</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">-</span> <span class="n">pot0</span>
<a name="ln-465"></a>     <span class="k">end if</span>
<a name="ln-466"></a><span class="k">     do </span><span class="n">i</span> <span class="o">=</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span>
<a name="ln-467"></a>      <span class="n">xx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span> <span class="o">-</span> <span class="n">xc_bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-468"></a>      <span class="n">poten</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">brad2</span><span class="o">*</span><span class="n">b_am</span><span class="o">*</span><span class="n">fact</span><span class="o">*</span><span class="nb">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xx</span><span class="o">*</span><span class="n">xx</span><span class="o">*</span><span class="n">sx2_inv</span><span class="p">)</span>
<a name="ln-469"></a>     <span class="k">end do</span>
<a name="ln-470"></a><span class="k">    end do</span>
<a name="ln-471"></a><span class="k">   end do</span>
<a name="ln-472"></a><span class="k">  end subroutine</span>
<a name="ln-473"></a>  <span class="c">!=========================</span>
<a name="ln-474"></a>  <span class="k">subroutine </span><span class="n">beam_inject</span>
<a name="ln-475"></a>
<a name="ln-476"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">id_ch</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span>
<a name="ln-477"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nps_loc</span><span class="p">(</span><span class="n">nsb</span><span class="p">),</span> <span class="n">nb_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">i1</span>
<a name="ln-478"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span>
<a name="ln-479"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">n</span><span class="p">,</span> <span class="n">n1_alc</span><span class="p">,</span> <span class="n">n2_alc</span><span class="p">,</span> <span class="n">n3_alc</span>
<a name="ln-480"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gam2</span>
<a name="ln-481"></a>
<a name="ln-482"></a>   <span class="n">gam2</span> <span class="o">=</span> <span class="n">gam0</span><span class="o">*</span><span class="n">gam0</span>
<a name="ln-483"></a>   <span class="n">id_ch</span> <span class="o">=</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-484"></a>   <span class="c">!=======================</span>
<a name="ln-485"></a>   <span class="n">n1_alc</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-486"></a>   <span class="n">n2_alc</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-487"></a>   <span class="n">n3_alc</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-488"></a>   <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">ebf_bunch</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-489"></a><span class="k">    allocate</span> <span class="p">(</span><span class="n">ebf_bunch</span><span class="p">(</span><span class="n">n1_alc</span><span class="p">,</span> <span class="n">n2_alc</span><span class="p">,</span> <span class="n">n3_alc</span><span class="p">,</span> <span class="n">nbfield</span><span class="p">))</span>
<a name="ln-490"></a>    <span class="n">ebf_bunch</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-491"></a>   <span class="k">end if</span>
<a name="ln-492"></a>   <span class="c">!=============================</span>
<a name="ln-493"></a>   <span class="c">! The fields of a moving e-bunch in vacuum</span>
<a name="ln-494"></a>   <span class="c">! E_x=-(DPhi/Dx)/gamma^2  , E_y=-DPhi/Dy   E_z=-DPhi/Dz</span>
<a name="ln-495"></a>   <span class="c">! Poisson eq.  D_xE_x+D_yE_y+D_zE_z=omp^2\rho (x-V_b*t_0,y,z)</span>
<a name="ln-496"></a>   <span class="c">! B_x=0   B_y=-V_b*E_z    B_z= V_b*E_y</span>
<a name="ln-497"></a>   <span class="c">!=========================================</span>
<a name="ln-498"></a>   <span class="k">call </span><span class="n">init_random_seed</span><span class="p">(</span><span class="n">mype</span><span class="p">)</span>
<a name="ln-499"></a>   <span class="k">call </span><span class="n">beam_data</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span>
<a name="ln-500"></a>   <span class="c">! Generates phase space coordinates for bparticles on ebfb(np_tot,7)</span>
<a name="ln-501"></a>   <span class="c">! bpart() provisional storage in common to all MPI tasks</span>
<a name="ln-502"></a>   <span class="c">!=======================</span>
<a name="ln-503"></a>   <span class="k">call </span><span class="n">mpi_beam_distribute</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span> <span class="c">!local bpart data are stored in bunch(1)%part struct for each MPI task</span>
<a name="ln-504"></a>
<a name="ln-505"></a>   <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-506"></a>   <span class="n">nb</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>                     <span class="c">!the total bunch particle number</span>
<a name="ln-507"></a>   <span class="c">!on each mpi_task</span>
<a name="ln-508"></a><span class="c">!=====================================</span>
<a name="ln-509"></a>   <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-510"></a><span class="k">    </span><span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-511"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-512"></a><span class="k">     do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-513"></a>      <span class="n">ebfp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span> <span class="o">=</span> <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span>
<a name="ln-514"></a>     <span class="k">end do</span>
<a name="ln-515"></a><span class="k">     deallocate</span> <span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">)</span>
<a name="ln-516"></a>     <span class="k">allocate</span> <span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">np</span> <span class="o">+</span> <span class="n">nb</span><span class="p">,</span> <span class="n">id_ch</span><span class="p">))</span>
<a name="ln-517"></a>     <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-518"></a>      <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span>
<a name="ln-519"></a>     <span class="k">end do</span>
<a name="ln-520"></a><span class="k">     deallocate</span> <span class="p">(</span><span class="n">ebfp</span><span class="p">)</span>
<a name="ln-521"></a>     <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb</span>
<a name="ln-522"></a>      <span class="n">i1</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="n">np</span>
<a name="ln-523"></a>      <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span> <span class="o">=</span> <span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span>
<a name="ln-524"></a>     <span class="k">end do</span>
<a name="ln-525"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">ebfp</span><span class="p">(</span><span class="n">np</span> <span class="o">+</span> <span class="n">nb</span><span class="p">,</span> <span class="n">id_ch</span><span class="p">))</span>
<a name="ln-526"></a>     <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">nb</span>
<a name="ln-527"></a>    <span class="n">endif</span>
<a name="ln-528"></a>   <span class="k">else</span>
<a name="ln-529"></a><span class="k">    </span><span class="n">nb_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">nb</span>
<a name="ln-530"></a>    <span class="k">call </span><span class="n">p_alloc</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lpf_ord</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mem_psize</span><span class="p">)</span>
<a name="ln-531"></a>    <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb</span>
<a name="ln-532"></a>     <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span> <span class="o">=</span> <span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span>
<a name="ln-533"></a>    <span class="k">end do</span>
<a name="ln-534"></a><span class="k">    </span><span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">nb_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-535"></a>   <span class="k">end if</span>
<a name="ln-536"></a>   <span class="c">! Solves for beam potential UNIFORM GRIDS NEEDED</span>
<a name="ln-537"></a>   <span class="c">!==================================================</span>
<a name="ln-538"></a>   <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-539"></a>   <span class="n">ft_mod</span> <span class="o">=</span> <span class="mi">2</span> <span class="c">!A sine transform along each coordinate</span>
<a name="ln-540"></a>   <span class="n">ft_sym</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-541"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">stretch</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-542"></a><span class="k">    if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-543"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">pot</span><span class="p">(</span><span class="n">n1ft</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n2ft_loc</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n3ft_loc</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-544"></a>    <span class="k">else</span>
<a name="ln-545"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">pot</span><span class="p">(</span><span class="n">n1ft</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n2ft_loc</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n3ft_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-546"></a>    <span class="n">endif</span>
<a name="ln-547"></a>    <span class="n">pot</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-548"></a>    <span class="k">call </span><span class="n">mpi_beam_ftgrid_distribute</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span> <span class="c">!local bpart data are stored in bunch(1)%part in ftgrid</span>
<a name="ln-549"></a>    <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-550"></a>    <span class="n">nb</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>                     <span class="c">!the total bunch particle number</span>
<a name="ln-551"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">ebfb</span><span class="p">))</span> <span class="k">deallocate</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">)</span>
<a name="ln-552"></a>    <span class="k">allocate</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-553"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-554"></a>     <span class="n">np</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-555"></a>     <span class="k">call </span><span class="n">set_charge_on_ftgrid</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">pot</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-556"></a>    <span class="k">end do</span>
<a name="ln-557"></a><span class="k">    if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">call </span><span class="n">fill_ftcurr_yzbdsdata</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-558"></a>    <span class="c">!============================</span>
<a name="ln-559"></a>    <span class="c">!In pot(1) beam density</span>
<a name="ln-560"></a>    <span class="c">!=====================================================</span>
<a name="ln-561"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">imody</span><span class="p">)%</span><span class="n">p_ind</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-562"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">imody</span><span class="p">)%</span><span class="n">p_ind</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-563"></a>    <span class="n">z1</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">imodz</span><span class="p">)%</span><span class="n">p_ind</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-564"></a>    <span class="n">z2</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">imodz</span><span class="p">)%</span><span class="n">p_ind</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-565"></a>    <span class="c">!============ ft uniform grid</span>
<a name="ln-566"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">call </span><span class="n">fft_2d_psolv</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">ompe</span><span class="p">,</span> <span class="n">n1ft</span><span class="p">,</span> <span class="n">n1ft_loc</span><span class="p">,</span> <span class="n">n2ft</span><span class="p">,</span> <span class="n">n2ft_loc</span><span class="p">,</span> <span class="n">n3ft</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-567"></a>                                     <span class="n">n3ft_loc</span><span class="p">,</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-568"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="k">call </span><span class="n">fft_3d_psolv</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">gam2</span><span class="p">,</span> <span class="n">ompe</span><span class="p">,</span> <span class="n">n1ft</span><span class="p">,</span> <span class="n">n1ft_loc</span><span class="p">,</span> <span class="n">n2ft</span><span class="p">,</span> <span class="n">n2ft_loc</span><span class="p">,</span> <span class="n">n3ft</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-569"></a>                                     <span class="n">n3ft_loc</span><span class="p">,</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-570"></a>    <span class="c">!Solves Laplacian[poten]=ompe*rho in Fourier space using sin() transform</span>
<a name="ln-571"></a>    <span class="c">!Exit beam potential in jc(1)</span>
<a name="ln-572"></a>    <span class="c">!uniform to stretched grid interpolation inside</span>
<a name="ln-573"></a>    <span class="c">!======================================</span>
<a name="ln-574"></a>   <span class="k">else</span>
<a name="ln-575"></a><span class="k">    do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-576"></a>     <span class="n">np</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-577"></a>     <span class="k">call </span><span class="n">set_grid_charge</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ebfp</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-578"></a>    <span class="k">end do</span>
<a name="ln-579"></a><span class="k">    if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">call </span><span class="n">fill_curr_yzxbdsdata</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-580"></a>    <span class="c">!============================</span>
<a name="ln-581"></a>    <span class="c">!In jc(1) beam density</span>
<a name="ln-582"></a>    <span class="c">!=====================================================</span>
<a name="ln-583"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">jy1</span>
<a name="ln-584"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">jy2</span>
<a name="ln-585"></a>    <span class="n">z1</span> <span class="o">=</span> <span class="n">kz1</span>
<a name="ln-586"></a>    <span class="n">z2</span> <span class="o">=</span> <span class="n">kz2</span>
<a name="ln-587"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">call </span><span class="n">fft_2d_psolv</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">ompe</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">nx_loc</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">ny_loc</span><span class="p">,</span> <span class="n">nz</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-588"></a>                                     <span class="n">nz_loc</span><span class="p">,</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-589"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="k">call </span><span class="n">fft_3d_psolv</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">gam2</span><span class="p">,</span> <span class="n">ompe</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">nx_loc</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">ny_loc</span><span class="p">,</span> <span class="n">nz</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-590"></a>                                     <span class="n">nz_loc</span><span class="p">,</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-591"></a>    <span class="c">!Solves Laplacian[poten]=ompe*rho in Fourier space using sin() transform</span>
<a name="ln-592"></a>    <span class="c">!Exit beam potential in jc(1)</span>
<a name="ln-593"></a>   <span class="n">endif</span>
<a name="ln-594"></a>   <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">bet0</span><span class="o">*</span><span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-595"></a>   <span class="c">!==========================</span>
<a name="ln-596"></a>   <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">ebfb</span><span class="p">))</span> <span class="k">deallocate</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">)</span>
<a name="ln-597"></a>   <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">deallocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">)</span>
<a name="ln-598"></a>   <span class="c">!===========================</span>
<a name="ln-599"></a>   <span class="k">call </span><span class="n">fill_ebfield_yzxbdsdata</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-600"></a>   <span class="k">call </span><span class="n">initial_beam_fields</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">ebf_bunch</span><span class="p">,</span> <span class="n">gam2</span><span class="p">,</span> <span class="n">bet0</span><span class="p">)</span>
<a name="ln-601"></a>   <span class="c">! generates (Ex,Ey,Ez,By,Bz) bunch fields  Bx=ebf_bunc(4)=0</span>
<a name="ln-602"></a>   <span class="n">ebf_bunch</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-603"></a>   <span class="c">!========================================= Collect data</span>
<a name="ln-604"></a>   <span class="n">ebf</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nfield</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebf</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nfield</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-605"></a>                            <span class="n">ebf_bunch</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nfield</span><span class="p">)</span>
<a name="ln-606"></a>   <span class="c">!========================================</span>
<a name="ln-607"></a>   <span class="n">lp_end</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">xc_bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">sxb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-608"></a>   <span class="c">!=====================================</span>
<a name="ln-609"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-610"></a>    <span class="c">!==================</span>
<a name="ln-611"></a>    <span class="k">open</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;Initial_bunch_info.dat&#39;</span><span class="p">)</span>
<a name="ln-612"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a27,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Initial target x-position =&#39;</span><span class="p">,</span> <span class="n">targ_in</span>
<a name="ln-613"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a20,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Plasma wave-length =&#39;</span><span class="p">,</span> <span class="n">lambda_p</span>
<a name="ln-614"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;-------------------------------------&#39;</span>
<a name="ln-615"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a17,i4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Number of bunches&#39;</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-616"></a>    <span class="k">do </span><span class="n">i1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-617"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;bunch number =&#39;</span><span class="p">,</span> <span class="n">i1</span>
<a name="ln-618"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a25,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Bunch particles per cell &#39;</span><span class="p">,</span> <span class="n">nb_per_cell</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-619"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a23,i8)&#39;</span><span class="p">)</span> <span class="s1">&#39;Bunch particle number  &#39;</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-620"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a15,2e14.6)&#39;</span><span class="p">)</span> <span class="s1">&#39;gamma and beta &#39;</span><span class="p">,</span> <span class="n">gam</span><span class="p">(</span><span class="n">i1</span><span class="p">),</span> <span class="n">bet0</span>
<a name="ln-621"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a15,2e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Bunch  sizes   &#39;</span><span class="p">,</span> <span class="n">sxb</span><span class="p">(</span><span class="n">i1</span><span class="p">),</span> <span class="n">syb</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-622"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a23,2e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Transverse emittances= &#39;</span><span class="p">,</span> <span class="n">epsy</span><span class="p">(</span><span class="n">i1</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-623"></a>      <span class="n">epsz</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-624"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a21,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Initial xc-position= &#39;</span><span class="p">,</span> <span class="n">xc_bunch</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-625"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a20,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;B charge    [pC] =  &#39;</span><span class="p">,</span> <span class="n">bunch_charge</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-626"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a21,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;B_density/P_density  &#39;</span><span class="p">,</span> <span class="n">rhob</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-627"></a>    <span class="k">end do</span>
<a name="ln-628"></a><span class="k">    close</span> <span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<a name="ln-629"></a>   <span class="k">end if</span>
<a name="ln-630"></a><span class="k">  end subroutine</span>
<a name="ln-631"></a>  <span class="c">!========================</span>
<a name="ln-632"></a> <span class="k">end module</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-07-30 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> ALaDyn was developed by The ALaDyn Collaboration</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>