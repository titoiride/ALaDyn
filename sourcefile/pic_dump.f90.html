<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A High-Accuracy PIC Code for the Maxwell-Vlasov Equations">
    
    <meta name="author" content="The ALaDyn Collaboration" >
    <link rel="icon" href="../favicon.png">

    <title>pic_dump.f90 &ndash; ALaDyn</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">ALaDyn <small>3.0.1</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Guide</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/aladyn.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/aladyn.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>pic_dump.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 2.8% of total for source files.">682 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/pic_dump.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">pic_dump.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/pic_dump.html">pic_dump</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/pic_dump.f90.html#src">pic_dump.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~pic_dump.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilepic_dumpf90EfferentGraph" width="641pt" height="307pt"
 viewBox="0.00 0.00 641.00 306.74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~pic_dump.f90~~EfferentGraph" class="graph" transform="scale(.9831 .9831) rotate(0) translate(4 308)">
<title>sourcefile~~pic_dump.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-308 648,-308 648,4 -4,4"/>
<!-- sourcefile~pic_dump.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~pic_dump.f90</title>
<polygon fill="none" stroke="#000000" points="644,-204 559,-204 559,-180 644,-180 644,-204"/>
<text text-anchor="middle" x="601.5" y="-189.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">pic_dump.f90</text>
</g>
<!-- sourcefile~array_alloc.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~array_alloc.f90</title>
<g id="a_sourcefile~~pic_dump.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/array_alloc.f90.html" xlink:title="array_alloc.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="523,-93 431,-93 431,-69 523,-69 523,-93"/>
<text text-anchor="middle" x="477" y="-78.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">array_alloc.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_dump.f90&#45;&gt;sourcefile~array_alloc.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~pic_dump.f90&#45;&gt;sourcefile~array_alloc.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M587.7006,-179.6969C565.992,-160.3422 523.71,-122.6451 498.1475,-99.8544"/>
<polygon fill="#ff0000" stroke="#ff0000" points="500.2761,-97.0631 490.4827,-93.0207 495.6177,-102.288 500.2761,-97.0631"/>
</g>
<!-- sourcefile~common_param.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~common_param.f90</title>
<g id="a_sourcefile~~pic_dump.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/common_param.f90.html" xlink:title="common_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="395,-304 274,-304 274,-280 395,-280 395,-304"/>
<text text-anchor="middle" x="334.5" y="-289.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">common_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_dump.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~pic_dump.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M477,-252C448.1077,-260.7561 415.7204,-269.9004 389.1318,-277.2321"/>
<polygon fill="#ff0000" stroke="#ff0000" points="387.96,-273.9243 379.2447,-279.9487 389.8147,-280.6741 387.96,-273.9243"/>
</g>
<!-- sourcefile~parallel.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~parallel.f90</title>
<g id="a_sourcefile~~pic_dump.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/parallel.f90.html" xlink:title="parallel.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="515,-214 439,-214 439,-190 515,-190 515,-214"/>
<text text-anchor="middle" x="477" y="-199.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">parallel.F90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_dump.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~pic_dump.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M558.6542,-195.4414C547.9935,-196.2977 536.4891,-197.2218 525.5748,-198.0984"/>
<polygon fill="#ff0000" stroke="#ff0000" points="525.0258,-194.6311 515.3381,-198.9206 525.5863,-201.6087 525.0258,-194.6311"/>
</g>
<!-- sourcefile~code_util.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~code_util.f90</title>
<g id="a_sourcefile~~pic_dump.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/code_util.f90.html" xlink:title="code_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="230.5,-264 149.5,-264 149.5,-240 230.5,-240 230.5,-264"/>
<text text-anchor="middle" x="190" y="-249.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">code_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_dump.f90&#45;&gt;sourcefile~code_util.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~pic_dump.f90&#45;&gt;sourcefile~code_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M581.582,-204.004C557.6341,-217.858 515.8064,-240.2393 477,-252"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M477,-252C397.1538,-276.1983 298.9732,-268.741 240.6033,-260.6864"/>
<polygon fill="#ff0000" stroke="#ff0000" points="240.9295,-257.1973 230.5326,-259.2358 239.9315,-264.1258 240.9295,-257.1973"/>
</g>
<!-- sourcefile~grid_param.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~grid_param.f90</title>
<g id="a_sourcefile~~pic_dump.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/grid_param.f90.html" xlink:title="grid_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="381.5,-144 287.5,-144 287.5,-120 381.5,-120 381.5,-144"/>
<text text-anchor="middle" x="334.5" y="-129.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_dump.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~pic_dump.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M558.8978,-182.4265C513.7191,-172.274 442.0906,-156.1777 391.9451,-144.909"/>
<polygon fill="#ff0000" stroke="#ff0000" points="392.4267,-141.43 381.9026,-142.6523 390.8919,-148.2597 392.4267,-141.43"/>
</g>
<!-- sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~pstruct_data.f90</title>
<g id="a_sourcefile~~pic_dump.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/pstruct_data.f90.html" xlink:title="pstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="384,-93 285,-93 285,-69 384,-69 384,-93"/>
<text text-anchor="middle" x="334.5" y="-78.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~array_alloc.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~array_alloc.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M430.7343,-81C419.1791,-81 406.62,-81 394.5058,-81"/>
<polygon fill="#ff0000" stroke="#ff0000" points="394.4663,-77.5001 384.4663,-81 394.4662,-84.5001 394.4663,-77.5001"/>
</g>
<!-- sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~fstruct_data.f90</title>
<g id="a_sourcefile~~pic_dump.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/fstruct_data.f90.html" xlink:title="fstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="238,-24 142,-24 142,0 238,0 238,-24"/>
<text text-anchor="middle" x="190" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~array_alloc.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~array_alloc.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M430.6405,-68.9491C419.0156,-65.9764 406.5612,-62.8336 395,-60 345.4753,-47.8618 289.053,-34.6994 247.9559,-25.2333"/>
<polygon fill="#ff0000" stroke="#ff0000" points="248.6453,-21.8005 238.1152,-22.9698 247.0761,-28.6224 248.6453,-21.8005"/>
</g>
<!-- sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~precision_def.f90</title>
<g id="a_sourcefile~~pic_dump.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/precision_def.f90.html" xlink:title="precision_def.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="106,-164 0,-164 0,-140 106,-140 106,-164"/>
<text text-anchor="middle" x="53" y="-149.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">precision_def.F90</text>
</a>
</g>
</g>
<!-- sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M273.8652,-298.2691C233.9211,-299.5734 181.8378,-295.6775 142,-273 102.2372,-250.3652 75.173,-201.92 62.0786,-173.6755"/>
<polygon fill="#cbff00" stroke="#cbff00" points="65.1547,-171.9796 57.8887,-164.2689 58.7604,-174.8278 65.1547,-171.9796"/>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M457.7818,-214.1378C433.2407,-229.6375 390.5913,-256.5739 362.4533,-274.3453"/>
<polygon fill="#00ff66" stroke="#00ff66" points="360.4547,-271.4679 353.8688,-279.7671 364.1927,-277.3863 360.4547,-271.4679"/>
</g>
<!-- sourcefile~util.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~util.f90</title>
<g id="a_sourcefile~~pic_dump.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/util.f90.html" xlink:title="util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="361.5,-224 307.5,-224 307.5,-200 361.5,-200 361.5,-224"/>
<text text-anchor="middle" x="334.5" y="-209.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M438.8126,-204.6798C417.9368,-206.1448 392.1954,-207.9512 371.5073,-209.403"/>
<polygon fill="#00ff66" stroke="#00ff66" points="371.2326,-205.9136 361.5021,-210.1051 371.7227,-212.8964 371.2326,-205.9136"/>
</g>
<!-- sourcefile~mpi_var.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~mpi_var.f90</title>
<g id="a_sourcefile~~pic_dump.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/mpi_var.f90.html" xlink:title="mpi_var.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="227.5,-184 152.5,-184 152.5,-160 227.5,-160 227.5,-184"/>
<text text-anchor="middle" x="190" y="-169.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_var.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M438.6609,-196.5266C424.9065,-194.6504 409.2722,-192.618 395,-191 341.3053,-184.9128 279.5323,-179.3887 237.9503,-175.8857"/>
<polygon fill="#00ff66" stroke="#00ff66" points="238.0877,-172.385 227.8308,-175.0395 237.5044,-179.3607 238.0877,-172.385"/>
</g>
<!-- sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M165.5255,-239.9412C157.8089,-235.8255 149.3776,-230.9936 142,-226 117.2594,-209.254 91.238,-187.0005 73.7676,-171.2844"/>
<polygon fill="#0066ff" stroke="#0066ff" points="75.6738,-168.2869 65.9213,-164.1471 70.9636,-173.4651 75.6738,-168.2869"/>
</g>
<!-- sourcefile~struct_def.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~struct_def.f90</title>
<g id="a_sourcefile~~pic_dump.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/struct_def.f90.html" xlink:title="struct_def.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="232.5,-104 147.5,-104 147.5,-80 232.5,-80 232.5,-104"/>
<text text-anchor="middle" x="190" y="-89.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">struct_def.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_param.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~grid_param.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M291.1452,-119.9987C275.862,-115.768 258.5135,-110.9657 242.5534,-106.5476"/>
<polygon fill="#cc00ff" stroke="#cc00ff" points="243.3975,-103.1498 232.8262,-103.855 241.53,-109.8961 243.3975,-103.1498"/>
</g>
<!-- sourcefile~grid_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~grid_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M287.3832,-135.3476C240.4284,-138.6836 168.0297,-143.8274 116.1248,-147.5151"/>
<polygon fill="#cc00ff" stroke="#cc00ff" points="115.7574,-144.0323 106.0307,-148.2323 116.2536,-151.0147 115.7574,-144.0323"/>
</g>
<!-- sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M162.276,-104.1419C141.4782,-113.2504 112.7957,-125.8121 90.0347,-135.7804"/>
<polygon fill="#ff0000" stroke="#ff0000" points="88.4387,-132.6584 80.6828,-139.8762 91.2469,-139.0704 88.4387,-132.6584"/>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M307.3207,-219.5237C288.5198,-224.7281 262.9394,-231.8092 240.4627,-238.0311"/>
<polygon fill="#ffff00" stroke="#ffff00" points="239.4239,-234.6869 230.7201,-240.728 241.2914,-241.4332 239.4239,-234.6869"/>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M307.2075,-212.1369C269.4285,-211.6927 199.3655,-208.5704 142,-193 121.5505,-187.4495 99.9317,-177.5945 83.1224,-168.9375"/>
<polygon fill="#ffff00" stroke="#ffff00" points="84.3023,-165.6022 73.8262,-164.0204 81.0294,-171.7899 84.3023,-165.6022"/>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M284.7713,-84.7856C271.2398,-85.8157 256.5372,-86.9349 242.84,-87.9776"/>
<polygon fill="#00ff00" stroke="#00ff00" points="242.303,-84.5082 232.5976,-88.7573 242.8344,-91.488 242.303,-84.5082"/>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M291.6159,-68.9907C251.5202,-59.9956 190.6881,-52.1612 142,-71 110.5997,-83.1497 83.4643,-112.1009 67.6673,-131.8859"/>
<polygon fill="#00ff00" stroke="#00ff00" points="64.758,-129.9271 61.4221,-139.983 70.3009,-134.2022 64.758,-129.9271"/>
</g>
<!-- sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M163.093,-24.0699C155.8547,-27.9659 148.2947,-32.6745 142,-38 109.5347,-65.4663 81.0722,-106.4863 65.5256,-131.1049"/>
<polygon fill="#00ffff" stroke="#00ffff" points="62.5079,-129.3302 60.2183,-139.6747 68.4591,-133.0158 62.5079,-129.3302"/>
</g>
<!-- sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_dump.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M152.2015,-166.482C141.0638,-164.856 128.5607,-163.0308 116.2825,-161.2383"/>
<polygon fill="#0000ff" stroke="#0000ff" points="116.4573,-157.7268 106.0566,-159.7455 115.4461,-164.6534 116.4573,-157.7268"/>
</g>
</g>
</svg>
</div><script>var pansourcefilepic_dumpf90EfferentGraph = svgPanZoom('#sourcefilepic_dumpf90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~pic_dump.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilepic_dumpf90AfferentGraph" width="318pt" height="32pt"
 viewBox="0.00 0.00 318.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~pic_dump.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>sourcefile~~pic_dump.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 314,-28 314,4 -4,4"/>
<!-- sourcefile~pic_dump.f90 -->
<g id="sourcefile~~pic_dump.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~pic_dump.f90</title>
<polygon fill="none" stroke="#000000" points="85,-24 0,-24 0,0 85,0 85,-24"/>
<text text-anchor="middle" x="42.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">pic_dump.f90</text>
</g>
<!-- sourcefile~start_all.f90 -->
<g id="sourcefile~~pic_dump.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~start_all.f90</title>
<g id="a_sourcefile~~pic_dump.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/start_all.f90.html" xlink:title="start_all.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="198,-24 121,-24 121,0 198,0 198,-24"/>
<text text-anchor="middle" x="159.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">start_all.F90</text>
</a>
</g>
</g>
<!-- sourcefile~start_all.f90&#45;&gt;sourcefile~pic_dump.f90 -->
<g id="sourcefile~~pic_dump.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~start_all.f90&#45;&gt;sourcefile~pic_dump.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M120.8656,-12C112.6369,-12 103.8132,-12 95.1615,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="95.1302,-8.5001 85.1302,-12 95.1301,-15.5001 95.1302,-8.5001"/>
</g>
<!-- sourcefile~aladyn.f90 -->
<g id="sourcefile~~pic_dump.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~aladyn.f90</title>
<g id="a_sourcefile~~pic_dump.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/aladyn.f90.html" xlink:title="ALaDyn.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="310,-24 234,-24 234,0 310,0 310,-24"/>
<text text-anchor="middle" x="272" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALaDyn.F90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~start_all.f90 -->
<g id="sourcefile~~pic_dump.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~start_all.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M233.9126,-12C225.7553,-12 217.0272,-12 208.5231,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="208.3146,-8.5001 198.3146,-12 208.3145,-15.5001 208.3146,-8.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/pic_dump.html">pic_dump</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/pic_dump.f90.html#src">pic_dump.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-2"></a><span class="c">!                            Copyright 2008-2020  The ALaDyn Collaboration                            !</span>
<a name="ln-3"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-4"></a>
<a name="ln-5"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-6"></a><span class="c">!  This file is part of ALaDyn.                                                                       !</span>
<a name="ln-7"></a><span class="c">!                                                                                                     !</span>
<a name="ln-8"></a><span class="c">!  ALaDyn is free software: you can redistribute it and/or modify                                     !</span>
<a name="ln-9"></a><span class="c">!  it under the terms of the GNU General Public License as published by                               !</span>
<a name="ln-10"></a><span class="c">!  the Free Software Foundation, either version 3 of the License, or                                  !</span>
<a name="ln-11"></a><span class="c">!  (at your option) any later version.                                                                !</span>
<a name="ln-12"></a><span class="c">!                                                                                                     !</span>
<a name="ln-13"></a><span class="c">!  ALaDyn is distributed in the hope that it will be useful,                                          !</span>
<a name="ln-14"></a><span class="c">!  but WITHOUT ANY WARRANTY; without even the implied warranty of                                     !</span>
<a name="ln-15"></a><span class="c">!  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                      !</span>
<a name="ln-16"></a><span class="c">!  GNU General Public License for more details.                                                       !</span>
<a name="ln-17"></a><span class="c">!                                                                                                     !</span>
<a name="ln-18"></a><span class="c">!  You should have received a copy of the GNU General Public License                                  !</span>
<a name="ln-19"></a><span class="c">!  along with ALaDyn.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                                    !</span>
<a name="ln-20"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-21"></a>
<a name="ln-22"></a> <span class="k">module </span><span class="n">pic_dump</span>
<a name="ln-23"></a>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">array_alloc</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">code_util</span>
<a name="ln-26"></a>  <span class="k">use </span><span class="n">common_param</span>
<a name="ln-27"></a>  <span class="k">use </span><span class="n">grid_param</span>
<a name="ln-28"></a>  <span class="k">use </span><span class="n">parallel</span>
<a name="ln-29"></a>
<a name="ln-30"></a>  <span class="k">implicit none</span>
<a name="ln-31"></a>
<a name="ln-32"></a><span class="k">  </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">private</span> <span class="kd">::</span> <span class="n">send_buff</span><span class="p">(:),</span> <span class="n">recv_buff</span><span class="p">(:)</span>
<a name="ln-33"></a> <span class="k">contains</span>
<a name="ln-34"></a>
<a name="ln-35"></a><span class="k">  subroutine </span><span class="n">dump_data</span><span class="p">(</span><span class="n">it_loc</span><span class="p">,</span> <span class="n">tloc</span><span class="p">)</span>
<a name="ln-36"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">it_loc</span>
<a name="ln-37"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tloc</span>
<a name="ln-38"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;         &#39;</span>
<a name="ln-39"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_yz</span> <span class="o">=</span> <span class="s1">&#39;         &#39;</span>
<a name="ln-40"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_ebf</span> <span class="o">=</span> <span class="s1">&#39;         &#39;</span>
<a name="ln-41"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_env</span> <span class="o">=</span> <span class="s1">&#39;         &#39;</span>
<a name="ln-42"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_fl</span> <span class="o">=</span> <span class="s1">&#39;         &#39;</span>
<a name="ln-43"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_part</span> <span class="o">=</span> <span class="s1">&#39;         &#39;</span>
<a name="ln-44"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_bunchpart</span> <span class="o">=</span> <span class="s1">&#39;         &#39;</span>
<a name="ln-45"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_bunch0</span> <span class="o">=</span> <span class="s1">&#39;        &#39;</span>
<a name="ln-46"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_bunch1</span> <span class="o">=</span> <span class="s1">&#39;        &#39;</span>
<a name="ln-47"></a>   <span class="c">!=== BE CAREFUL: FILE NAMES HAVE BEEN INITIALIZED TO ONLY ALLOW A MAXIMUM</span>
<a name="ln-48"></a>   <span class="c">! 99 CORES ALONG Z. IF MORE ARE NEEDED, IT IS NECESSARY TO CHANGE FROM</span>
<a name="ln-49"></a>   <span class="c">! CHARACTER(11) TO CHARACTER(12) (OR MORE) ===</span>
<a name="ln-50"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fnamel_part</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
<a name="ln-51"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fnamel_bunchpart</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
<a name="ln-52"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fnamel_bunch0</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
<a name="ln-53"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fnamel_bunch1</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
<a name="ln-54"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fnamel_ebf</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
<a name="ln-55"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fnamel_env</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
<a name="ln-56"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fnamel_fl</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
<a name="ln-57"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="kd">::</span> <span class="n">foldername</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
<a name="ln-58"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_out</span> <span class="o">=</span> <span class="s1">&#39;                         &#39;</span>
<a name="ln-59"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">27</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fnamel_out</span> <span class="o">=</span> <span class="s1">&#39;                           &#39;</span>
<a name="ln-60"></a>
<a name="ln-61"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp_col</span><span class="p">,</span> <span class="n">disp</span>
<a name="ln-62"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">max_npt_size</span>
<a name="ln-63"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">lun</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">kk</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">lenbuff</span>
<a name="ln-64"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nxf_loc</span><span class="p">,</span> <span class="n">nyf_loc</span><span class="p">,</span> <span class="n">nzf_loc</span><span class="p">,</span> <span class="n">ndv</span><span class="p">,</span> <span class="n">ndvb</span>
<a name="ln-65"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">npt_arr</span><span class="p">(</span><span class="n">npe</span><span class="p">,</span> <span class="n">nsp</span><span class="p">),</span> <span class="n">ip_loc</span><span class="p">(</span><span class="n">npe</span><span class="p">),</span> <span class="n">ip_loc_bunch</span><span class="p">(</span><span class="n">npe</span><span class="p">)</span>
<a name="ln-66"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">loc_grid_size</span><span class="p">(</span><span class="n">npe</span><span class="p">),</span> <span class="n">loc2d_grid_size</span><span class="p">(</span><span class="n">npe</span><span class="p">),</span> <span class="n">lenw</span><span class="p">(</span><span class="n">npe</span><span class="p">)</span>
<a name="ln-67"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">grid_size_max</span><span class="p">,</span> <span class="n">grid2d_size_max</span>
<a name="ln-68"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">env_cp</span><span class="p">,</span> <span class="n">env1_cp</span><span class="p">,</span> <span class="n">fl_cp</span><span class="p">,</span> <span class="n">ebf_cp</span>
<a name="ln-69"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a name="ln-70"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ndata</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a name="ln-71"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">dist_npy</span><span class="p">(</span><span class="n">npe_yloc</span><span class="p">,</span> <span class="n">nsp</span><span class="p">),</span> <span class="n">dist_npz</span><span class="p">(</span><span class="n">npe_zloc</span><span class="p">,</span> <span class="n">nsp</span><span class="p">)</span>
<a name="ln-72"></a>   <span class="kt">logical</span> <span class="kd">::</span> <span class="n">sd</span>
<a name="ln-73"></a>   <span class="c">!==============</span>
<a name="ln-74"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;Comm-data&#39;</span>
<a name="ln-75"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname_yz</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;Dist-wgyz&#39;</span>
<a name="ln-76"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname_ebf</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;EB-fields&#39;</span>
<a name="ln-77"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname_env</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;ENVfields&#39;</span>
<a name="ln-78"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname_fl</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;FL-fields&#39;</span>
<a name="ln-79"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname_part</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;Particles&#39;</span>
<a name="ln-80"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname_bunchpart</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;BunchPart&#39;</span>
<a name="ln-81"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname_bunch0</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;Bunch-EB0&#39;</span>
<a name="ln-82"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname_bunch1</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;Bunch-EB1&#39;</span>
<a name="ln-83"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">foldername</span><span class="p">,</span> <span class="s1">&#39;(a11)&#39;</span><span class="p">)</span> <span class="s1">&#39;dumpRestart&#39;</span>
<a name="ln-84"></a>   <span class="c">!================field array sizes</span>
<a name="ln-85"></a>   <span class="n">nxf_loc</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-86"></a>   <span class="n">nyf_loc</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-87"></a>   <span class="n">nzf_loc</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-88"></a>   <span class="n">ebf_cp</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-89"></a>
<a name="ln-90"></a>   <span class="n">loc_grid_size</span><span class="p">(</span><span class="n">mype</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">nxf_loc</span><span class="o">*</span><span class="n">nyf_loc</span><span class="o">*</span><span class="n">nzf_loc</span> <span class="c">!allowing for different grid sizes among mpi_tasks</span>
<a name="ln-91"></a>   <span class="n">loc2d_grid_size</span><span class="p">(</span><span class="n">mype</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">nyf_loc</span><span class="o">*</span><span class="n">nzf_loc</span>
<a name="ln-92"></a>   <span class="n">lenbuff</span> <span class="o">=</span> <span class="n">ebf_cp</span>
<a name="ln-93"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">envelope</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-94"></a><span class="k">    </span><span class="n">env1_cp</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-95"></a>    <span class="n">env_cp</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-96"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">Two_color</span><span class="p">)</span> <span class="n">env1_cp</span> <span class="o">=</span> <span class="n">env_cp</span>
<a name="ln-97"></a>    <span class="n">lenbuff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lenbuff</span><span class="p">,</span> <span class="n">env_cp</span> <span class="o">+</span> <span class="n">env1_cp</span><span class="p">)</span>
<a name="ln-98"></a>   <span class="k">end if</span>
<a name="ln-99"></a><span class="k">   </span><span class="n">grid2d_size_max</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-100"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">hybrid</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-101"></a><span class="k">    </span><span class="n">fl_cp</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-102"></a>    <span class="n">lenbuff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lenbuff</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">fl_cp</span><span class="p">)</span>
<a name="ln-103"></a>    <span class="n">kk</span> <span class="o">=</span> <span class="n">loc2d_grid_size</span><span class="p">(</span><span class="n">mype</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-104"></a>    <span class="k">call </span><span class="n">intvec_distribute</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="n">loc2d_grid_size</span><span class="p">,</span> <span class="n">npe</span><span class="p">)</span>
<a name="ln-105"></a>    <span class="n">grid2d_size_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc2d_grid_size</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-106"></a>   <span class="k">end if</span>
<a name="ln-107"></a>   <span class="c">!===============================</span>
<a name="ln-108"></a>   <span class="n">kk</span> <span class="o">=</span> <span class="n">loc_grid_size</span><span class="p">(</span><span class="n">mype</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-109"></a>   <span class="k">call </span><span class="n">intvec_distribute</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="n">loc_grid_size</span><span class="p">,</span> <span class="n">npe</span><span class="p">)</span>
<a name="ln-110"></a>   <span class="n">grid_size_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_grid_size</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-111"></a>   <span class="n">lenbuff</span> <span class="o">=</span> <span class="n">lenbuff</span><span class="o">*</span><span class="n">grid_size_max</span> <span class="o">+</span> <span class="n">grid2d_size_max</span>
<a name="ln-112"></a>   <span class="c">!===============================</span>
<a name="ln-113"></a>   <span class="n">ndv</span> <span class="o">=</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-114"></a>   <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-115"></a>    <span class="n">kk</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-116"></a>    <span class="k">call </span><span class="n">intvec_distribute</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="n">ip_loc</span><span class="p">,</span> <span class="n">npe</span><span class="p">)</span>
<a name="ln-117"></a>    <span class="n">npt_arr</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">ip_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span>
<a name="ln-118"></a>   <span class="k">end do</span>
<a name="ln-119"></a><span class="k">   do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe</span>
<a name="ln-120"></a>    <span class="n">ip_loc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">npt_arr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">))</span>
<a name="ln-121"></a>   <span class="k">end do</span>
<a name="ln-122"></a><span class="k">   </span><span class="n">max_npt_size</span> <span class="o">=</span> <span class="n">ndv</span><span class="o">*</span><span class="nb">maxval</span><span class="p">(</span><span class="n">ip_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-123"></a>   <span class="n">lenbuff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lenbuff</span><span class="p">,</span> <span class="n">max_npt_size</span><span class="p">)</span>
<a name="ln-124"></a>   <span class="c">!===============================</span>
<a name="ln-125"></a>   <span class="n">dist_npy</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-126"></a>   <span class="n">dist_npz</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-127"></a>   <span class="n">dist_npy</span><span class="p">(</span><span class="n">imody</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_npty</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span>
<a name="ln-128"></a>   <span class="n">dist_npz</span><span class="p">(</span><span class="n">imodz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nptz</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span>
<a name="ln-129"></a>   <span class="c">!===============================</span>
<a name="ln-130"></a>   <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">pe0y</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-131"></a><span class="k">    </span><span class="n">sd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-132"></a>    <span class="k">call </span><span class="n">exchange_rdata_int</span><span class="p">(</span><span class="n">loc_npty</span><span class="p">,</span> <span class="n">sd</span><span class="p">,</span> <span class="n">nsp</span><span class="p">,</span> <span class="n">pe_min_y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">imody</span><span class="p">)</span>
<a name="ln-133"></a>   <span class="k">else</span>
<a name="ln-134"></a><span class="k">    </span><span class="n">sd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-135"></a>    <span class="k">do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-136"></a>     <span class="k">call </span><span class="n">exchange_rdata_int</span><span class="p">(</span><span class="n">loc_npty</span><span class="p">,</span> <span class="n">sd</span><span class="p">,</span> <span class="n">nsp</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">ipe</span><span class="p">)</span>
<a name="ln-137"></a>     <span class="n">dist_npy</span><span class="p">(</span><span class="n">ipe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_npty</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span>
<a name="ln-138"></a>    <span class="k">end do</span>
<a name="ln-139"></a><span class="k">   end if</span>
<a name="ln-140"></a><span class="k">   if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">pe0z</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-141"></a><span class="k">    </span><span class="n">sd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-142"></a>    <span class="k">call </span><span class="n">exchange_rdata_int</span><span class="p">(</span><span class="n">loc_nptz</span><span class="p">,</span> <span class="n">sd</span><span class="p">,</span> <span class="n">nsp</span><span class="p">,</span> <span class="n">pe_min_z</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">imodz</span><span class="p">)</span>
<a name="ln-143"></a>   <span class="k">else</span>
<a name="ln-144"></a><span class="k">    </span><span class="n">sd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-145"></a>    <span class="k">do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-146"></a>     <span class="k">call </span><span class="n">exchange_rdata_int</span><span class="p">(</span><span class="n">loc_nptz</span><span class="p">,</span> <span class="n">sd</span><span class="p">,</span> <span class="n">nsp</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">ipe</span><span class="p">)</span>
<a name="ln-147"></a>     <span class="n">dist_npz</span><span class="p">(</span><span class="n">ipe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nptz</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span>
<a name="ln-148"></a>    <span class="k">end do</span>
<a name="ln-149"></a><span class="k">   end if</span>
<a name="ln-150"></a>   <span class="c">!=========================</span>
<a name="ln-151"></a>   <span class="n">ndata</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-152"></a>   <span class="n">rdata</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-153"></a>   <span class="c">!====================</span>
<a name="ln-154"></a>   <span class="n">rdata</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">tloc</span>
<a name="ln-155"></a>   <span class="n">rdata</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">j0_norm</span>
<a name="ln-156"></a>   <span class="n">rdata</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ompe</span>
<a name="ln-157"></a>   <span class="n">rdata</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">targ_in</span>
<a name="ln-158"></a>   <span class="n">rdata</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">targ_end</span>
<a name="ln-159"></a>   <span class="n">rdata</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">lp_in</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-160"></a>   <span class="n">rdata</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="n">xp0_out</span>
<a name="ln-161"></a>   <span class="n">rdata</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="n">xp1_out</span>
<a name="ln-162"></a>   <span class="n">rdata</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-163"></a>
<a name="ln-164"></a>   <span class="n">ndata</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">it_loc</span>
<a name="ln-165"></a>   <span class="n">ndata</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">nxf_loc</span>
<a name="ln-166"></a>   <span class="n">ndata</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">nyf_loc</span>
<a name="ln-167"></a>   <span class="n">ndata</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">nzf_loc</span>
<a name="ln-168"></a>   <span class="n">ndata</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">nptx_max</span>
<a name="ln-169"></a>   <span class="n">ndata</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-170"></a>   <span class="n">ndata</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="n">nxf</span>
<a name="ln-171"></a>   <span class="n">ndata</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="n">nd2</span>
<a name="ln-172"></a>   <span class="c">!==========================</span>
<a name="ln-173"></a>   <span class="c">!==============</span>
<a name="ln-174"></a>   <span class="n">lun</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-175"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-176"></a><span class="k">    open</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;dumpRestart/&#39;</span><span class="o">//</span><span class="n">fname</span><span class="o">//</span><span class="s1">&#39;.bin&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-177"></a>          <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
<a name="ln-178"></a>    <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">10</span><span class="p">)</span>
<a name="ln-179"></a>    <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">ndata</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">10</span><span class="p">)</span>
<a name="ln-180"></a>    <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">nptx</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span> <span class="c">!the index of particles inside the box</span>
<a name="ln-181"></a>    <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">sptx_max</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span> <span class="c">!the max index inside the target</span>
<a name="ln-182"></a>    <span class="c">!=====================</span>
<a name="ln-183"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">targ_end</span> <span class="o">&gt;</span> <span class="n">xmax</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-184"></a><span class="k">     do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-185"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nptx_max</span>
<a name="ln-186"></a>       <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">xpt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">wghpt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-187"></a>      <span class="k">end do</span>
<a name="ln-188"></a><span class="k">     end do</span>
<a name="ln-189"></a><span class="k">     if</span> <span class="p">(</span><span class="n">hybrid</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-190"></a><span class="k">      if</span> <span class="p">(</span><span class="n">nxf</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-191"></a><span class="k">       write</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">fluid_x_profile</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nxf</span><span class="p">)</span>
<a name="ln-192"></a>      <span class="k">end if</span>
<a name="ln-193"></a><span class="k">     end if</span>
<a name="ln-194"></a><span class="k">    end if</span>
<a name="ln-195"></a><span class="k">    write</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">npt_arr</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span>
<a name="ln-196"></a>    <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">dist_npy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe_yloc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span>
<a name="ln-197"></a>    <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">dist_npz</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe_zloc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span>
<a name="ln-198"></a>    <span class="c">!==================</span>
<a name="ln-199"></a>    <span class="k">close</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span>
<a name="ln-200"></a>   <span class="k">end if</span> <span class="c">!end pe0 write on fname</span>
<a name="ln-201"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;End write Common data&#39;</span>
<a name="ln-202"></a>   <span class="c">!===========================</span>
<a name="ln-203"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">send_buff</span><span class="p">(</span><span class="n">lenbuff</span><span class="p">))</span> <span class="c">!to be used for all mpi_write()</span>
<a name="ln-204"></a>   <span class="c">!=====================</span>
<a name="ln-205"></a>   <span class="c">!=== PARTICLES DUMP SECTION ====</span>
<a name="ln-206"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">max_npt_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-207"></a><span class="k">    write</span> <span class="p">(</span><span class="n">fnamel_part</span><span class="p">,</span> <span class="s1">&#39;(a9,i2.2)&#39;</span><span class="p">)</span> <span class="s1">&#39;Particles&#39;</span><span class="p">,</span> <span class="n">imodz</span>
<a name="ln-208"></a>    <span class="n">fnamel_out</span> <span class="o">=</span> <span class="s1">&#39;dumpRestart/&#39;</span><span class="o">//</span><span class="n">fnamel_part</span><span class="o">//</span><span class="s1">&#39;.bin&#39;</span>
<a name="ln-209"></a>    <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span> <span class="o">=</span> <span class="n">ndv</span><span class="o">*</span><span class="n">ip_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span>
<a name="ln-210"></a>    <span class="n">max_npt_size</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">lenw</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-211"></a>    <span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-212"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-213"></a>     <span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-214"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">np</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-215"></a><span class="k">      do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ndv</span>
<a name="ln-216"></a>       <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-217"></a>        <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-218"></a>        <span class="n">send_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="o">=</span> <span class="n">spec</span><span class="p">(</span><span class="n">ic</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-219"></a>       <span class="k">end do</span>
<a name="ln-220"></a><span class="k">      end do</span>
<a name="ln-221"></a><span class="k">     end if</span>
<a name="ln-222"></a><span class="k">    end do</span>
<a name="ln-223"></a><span class="k">    </span><span class="n">disp_col</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-224"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">mype</span><span class="p">,</span> <span class="n">npe_yloc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">disp_col</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">lenw</span><span class="p">(</span><span class="n">imodz</span><span class="o">*</span><span class="n">npe_yloc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">mype</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-225"></a>                                                <span class="p">)</span>
<a name="ln-226"></a>    <span class="n">disp_col</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">disp_col</span>
<a name="ln-227"></a>    <span class="k">call </span><span class="n">mpi_write_col_dp</span><span class="p">(</span><span class="n">send_buff</span><span class="p">,</span> <span class="n">lenw</span><span class="p">(</span><span class="n">mype</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">disp_col</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-228"></a>                          <span class="n">fnamel_out</span><span class="p">)</span>
<a name="ln-229"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Particles data dumped&#39;</span>
<a name="ln-230"></a>   <span class="n">endif</span>
<a name="ln-231"></a>   <span class="c">!=== END PARTICLES DUMP SECTION ===</span>
<a name="ln-232"></a>
<a name="ln-233"></a>   <span class="c">!=== ELECTROMAGNETIC FIELD DUMP SECTION ===</span>
<a name="ln-234"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fnamel_ebf</span><span class="p">,</span> <span class="s1">&#39;(a9,i2.2)&#39;</span><span class="p">)</span> <span class="s1">&#39;EB-fields&#39;</span><span class="p">,</span> <span class="n">imodz</span>
<a name="ln-235"></a>   <span class="n">fnamel_out</span> <span class="o">=</span> <span class="s1">&#39;dumpRestart/&#39;</span><span class="o">//</span><span class="n">fnamel_ebf</span><span class="o">//</span><span class="s1">&#39;.bin&#39;</span>
<a name="ln-236"></a>   <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebf_cp</span><span class="o">*</span><span class="n">loc_grid_size</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span>
<a name="ln-237"></a>   <span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-238"></a>   <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ebf_cp</span>
<a name="ln-239"></a>    <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nzf_loc</span>
<a name="ln-240"></a>     <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nyf_loc</span>
<a name="ln-241"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nxf_loc</span>
<a name="ln-242"></a>       <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-243"></a>       <span class="n">send_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebf</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-244"></a>      <span class="k">end do</span>
<a name="ln-245"></a><span class="k">     end do</span>
<a name="ln-246"></a><span class="k">    end do</span>
<a name="ln-247"></a><span class="k">   end do</span>
<a name="ln-248"></a>
<a name="ln-249"></a><span class="k">   </span><span class="n">disp</span> <span class="o">=</span> <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">mype</span><span class="p">)</span>
<a name="ln-250"></a>   <span class="n">disp_col</span> <span class="o">=</span> <span class="n">imody</span><span class="o">*</span><span class="n">disp</span>
<a name="ln-251"></a>   <span class="n">disp_col</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">disp_col</span>
<a name="ln-252"></a>   <span class="k">call </span><span class="n">mpi_write_col_dp</span><span class="p">(</span><span class="n">send_buff</span><span class="p">,</span> <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">mype</span><span class="p">),</span> <span class="n">disp_col</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-253"></a>                         <span class="n">fnamel_out</span><span class="p">)</span>
<a name="ln-254"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Electromagnetic fields data dumped&#39;</span>
<a name="ln-255"></a>   <span class="c">!=== END ELECTROMAGNETIC FIELD DUMP SECTION ===</span>
<a name="ln-256"></a>
<a name="ln-257"></a>   <span class="c">!=== ENVELOPE FIELD DUMP SECTION ===</span>
<a name="ln-258"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">envelope</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-259"></a><span class="k">    write</span> <span class="p">(</span><span class="n">fnamel_env</span><span class="p">,</span> <span class="s1">&#39;(a9,i2.2)&#39;</span><span class="p">)</span> <span class="s1">&#39;ENVfields&#39;</span><span class="p">,</span> <span class="n">imodz</span>
<a name="ln-260"></a>    <span class="n">fnamel_out</span> <span class="o">=</span> <span class="s1">&#39;dumpRestart/&#39;</span><span class="o">//</span><span class="n">fnamel_env</span><span class="o">//</span><span class="s1">&#39;.bin&#39;</span>
<a name="ln-261"></a>    <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">env_cp</span> <span class="o">+</span> <span class="n">env1_cp</span><span class="p">)</span><span class="o">*</span><span class="n">loc_grid_size</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span>
<a name="ln-262"></a>    <span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-263"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">env_cp</span>
<a name="ln-264"></a>     <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nzf_loc</span>
<a name="ln-265"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nyf_loc</span>
<a name="ln-266"></a>       <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nxf_loc</span>
<a name="ln-267"></a>        <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-268"></a>        <span class="n">send_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="o">=</span> <span class="n">env</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-269"></a>       <span class="k">end do</span>
<a name="ln-270"></a><span class="k">      end do</span>
<a name="ln-271"></a><span class="k">     end do</span>
<a name="ln-272"></a><span class="k">    end do</span>
<a name="ln-273"></a><span class="k">    if</span> <span class="p">(</span><span class="n">Two_color</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-274"></a><span class="k">     do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">env1_cp</span>
<a name="ln-275"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nzf_loc</span>
<a name="ln-276"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nyf_loc</span>
<a name="ln-277"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nxf_loc</span>
<a name="ln-278"></a>         <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-279"></a>         <span class="n">send_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="o">=</span> <span class="n">env1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-280"></a>        <span class="k">end do</span>
<a name="ln-281"></a><span class="k">       end do</span>
<a name="ln-282"></a><span class="k">      end do</span>
<a name="ln-283"></a><span class="k">     end do</span>
<a name="ln-284"></a><span class="k">    end if</span>
<a name="ln-285"></a><span class="k">    </span><span class="n">disp</span> <span class="o">=</span> <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">mype</span><span class="p">)</span>
<a name="ln-286"></a>    <span class="n">disp_col</span> <span class="o">=</span> <span class="n">imody</span><span class="o">*</span><span class="n">disp</span>
<a name="ln-287"></a>    <span class="n">disp_col</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">disp_col</span>
<a name="ln-288"></a>    <span class="k">call </span><span class="n">mpi_write_col_dp</span><span class="p">(</span><span class="n">send_buff</span><span class="p">,</span> <span class="n">lenw</span><span class="p">(</span><span class="n">mype</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">disp_col</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-289"></a>                          <span class="n">fnamel_out</span><span class="p">)</span>
<a name="ln-290"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Envelope field data dumped&#39;</span>
<a name="ln-291"></a>   <span class="k">end if</span>
<a name="ln-292"></a>   <span class="c">!=== END ENVELOPE FIELD DUMP SECTION ===</span>
<a name="ln-293"></a>
<a name="ln-294"></a>   <span class="c">!=== FLUID DUMP SECTION ===</span>
<a name="ln-295"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">hybrid</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-296"></a><span class="k">    write</span> <span class="p">(</span><span class="n">fnamel_fl</span><span class="p">,</span> <span class="s1">&#39;(a9,i2.2)&#39;</span><span class="p">)</span> <span class="s1">&#39;FL-fields&#39;</span><span class="p">,</span> <span class="n">imodz</span>
<a name="ln-297"></a>    <span class="n">fnamel_out</span> <span class="o">=</span> <span class="s1">&#39;dumpRestart/&#39;</span><span class="o">//</span><span class="n">fnamel_fl</span><span class="o">//</span><span class="s1">&#39;.bin&#39;</span>
<a name="ln-298"></a>    <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">fl_cp</span><span class="o">*</span><span class="n">loc_grid_size</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span> <span class="o">+</span> <span class="n">loc2d_grid_size</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span>
<a name="ln-299"></a>    <span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-300"></a>    <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nzf_loc</span>
<a name="ln-301"></a>     <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nyf_loc</span>
<a name="ln-302"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-303"></a>      <span class="n">send_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="o">=</span> <span class="n">fluid_yz_profile</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-304"></a>     <span class="k">end do</span>
<a name="ln-305"></a><span class="k">    end do</span>
<a name="ln-306"></a><span class="k">    do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fl_cp</span>
<a name="ln-307"></a>     <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nzf_loc</span>
<a name="ln-308"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nyf_loc</span>
<a name="ln-309"></a>       <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nxf_loc</span>
<a name="ln-310"></a>        <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-311"></a>        <span class="n">send_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="o">=</span> <span class="n">up</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-312"></a>       <span class="k">end do</span>
<a name="ln-313"></a><span class="k">      end do</span>
<a name="ln-314"></a><span class="k">     end do</span>
<a name="ln-315"></a><span class="k">    end do</span>
<a name="ln-316"></a><span class="k">    do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fl_cp</span>
<a name="ln-317"></a>     <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nzf_loc</span>
<a name="ln-318"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nyf_loc</span>
<a name="ln-319"></a>       <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nxf_loc</span>
<a name="ln-320"></a>        <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-321"></a>        <span class="n">send_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="o">=</span> <span class="n">up0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-322"></a>       <span class="k">end do</span>
<a name="ln-323"></a><span class="k">      end do</span>
<a name="ln-324"></a><span class="k">     end do</span>
<a name="ln-325"></a><span class="k">    end do</span>
<a name="ln-326"></a><span class="k">    </span><span class="n">disp</span> <span class="o">=</span> <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">mype</span><span class="p">)</span>
<a name="ln-327"></a>    <span class="n">disp_col</span> <span class="o">=</span> <span class="n">imody</span><span class="o">*</span><span class="n">disp</span>
<a name="ln-328"></a>    <span class="n">disp_col</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">disp_col</span>
<a name="ln-329"></a>    <span class="k">call </span><span class="n">mpi_write_col_dp</span><span class="p">(</span><span class="n">send_buff</span><span class="p">,</span> <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">mype</span><span class="p">),</span> <span class="n">disp_col</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-330"></a>                          <span class="n">fnamel_out</span><span class="p">)</span>
<a name="ln-331"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Fluid density and momentum data dumped&#39;</span>
<a name="ln-332"></a>   <span class="k">end if</span>
<a name="ln-333"></a>
<a name="ln-334"></a>   <span class="c">!=== END FLUID DUMP SECTION ===</span>
<a name="ln-335"></a>   <span class="c">!============== write (y,z,wghyz initial part distribution</span>
<a name="ln-336"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-337"></a><span class="k">    </span><span class="n">fname_out</span> <span class="o">=</span> <span class="s1">&#39;dumpRestart/&#39;</span><span class="o">//</span><span class="n">fname_yz</span><span class="o">//</span><span class="s1">&#39;.bin&#39;</span>
<a name="ln-338"></a>    <span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-339"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-340"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">loc_npty</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-341"></a><span class="k">      do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loc_npty</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-342"></a>       <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-343"></a>       <span class="n">send_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_ypt</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-344"></a>      <span class="k">end do</span>
<a name="ln-345"></a><span class="k">     end if</span>
<a name="ln-346"></a><span class="k">    end do</span>
<a name="ln-347"></a><span class="k">    do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-348"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">loc_nptz</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-349"></a><span class="k">      do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loc_nptz</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-350"></a>       <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-351"></a>       <span class="n">send_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_zpt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-352"></a>      <span class="k">end do</span>
<a name="ln-353"></a><span class="k">     end if</span>
<a name="ln-354"></a><span class="k">    end do</span>
<a name="ln-355"></a>    <span class="c">!===============================</span>
<a name="ln-356"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-357"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">loc_nptz</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-358"></a><span class="k">      do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loc_nptz</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-359"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">loc_npty</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-360"></a><span class="k">        do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loc_npty</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-361"></a>         <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-362"></a>         <span class="n">send_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_wghyz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-363"></a>        <span class="k">end do</span>
<a name="ln-364"></a><span class="k">       end if</span>
<a name="ln-365"></a><span class="k">      end do</span>
<a name="ln-366"></a><span class="k">     end if</span>
<a name="ln-367"></a><span class="k">    end do</span>
<a name="ln-368"></a><span class="k">    call </span><span class="n">intvec_distribute</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">npe</span><span class="p">)</span>
<a name="ln-369"></a>    <span class="n">disp</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-370"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">mype</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">disp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">lenw</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">mype</span><span class="p">))</span>
<a name="ln-371"></a>    <span class="n">disp</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">disp</span>
<a name="ln-372"></a>    <span class="k">call </span><span class="n">mpi_write_dp</span><span class="p">(</span><span class="n">send_buff</span><span class="p">,</span> <span class="n">lenw</span><span class="p">(</span><span class="n">mype</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">disp</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">fname_out</span><span class="p">)</span>
<a name="ln-373"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-374"></a>     <span class="s1">&#39;Incoming plasma target transverse distribution data dumped&#39;</span>
<a name="ln-375"></a>   <span class="k">end if</span>
<a name="ln-376"></a><span class="k">   deallocate</span> <span class="p">(</span><span class="n">send_buff</span><span class="p">)</span>
<a name="ln-377"></a>   <span class="c">!====================</span>
<a name="ln-378"></a>   <span class="n">unix_time_last_dump</span> <span class="o">=</span> <span class="n">unix_time_now</span>
<a name="ln-379"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;END TOTAL DUMP WRITE&#39;</span>
<a name="ln-380"></a>  <span class="k">end subroutine</span>
<a name="ln-381"></a>  <span class="c">!==============================================================</span>
<a name="ln-382"></a>  <span class="k">subroutine </span><span class="n">restart</span><span class="p">(</span><span class="n">it_loc</span><span class="p">,</span> <span class="n">tloc</span><span class="p">)</span>
<a name="ln-383"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">it_loc</span>
<a name="ln-384"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tloc</span>
<a name="ln-385"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;         &#39;</span>
<a name="ln-386"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_yz</span> <span class="o">=</span> <span class="s1">&#39;         &#39;</span>
<a name="ln-387"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_ebf</span> <span class="o">=</span> <span class="s1">&#39;         &#39;</span>
<a name="ln-388"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_env</span> <span class="o">=</span> <span class="s1">&#39;         &#39;</span>
<a name="ln-389"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_fl</span> <span class="o">=</span> <span class="s1">&#39;         &#39;</span>
<a name="ln-390"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_part</span> <span class="o">=</span> <span class="s1">&#39;         &#39;</span>
<a name="ln-391"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_bunch0</span> <span class="o">=</span> <span class="s1">&#39;        &#39;</span>
<a name="ln-392"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_bunch1</span> <span class="o">=</span> <span class="s1">&#39;        &#39;</span>
<a name="ln-393"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_bunchpart</span> <span class="o">=</span> <span class="s1">&#39;         &#39;</span>
<a name="ln-394"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fnamel_part</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
<a name="ln-395"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fnamel_bunch0</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
<a name="ln-396"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fnamel_bunch1</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
<a name="ln-397"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fnamel_bunchpart</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
<a name="ln-398"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fnamel_ebf</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
<a name="ln-399"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fnamel_env</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
<a name="ln-400"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fnamel_fl</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
<a name="ln-401"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="kd">::</span> <span class="n">foldername</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
<a name="ln-402"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname_out</span> <span class="o">=</span> <span class="s1">&#39;                         &#39;</span>
<a name="ln-403"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">27</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fnamel_out</span> <span class="o">=</span> <span class="s1">&#39;                           &#39;</span>
<a name="ln-404"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp_col</span><span class="p">,</span> <span class="n">disp</span>
<a name="ln-405"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">max_npt_size</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">npt_arr</span><span class="p">(</span><span class="n">npe</span><span class="p">,</span> <span class="n">nsp</span><span class="p">)</span>
<a name="ln-406"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">k1</span><span class="p">,</span> <span class="n">ndv</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">lun</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">kk</span><span class="p">,</span> <span class="n">lenw</span><span class="p">(</span><span class="n">npe</span><span class="p">),</span> <span class="n">lenbuff</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-407"></a>              <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span>
<a name="ln-408"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ip_loc</span><span class="p">(</span><span class="n">npe</span><span class="p">),</span> <span class="n">loc_grid_size</span><span class="p">(</span><span class="n">npe</span><span class="p">),</span> <span class="n">loc2d_grid_size</span><span class="p">(</span><span class="n">npe</span><span class="p">)</span>
<a name="ln-409"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">grid_size_max</span><span class="p">,</span> <span class="n">grid2d_size_max</span>
<a name="ln-410"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">env_cp</span><span class="p">,</span> <span class="n">env1_cp</span><span class="p">,</span> <span class="n">fl_cp</span><span class="p">,</span> <span class="n">ebf_cp</span>
<a name="ln-411"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ndata</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">nps_loc</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">n1_old</span>
<a name="ln-412"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">n1_loc</span><span class="p">,</span> <span class="n">n2_loc</span><span class="p">,</span> <span class="n">n3_loc</span><span class="p">,</span> <span class="n">nypt_max</span><span class="p">,</span> <span class="n">nzpt_max</span>
<a name="ln-413"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">dist_npy</span><span class="p">(</span><span class="n">npe_yloc</span><span class="p">,</span> <span class="n">nsp</span><span class="p">),</span> <span class="n">dist_npz</span><span class="p">(</span><span class="n">npe_zloc</span><span class="p">,</span> <span class="n">nsp</span><span class="p">)</span>
<a name="ln-414"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">x0_new</span>
<a name="ln-415"></a>   <span class="kt">logical</span> <span class="kd">::</span> <span class="n">sd</span>
<a name="ln-416"></a>
<a name="ln-417"></a>   <span class="c">!==============</span>
<a name="ln-418"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;Comm-data&#39;</span>
<a name="ln-419"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname_ebf</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;EB-fields&#39;</span>
<a name="ln-420"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname_env</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;ENVfields&#39;</span>
<a name="ln-421"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname_fl</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;FL-fields&#39;</span>
<a name="ln-422"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname_part</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;Particles&#39;</span>
<a name="ln-423"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname_bunch0</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;Bunch-EB0&#39;</span>
<a name="ln-424"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname_bunch1</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;Bunch-EB1&#39;</span>
<a name="ln-425"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname_bunchpart</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;BunchPart&#39;</span>
<a name="ln-426"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">foldername</span><span class="p">,</span> <span class="s1">&#39;(a11)&#39;</span><span class="p">)</span> <span class="s1">&#39;dumpRestart&#39;</span>
<a name="ln-427"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fname_yz</span><span class="p">,</span> <span class="s1">&#39;(a9)&#39;</span><span class="p">)</span> <span class="s1">&#39;Dist-wgyz&#39;</span>
<a name="ln-428"></a>   <span class="c">!==============       Already defined data</span>
<a name="ln-429"></a>   <span class="n">n1_loc</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-430"></a>   <span class="n">n2_loc</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-431"></a>   <span class="n">n3_loc</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-432"></a>   <span class="n">ebf_cp</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-433"></a>   <span class="c">!===================</span>
<a name="ln-434"></a>   <span class="n">loc_grid_size</span><span class="p">(</span><span class="n">mype</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">n1_loc</span><span class="o">*</span><span class="n">n2_loc</span><span class="o">*</span><span class="n">n3_loc</span>
<a name="ln-435"></a>   <span class="n">loc2d_grid_size</span><span class="p">(</span><span class="n">mype</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">n2_loc</span><span class="o">*</span><span class="n">n3_loc</span>
<a name="ln-436"></a>   <span class="n">lenbuff</span> <span class="o">=</span> <span class="n">ebf_cp</span>
<a name="ln-437"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">envelope</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-438"></a><span class="k">    </span><span class="n">env1_cp</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-439"></a>    <span class="n">env_cp</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-440"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">Two_color</span><span class="p">)</span> <span class="n">env1_cp</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">env1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-441"></a>    <span class="n">lenbuff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lenbuff</span><span class="p">,</span> <span class="n">env_cp</span> <span class="o">+</span> <span class="n">env1_cp</span><span class="p">)</span>
<a name="ln-442"></a>   <span class="k">end if</span>
<a name="ln-443"></a><span class="k">   </span><span class="n">grid2d_size_max</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-444"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">hybrid</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-445"></a><span class="k">    </span><span class="n">fl_cp</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-446"></a>    <span class="n">lenbuff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lenbuff</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">fl_cp</span><span class="p">)</span>
<a name="ln-447"></a>    <span class="n">kk</span> <span class="o">=</span> <span class="n">loc2d_grid_size</span><span class="p">(</span><span class="n">mype</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-448"></a>    <span class="k">call </span><span class="n">intvec_distribute</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="n">loc2d_grid_size</span><span class="p">,</span> <span class="n">npe</span><span class="p">)</span>
<a name="ln-449"></a>    <span class="n">grid2d_size_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc2d_grid_size</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-450"></a>   <span class="k">end if</span>
<a name="ln-451"></a><span class="k">   </span><span class="n">kk</span> <span class="o">=</span> <span class="n">loc_grid_size</span><span class="p">(</span><span class="n">mype</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-452"></a>   <span class="k">call </span><span class="n">intvec_distribute</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="n">loc_grid_size</span><span class="p">,</span> <span class="n">npe</span><span class="p">)</span>
<a name="ln-453"></a>   <span class="n">grid_size_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_grid_size</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-454"></a>   <span class="n">lenbuff</span> <span class="o">=</span> <span class="n">lenbuff</span><span class="o">*</span><span class="n">grid_size_max</span> <span class="o">+</span> <span class="n">grid2d_size_max</span>
<a name="ln-455"></a>   <span class="c">!===================</span>
<a name="ln-456"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Max size of recieve buffer&#39;</span><span class="p">,</span> <span class="n">lenbuff</span>
<a name="ln-457"></a>   <span class="n">lun</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-458"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-459"></a><span class="k">    open</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;dumpRestart/&#39;</span><span class="o">//</span><span class="n">fname</span><span class="o">//</span><span class="s1">&#39;.bin&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-460"></a>          <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
<a name="ln-461"></a>
<a name="ln-462"></a>    <span class="k">read</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">10</span><span class="p">)</span>
<a name="ln-463"></a>    <span class="k">read</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">ndata</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">10</span><span class="p">)</span>
<a name="ln-464"></a>    <span class="k">read</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">nptx</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span>
<a name="ln-465"></a>    <span class="k">read</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">sptx_max</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span>
<a name="ln-466"></a>    <span class="n">it_loc</span> <span class="o">=</span> <span class="n">ndata</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-467"></a>    <span class="n">nptx_max</span> <span class="o">=</span> <span class="n">ndata</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-468"></a>    <span class="n">n1_old</span> <span class="o">=</span> <span class="n">ndata</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-469"></a>    <span class="n">nxf</span> <span class="o">=</span> <span class="n">ndata</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-470"></a>    <span class="n">ndv</span> <span class="o">=</span> <span class="n">ndata</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-471"></a>    <span class="c">!=========================</span>
<a name="ln-472"></a>    <span class="n">tloc</span> <span class="o">=</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-473"></a>    <span class="n">targ_in</span> <span class="o">=</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-474"></a>    <span class="n">targ_end</span> <span class="o">=</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-475"></a>    <span class="n">lp_in</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-476"></a>    <span class="n">x0_new</span> <span class="o">=</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<a name="ln-477"></a>    <span class="c">!=============================</span>
<a name="ln-478"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">targ_end</span> <span class="o">&gt;</span> <span class="n">xmax</span> <span class="o">+</span> <span class="n">x0_new</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-479"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">xpt</span><span class="p">(</span><span class="n">nptx_max</span><span class="p">,</span> <span class="n">nsp</span><span class="p">))</span>
<a name="ln-480"></a>     <span class="k">allocate</span> <span class="p">(</span><span class="n">wghpt</span><span class="p">(</span><span class="n">nptx_max</span><span class="p">,</span> <span class="n">nsp</span><span class="p">))</span>
<a name="ln-481"></a>     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-482"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nptx_max</span>
<a name="ln-483"></a>       <span class="k">read</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">xpt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">wghpt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-484"></a>      <span class="k">end do</span>
<a name="ln-485"></a><span class="k">     end do</span>
<a name="ln-486"></a><span class="k">     if</span> <span class="p">(</span><span class="n">hybrid</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-487"></a><span class="k">      if</span> <span class="p">(</span><span class="n">nxf</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-488"></a><span class="k">       allocate</span> <span class="p">(</span><span class="n">fluid_x_profile</span><span class="p">(</span><span class="n">nxf</span><span class="p">))</span>
<a name="ln-489"></a>       <span class="k">read</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">fluid_x_profile</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nxf</span><span class="p">)</span>
<a name="ln-490"></a>      <span class="k">end if</span>
<a name="ln-491"></a><span class="k">     end if</span>
<a name="ln-492"></a><span class="k">    end if</span>
<a name="ln-493"></a><span class="c">!==================== dumped by pe0 even if no particles are present</span>
<a name="ln-494"></a>    <span class="k">read</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">npt_arr</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span>
<a name="ln-495"></a>    <span class="k">read</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">dist_npy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe_yloc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span>
<a name="ln-496"></a>    <span class="k">read</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span> <span class="n">dist_npz</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe_zloc</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span>
<a name="ln-497"></a>    <span class="k">close</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span>
<a name="ln-498"></a>   <span class="k">end if</span> <span class="c">!end pe0 read on fname</span>
<a name="ln-499"></a>   <span class="c">!========================= distribute comm data</span>
<a name="ln-500"></a>   <span class="n">kk</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">rdata</span><span class="p">)</span>
<a name="ln-501"></a>   <span class="n">k1</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ndata</span><span class="p">)</span>
<a name="ln-502"></a>   <span class="n">k2</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">nptx</span><span class="p">)</span>
<a name="ln-503"></a>   <span class="n">k3</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">sptx_max</span><span class="p">)</span>
<a name="ln-504"></a>   <span class="k">call </span><span class="n">vint_bcast</span><span class="p">(</span><span class="n">ndata</span><span class="p">,</span> <span class="n">k1</span><span class="p">)</span>
<a name="ln-505"></a>   <span class="k">call </span><span class="n">vint_bcast</span><span class="p">(</span><span class="n">nptx</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
<a name="ln-506"></a>   <span class="k">call </span><span class="n">vint_bcast</span><span class="p">(</span><span class="n">sptx_max</span><span class="p">,</span> <span class="n">k3</span><span class="p">)</span>
<a name="ln-507"></a>   <span class="k">call </span><span class="n">real_bcast</span><span class="p">(</span><span class="n">rdata</span><span class="p">,</span> <span class="n">kk</span><span class="p">)</span>
<a name="ln-508"></a>   <span class="n">it_loc</span> <span class="o">=</span> <span class="n">ndata</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-509"></a>   <span class="n">nptx_max</span> <span class="o">=</span> <span class="n">ndata</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-510"></a>   <span class="n">n1_old</span> <span class="o">=</span> <span class="n">ndata</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-511"></a>   <span class="n">nxf</span> <span class="o">=</span> <span class="n">ndata</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-512"></a>   <span class="n">ndv</span> <span class="o">=</span> <span class="n">ndata</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-513"></a>   <span class="c">!=========================</span>
<a name="ln-514"></a>   <span class="n">tloc</span> <span class="o">=</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-515"></a>   <span class="n">targ_in</span> <span class="o">=</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-516"></a>   <span class="n">targ_end</span> <span class="o">=</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-517"></a>   <span class="n">lp_in</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-518"></a>   <span class="n">x0_new</span> <span class="o">=</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<a name="ln-519"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">x0_new</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-520"></a><span class="k">    </span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x0_new</span>
<a name="ln-521"></a>    <span class="n">xh</span> <span class="o">=</span> <span class="n">xh</span> <span class="o">+</span> <span class="n">x0_new</span>
<a name="ln-522"></a>    <span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin</span> <span class="o">+</span> <span class="n">x0_new</span>
<a name="ln-523"></a>    <span class="n">xmax</span> <span class="o">=</span> <span class="n">xmax</span> <span class="o">+</span> <span class="n">x0_new</span>
<a name="ln-524"></a>    <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmin</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmin</span> <span class="o">+</span> <span class="n">x0_new</span>
<a name="ln-525"></a>    <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmax</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmax</span> <span class="o">+</span> <span class="n">x0_new</span>
<a name="ln-526"></a>    <span class="n">xp0_out</span> <span class="o">=</span> <span class="n">xp0_out</span> <span class="o">+</span> <span class="n">x0_new</span>
<a name="ln-527"></a>    <span class="n">xp1_out</span> <span class="o">=</span> <span class="n">xp1_out</span> <span class="o">+</span> <span class="n">x0_new</span>
<a name="ln-528"></a>    <span class="n">xmn</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-529"></a>   <span class="k">end if</span>
<a name="ln-530"></a><span class="k">   if</span> <span class="p">(</span><span class="n">targ_end</span> <span class="o">&gt;</span> <span class="n">xmax</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-531"></a><span class="k">    if</span> <span class="p">(</span><span class="n">mype</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-532"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">xpt</span><span class="p">(</span><span class="n">nptx_max</span><span class="p">,</span> <span class="n">nsp</span><span class="p">))</span>
<a name="ln-533"></a>     <span class="k">allocate</span> <span class="p">(</span><span class="n">wghpt</span><span class="p">(</span><span class="n">nptx_max</span><span class="p">,</span> <span class="n">nsp</span><span class="p">))</span>
<a name="ln-534"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">hybrid</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-535"></a><span class="k">      if</span> <span class="p">(</span><span class="n">nxf</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">allocate</span> <span class="p">(</span><span class="n">fluid_x_profile</span><span class="p">(</span><span class="n">nxf</span><span class="p">))</span>
<a name="ln-536"></a>     <span class="k">end if</span>
<a name="ln-537"></a><span class="k">    end if</span>
<a name="ln-538"></a><span class="k">    if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-539"></a><span class="k">     </span><span class="n">sd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-540"></a>     <span class="k">do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-541"></a>      <span class="k">call </span><span class="n">exchange_2d_grdata</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">xpt</span><span class="p">,</span> <span class="n">nptx_max</span><span class="p">,</span> <span class="n">nsp</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">ipe</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span>
<a name="ln-542"></a>      <span class="k">call </span><span class="n">exchange_2d_grdata</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">wghpt</span><span class="p">,</span> <span class="n">nptx_max</span><span class="p">,</span> <span class="n">nsp</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">ipe</span> <span class="o">+</span> <span class="mi">400</span><span class="p">)</span>
<a name="ln-543"></a>     <span class="k">end do</span>
<a name="ln-544"></a><span class="k">    else</span>
<a name="ln-545"></a><span class="k">     </span><span class="n">sd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-546"></a>     <span class="k">call </span><span class="n">exchange_2d_grdata</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">xpt</span><span class="p">,</span> <span class="n">nptx_max</span><span class="p">,</span> <span class="n">nsp</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">mype</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span>
<a name="ln-547"></a>     <span class="k">call </span><span class="n">exchange_2d_grdata</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">wghpt</span><span class="p">,</span> <span class="n">nptx_max</span><span class="p">,</span> <span class="n">nsp</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">mype</span> <span class="o">+</span> <span class="mi">400</span><span class="p">)</span>
<a name="ln-548"></a>    <span class="n">endif</span>
<a name="ln-549"></a>    <span class="c">!===========================</span>
<a name="ln-550"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">hybrid</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-551"></a><span class="k">     if</span> <span class="p">(</span><span class="n">nxf</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-552"></a><span class="k">      if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-553"></a><span class="k">       </span><span class="n">sd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-554"></a>       <span class="k">do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-555"></a>        <span class="k">call </span><span class="n">exchange_1d_grdata</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">fluid_x_profile</span><span class="p">,</span> <span class="n">nxf</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">ipe</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
<a name="ln-556"></a>       <span class="k">end do</span>
<a name="ln-557"></a><span class="k">      else</span>
<a name="ln-558"></a><span class="k">       </span><span class="n">sd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-559"></a>       <span class="k">call </span><span class="n">exchange_1d_grdata</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">fluid_x_profile</span><span class="p">,</span> <span class="n">nxf</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">mype</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
<a name="ln-560"></a>      <span class="n">endif</span>
<a name="ln-561"></a>     <span class="k">end if</span>
<a name="ln-562"></a><span class="k">    end if</span>
<a name="ln-563"></a><span class="k">   end if</span>
<a name="ln-564"></a>   <span class="c">!Pe0 distributes npart =&gt; npt(npe,nsp)</span>
<a name="ln-565"></a>   <span class="k">call </span><span class="n">vint_2d_bcast</span><span class="p">(</span><span class="n">npt_arr</span><span class="p">,</span> <span class="n">npe</span><span class="p">,</span> <span class="n">nsp</span><span class="p">)</span>
<a name="ln-566"></a>   <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe</span>
<a name="ln-567"></a>    <span class="n">ip_loc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">npt_arr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">))</span>
<a name="ln-568"></a>   <span class="k">end do</span>
<a name="ln-569"></a><span class="k">   </span><span class="n">max_npt_size</span> <span class="o">=</span> <span class="n">ndv</span><span class="o">*</span><span class="nb">maxval</span><span class="p">(</span><span class="n">ip_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-570"></a>   <span class="n">lenbuff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lenbuff</span><span class="p">,</span> <span class="n">max_npt_size</span><span class="p">)</span>
<a name="ln-571"></a>   <span class="n">ipe</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-572"></a>   <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-573"></a>    <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-574"></a>     <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-575"></a>      <span class="n">loc_npart</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span> <span class="o">=</span> <span class="n">npt_arr</span><span class="p">(</span><span class="n">ipe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span>
<a name="ln-576"></a>      <span class="n">ipe</span> <span class="o">=</span> <span class="n">ipe</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-577"></a>     <span class="k">end do</span>
<a name="ln-578"></a><span class="k">    end do</span>
<a name="ln-579"></a><span class="k">   end do</span>
<a name="ln-580"></a>   <span class="c">!========== distributes npty,nptz initial particle distribution</span>
<a name="ln-581"></a>   <span class="k">call </span><span class="n">vint_2d_bcast</span><span class="p">(</span><span class="n">dist_npy</span><span class="p">,</span> <span class="n">npe_yloc</span><span class="p">,</span> <span class="n">nsp</span><span class="p">)</span>
<a name="ln-582"></a>   <span class="k">call </span><span class="n">vint_2d_bcast</span><span class="p">(</span><span class="n">dist_npz</span><span class="p">,</span> <span class="n">npe_zloc</span><span class="p">,</span> <span class="n">nsp</span><span class="p">)</span>
<a name="ln-583"></a>   <span class="n">loc_npty</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span> <span class="o">=</span> <span class="n">dist_npy</span><span class="p">(</span><span class="n">imody</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span>
<a name="ln-584"></a>   <span class="n">loc_nptz</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span> <span class="o">=</span> <span class="n">dist_npz</span><span class="p">(</span><span class="n">imodz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">)</span>
<a name="ln-585"></a>   <span class="n">nypt_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_npty</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">))</span>
<a name="ln-586"></a>   <span class="n">nzpt_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_nptz</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">))</span>
<a name="ln-587"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_ypt</span><span class="p">(</span><span class="n">nypt_max</span><span class="p">,</span> <span class="n">nsp</span><span class="p">))</span>
<a name="ln-588"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_zpt</span><span class="p">(</span><span class="n">nzpt_max</span><span class="p">,</span> <span class="n">nsp</span><span class="p">))</span>
<a name="ln-589"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_wghyz</span><span class="p">(</span><span class="n">nypt_max</span><span class="p">,</span> <span class="n">nzpt_max</span><span class="p">,</span> <span class="n">nsp</span><span class="p">))</span>
<a name="ln-590"></a>   <span class="c">! x() defined on the grid module starting from x(1)=0.0</span>
<a name="ln-591"></a>   <span class="c">!---------- Particle read</span>
<a name="ln-592"></a>   <span class="c">!============================================</span>
<a name="ln-593"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">recv_buff</span><span class="p">(</span><span class="n">lenbuff</span><span class="p">))</span>
<a name="ln-594"></a>   <span class="n">recv_buff</span><span class="p">(:)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-595"></a>   <span class="c">!=== FLUID RESTART SECTION ===</span>
<a name="ln-596"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">hybrid</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-597"></a><span class="k">    write</span> <span class="p">(</span><span class="n">fnamel_fl</span><span class="p">,</span> <span class="s1">&#39;(a9,i2.2)&#39;</span><span class="p">)</span> <span class="s1">&#39;FL-fields&#39;</span><span class="p">,</span> <span class="n">imodz</span>
<a name="ln-598"></a>    <span class="n">fnamel_out</span> <span class="o">=</span> <span class="s1">&#39;dumpRestart/&#39;</span><span class="o">//</span><span class="n">fnamel_fl</span><span class="o">//</span><span class="s1">&#39;.bin&#39;</span>
<a name="ln-599"></a>    <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">fl_cp</span><span class="o">*</span><span class="n">loc_grid_size</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span> <span class="o">+</span> <span class="n">loc2d_grid_size</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span>
<a name="ln-600"></a>    <span class="c">!==========================</span>
<a name="ln-601"></a>    <span class="n">disp</span> <span class="o">=</span> <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">mype</span><span class="p">)</span>
<a name="ln-602"></a>    <span class="n">disp_col</span> <span class="o">=</span> <span class="n">imody</span><span class="o">*</span><span class="n">disp</span>
<a name="ln-603"></a>    <span class="n">disp_col</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">disp_col</span>
<a name="ln-604"></a>    <span class="k">call </span><span class="n">mpi_read_col_dp</span><span class="p">(</span><span class="n">recv_buff</span><span class="p">,</span> <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">mype</span><span class="p">),</span> <span class="n">disp_col</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-605"></a>                         <span class="n">fnamel_out</span><span class="p">)</span>
<a name="ln-606"></a>    <span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-607"></a>    <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n3_loc</span>
<a name="ln-608"></a>     <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n2_loc</span>
<a name="ln-609"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-610"></a>      <span class="n">fluid_yz_profile</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">recv_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-611"></a>     <span class="k">end do</span>
<a name="ln-612"></a><span class="k">    end do</span>
<a name="ln-613"></a><span class="k">    do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fl_cp</span>
<a name="ln-614"></a>     <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n3_loc</span>
<a name="ln-615"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n2_loc</span>
<a name="ln-616"></a>       <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n1_loc</span>
<a name="ln-617"></a>        <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-618"></a>        <span class="n">up</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">recv_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-619"></a>       <span class="k">end do</span>
<a name="ln-620"></a><span class="k">      end do</span>
<a name="ln-621"></a><span class="k">     end do</span>
<a name="ln-622"></a><span class="k">    end do</span>
<a name="ln-623"></a><span class="k">    do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fl_cp</span>
<a name="ln-624"></a>     <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n3_loc</span>
<a name="ln-625"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n2_loc</span>
<a name="ln-626"></a>       <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n1_loc</span>
<a name="ln-627"></a>        <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-628"></a>        <span class="n">up0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">recv_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-629"></a>       <span class="k">end do</span>
<a name="ln-630"></a><span class="k">      end do</span>
<a name="ln-631"></a><span class="k">     end do</span>
<a name="ln-632"></a><span class="k">    end do</span>
<a name="ln-633"></a><span class="k">    if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Fluid density and momentum data read&#39;</span>
<a name="ln-634"></a>   <span class="k">end if</span>
<a name="ln-635"></a>   <span class="c">!=== END FLUID RESTART SECTION ===</span>
<a name="ln-636"></a>
<a name="ln-637"></a>   <span class="c">!=== ENVELOPE RESTART SECTION ===</span>
<a name="ln-638"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">envelope</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-639"></a><span class="k">    write</span> <span class="p">(</span><span class="n">fnamel_env</span><span class="p">,</span> <span class="s1">&#39;(a9,i2.2)&#39;</span><span class="p">)</span> <span class="s1">&#39;ENVfields&#39;</span><span class="p">,</span> <span class="n">imodz</span>
<a name="ln-640"></a>    <span class="n">fnamel_out</span> <span class="o">=</span> <span class="s1">&#39;dumpRestart/&#39;</span><span class="o">//</span><span class="n">fnamel_env</span><span class="o">//</span><span class="s1">&#39;.bin&#39;</span>
<a name="ln-641"></a>    <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">env_cp</span> <span class="o">+</span> <span class="n">env1_cp</span><span class="p">)</span><span class="o">*</span><span class="n">loc_grid_size</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span>
<a name="ln-642"></a>    <span class="c">!==================</span>
<a name="ln-643"></a>    <span class="n">disp</span> <span class="o">=</span> <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">mype</span><span class="p">)</span>
<a name="ln-644"></a>    <span class="n">disp_col</span> <span class="o">=</span> <span class="n">imody</span><span class="o">*</span><span class="n">disp</span>
<a name="ln-645"></a>    <span class="n">disp_col</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">disp_col</span>
<a name="ln-646"></a>    <span class="k">call </span><span class="n">mpi_read_col_dp</span><span class="p">(</span><span class="n">recv_buff</span><span class="p">,</span> <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">mype</span><span class="p">),</span> <span class="n">disp_col</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-647"></a>                         <span class="n">fnamel_out</span><span class="p">)</span>
<a name="ln-648"></a>    <span class="c">!======================</span>
<a name="ln-649"></a>    <span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-650"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">env_cp</span>
<a name="ln-651"></a>     <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n3_loc</span>
<a name="ln-652"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n2_loc</span>
<a name="ln-653"></a>       <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n1_loc</span>
<a name="ln-654"></a>        <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-655"></a>        <span class="n">env</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">recv_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-656"></a>       <span class="k">end do</span>
<a name="ln-657"></a><span class="k">      end do</span>
<a name="ln-658"></a><span class="k">     end do</span>
<a name="ln-659"></a><span class="k">    end do</span>
<a name="ln-660"></a><span class="k">    if</span> <span class="p">(</span><span class="n">Two_color</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-661"></a><span class="k">     do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">env1_cp</span>
<a name="ln-662"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n3_loc</span>
<a name="ln-663"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n2_loc</span>
<a name="ln-664"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n1_loc</span>
<a name="ln-665"></a>         <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-666"></a>         <span class="n">env1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">recv_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-667"></a>        <span class="k">end do</span>
<a name="ln-668"></a><span class="k">       end do</span>
<a name="ln-669"></a><span class="k">      end do</span>
<a name="ln-670"></a><span class="k">     end do</span>
<a name="ln-671"></a><span class="k">    end if</span>
<a name="ln-672"></a><span class="k">    if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Envelope field data read&#39;</span>
<a name="ln-673"></a>   <span class="k">end if</span>
<a name="ln-674"></a>   <span class="c">!=== END ENVELOPE RESTART SECTION ===</span>
<a name="ln-675"></a>
<a name="ln-676"></a>   <span class="c">!=== FIELD RESTART SECTION ===</span>
<a name="ln-677"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">fnamel_ebf</span><span class="p">,</span> <span class="s1">&#39;(a9,i2.2)&#39;</span><span class="p">)</span> <span class="s1">&#39;EB-fields&#39;</span><span class="p">,</span> <span class="n">imodz</span>
<a name="ln-678"></a>   <span class="n">fnamel_out</span> <span class="o">=</span> <span class="s1">&#39;dumpRestart/&#39;</span><span class="o">//</span><span class="n">fnamel_ebf</span><span class="o">//</span><span class="s1">&#39;.bin&#39;</span>
<a name="ln-679"></a>   <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebf_cp</span><span class="o">*</span><span class="n">loc_grid_size</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span>
<a name="ln-680"></a>   <span class="c">!=========================</span>
<a name="ln-681"></a>   <span class="n">disp</span> <span class="o">=</span> <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">mype</span><span class="p">)</span>
<a name="ln-682"></a>   <span class="n">disp_col</span> <span class="o">=</span> <span class="n">imody</span><span class="o">*</span><span class="n">disp</span>
<a name="ln-683"></a>   <span class="n">disp_col</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">disp_col</span>
<a name="ln-684"></a>
<a name="ln-685"></a>   <span class="k">call </span><span class="n">mpi_read_col_dp</span><span class="p">(</span><span class="n">recv_buff</span><span class="p">,</span> <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">mype</span><span class="p">),</span> <span class="n">disp_col</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-686"></a>                        <span class="n">fnamel_out</span><span class="p">)</span>
<a name="ln-687"></a>   <span class="c">!===========================</span>
<a name="ln-688"></a>   <span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-689"></a>   <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ebf_cp</span>
<a name="ln-690"></a>    <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n3_loc</span>
<a name="ln-691"></a>     <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n2_loc</span>
<a name="ln-692"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n1_loc</span>
<a name="ln-693"></a>       <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-694"></a>       <span class="n">ebf</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">recv_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-695"></a>      <span class="k">end do</span>
<a name="ln-696"></a><span class="k">     end do</span>
<a name="ln-697"></a><span class="k">    end do</span>
<a name="ln-698"></a><span class="k">   end do</span>
<a name="ln-699"></a><span class="k">   if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Electromagnetic fields data read&#39;</span>
<a name="ln-700"></a>   <span class="c">!=== END FIELD RESTART SECTION===</span>
<a name="ln-701"></a>
<a name="ln-702"></a>   <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-703"></a>    <span class="n">nps_loc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">npt_arr</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
<a name="ln-704"></a>   <span class="k">end do</span>
<a name="ln-705"></a><span class="k">   </span><span class="n">np_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsp</span><span class="p">))</span>
<a name="ln-706"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">np_max</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>                    <span class="c">!READS particles (if any)</span>
<a name="ln-707"></a>    <span class="k">write</span> <span class="p">(</span><span class="n">fnamel_part</span><span class="p">,</span> <span class="s1">&#39;(a9,i2.2)&#39;</span><span class="p">)</span> <span class="s1">&#39;Particles&#39;</span><span class="p">,</span> <span class="n">imodz</span>
<a name="ln-708"></a>    <span class="n">fnamel_out</span> <span class="o">=</span> <span class="s1">&#39;dumpRestart/&#39;</span><span class="o">//</span><span class="n">fnamel_part</span><span class="o">//</span><span class="s1">&#39;.bin&#39;</span>
<a name="ln-709"></a>    <span class="k">call </span><span class="n">p_alloc</span><span class="p">(</span><span class="n">np_max</span><span class="p">,</span> <span class="n">ndv</span><span class="p">,</span> <span class="n">nps_loc</span><span class="p">,</span> <span class="n">nsp</span><span class="p">,</span> <span class="n">lpf_ord</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mem_psize</span><span class="p">)</span>
<a name="ln-710"></a>    <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span> <span class="o">=</span> <span class="n">ndv</span><span class="o">*</span><span class="n">ip_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span>
<a name="ln-711"></a>    <span class="c">!=======================</span>
<a name="ln-712"></a>    <span class="n">disp_col</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-713"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">mype</span><span class="p">,</span> <span class="n">npe_yloc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">disp_col</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">lenw</span><span class="p">(</span><span class="n">imodz</span><span class="o">*</span><span class="n">npe_yloc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">mype</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-714"></a>                                                <span class="p">)</span>
<a name="ln-715"></a>    <span class="n">disp_col</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">disp_col</span>
<a name="ln-716"></a>    <span class="k">call </span><span class="n">mpi_read_col_dp</span><span class="p">(</span><span class="n">recv_buff</span><span class="p">,</span> <span class="n">lenw</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">mype</span><span class="p">),</span> <span class="n">disp_col</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-717"></a>                         <span class="n">fnamel_out</span><span class="p">)</span>
<a name="ln-718"></a>    <span class="c">!==============================</span>
<a name="ln-719"></a>    <span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-720"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-721"></a>     <span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-722"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">np</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-723"></a><span class="k">      do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ndv</span>
<a name="ln-724"></a>       <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-725"></a>        <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-726"></a>        <span class="n">spec</span><span class="p">(</span><span class="n">ic</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">recv_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-727"></a>       <span class="k">end do</span>
<a name="ln-728"></a><span class="k">      end do</span>
<a name="ln-729"></a><span class="k">     end if</span>
<a name="ln-730"></a><span class="k">    end do</span>
<a name="ln-731"></a><span class="k">   end if</span>
<a name="ln-732"></a>   <span class="c">!=================================</span>
<a name="ln-733"></a>   <span class="n">fname_out</span> <span class="o">=</span> <span class="s1">&#39;dumpRestart/&#39;</span><span class="o">//</span><span class="n">fname_yz</span><span class="o">//</span><span class="s1">&#39;.bin&#39;</span>
<a name="ln-734"></a>   <span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-735"></a>   <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-736"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">loc_npty</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-737"></a><span class="k">     do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loc_npty</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-738"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-739"></a>     <span class="k">end do</span>
<a name="ln-740"></a><span class="k">    end if</span>
<a name="ln-741"></a><span class="k">   end do</span>
<a name="ln-742"></a><span class="k">   do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-743"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">loc_nptz</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-744"></a><span class="k">     do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loc_nptz</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-745"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-746"></a>     <span class="k">end do</span>
<a name="ln-747"></a><span class="k">    end if</span>
<a name="ln-748"></a><span class="k">   end do</span>
<a name="ln-749"></a><span class="k">   do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-750"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">loc_nptz</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-751"></a><span class="k">     do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loc_nptz</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-752"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">loc_npty</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-753"></a><span class="k">       do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loc_npty</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-754"></a>        <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-755"></a>       <span class="k">end do</span>
<a name="ln-756"></a><span class="k">      end if</span>
<a name="ln-757"></a><span class="k">     end do</span>
<a name="ln-758"></a><span class="k">    end if</span>
<a name="ln-759"></a><span class="k">   end do</span>
<a name="ln-760"></a><span class="k">   call </span><span class="n">intvec_distribute</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">npe</span><span class="p">)</span>
<a name="ln-761"></a>   <span class="n">np_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">lenw</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-762"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">np_max</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-763"></a>
<a name="ln-764"></a><span class="k">    </span><span class="n">disp</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-765"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">mype</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">disp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">lenw</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">mype</span><span class="p">))</span>
<a name="ln-766"></a>    <span class="n">disp</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">disp</span>
<a name="ln-767"></a>    <span class="k">call </span><span class="n">mpi_read_dp</span><span class="p">(</span><span class="n">recv_buff</span><span class="p">,</span> <span class="n">lenw</span><span class="p">(</span><span class="n">mype</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">disp</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">fname_out</span><span class="p">)</span>
<a name="ln-768"></a>    <span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-769"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-770"></a>     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loc_npty</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-771"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-772"></a>      <span class="n">loc_ypt</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">recv_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-773"></a>     <span class="k">end do</span>
<a name="ln-774"></a><span class="k">    end do</span>
<a name="ln-775"></a><span class="k">    do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-776"></a>     <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loc_nptz</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-777"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-778"></a>      <span class="n">loc_zpt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">recv_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-779"></a>     <span class="k">end do</span>
<a name="ln-780"></a><span class="k">    end do</span>
<a name="ln-781"></a><span class="k">    do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-782"></a>     <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loc_nptz</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-783"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loc_npty</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-784"></a>       <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-785"></a>       <span class="n">loc_wghyz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">recv_buff</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-786"></a>      <span class="k">end do</span>
<a name="ln-787"></a><span class="k">     end do</span>
<a name="ln-788"></a><span class="k">    end do</span>
<a name="ln-789"></a><span class="k">   end if</span> <span class="c">!end of part read</span>
<a name="ln-790"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Particles data read&#39;</span>
<a name="ln-791"></a>   <span class="c">!============================================</span>
<a name="ln-792"></a>   <span class="k">deallocate</span> <span class="p">(</span><span class="n">recv_buff</span><span class="p">)</span>
<a name="ln-793"></a>   <span class="c">!===============================</span>
<a name="ln-794"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;END TOTAL DUMP READ&#39;</span>
<a name="ln-795"></a>  <span class="k">end subroutine</span>
<a name="ln-796"></a>  <span class="c">!===========================</span>
<a name="ln-797"></a> <span class="k">end module</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-07-30 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> ALaDyn was developed by The ALaDyn Collaboration</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>