<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A High-Accuracy PIC Code for the Maxwell-Vlasov Equations">
    
    <meta name="author" content="The ALaDyn Collaboration" >
    <link rel="icon" href="../favicon.png">

    <title>boris_push.f90 &ndash; ALaDyn</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">ALaDyn <small>3.0.1</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Guide</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/aladyn.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/aladyn.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>boris_push.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 0.9% of total for source files.">210 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/boris_push.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">boris_push.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/boris_push.html">boris_push</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/boris_push.f90.html#src">boris_push.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~boris_push.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefileboris_pushf90EfferentGraph" width="529pt" height="126pt"
 viewBox="0.00 0.00 529.00 126.40" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~boris_push.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 122.3965)">
<title>sourcefile~~boris_push.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-122.3965 525,-122.3965 525,4 -4,4"/>
<!-- sourcefile~boris_push.f90 -->
<g id="sourcefile~~boris_push.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~boris_push.f90</title>
<polygon fill="none" stroke="#000000" points="521,-78.3965 431,-78.3965 431,-54.3965 521,-54.3965 521,-78.3965"/>
<text text-anchor="middle" x="476" y="-63.9965" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">boris_push.f90</text>
</g>
<!-- sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~boris_push.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~fstruct_data.f90</title>
<g id="a_sourcefile~~boris_push.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/fstruct_data.f90.html" xlink:title="fstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="238,-118.3965 142,-118.3965 142,-94.3965 238,-94.3965 238,-118.3965"/>
<text text-anchor="middle" x="190" y="-103.9965" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~boris_push.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~boris_push.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~boris_push.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M434.658,-78.4856C422.0218,-81.8087 408.0225,-85.1202 395,-87.3965 345.988,-95.9635 289.6639,-100.8316 248.4715,-103.4903"/>
<polygon fill="#ff0000" stroke="#ff0000" points="248.1024,-100.0064 238.3385,-104.1195 248.5363,-106.9929 248.1024,-100.0064"/>
</g>
<!-- sourcefile~common_param.f90 -->
<g id="sourcefile~~boris_push.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~common_param.f90</title>
<g id="a_sourcefile~~boris_push.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/common_param.f90.html" xlink:title="common_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="395,-78.3965 274,-78.3965 274,-54.3965 395,-54.3965 395,-78.3965"/>
<text text-anchor="middle" x="334.5" y="-63.9965" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">common_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~boris_push.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~boris_push.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~boris_push.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M430.8395,-66.3965C422.7008,-66.3965 414.0401,-66.3965 405.3768,-66.3965"/>
<polygon fill="#ff0000" stroke="#ff0000" points="405.2369,-62.8966 395.2368,-66.3965 405.2368,-69.8966 405.2369,-62.8966"/>
</g>
<!-- sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~boris_push.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~pstruct_data.f90</title>
<g id="a_sourcefile~~boris_push.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/pstruct_data.f90.html" xlink:title="pstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="384,-36.3965 285,-36.3965 285,-12.3965 384,-12.3965 384,-36.3965"/>
<text text-anchor="middle" x="334.5" y="-21.9965" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~boris_push.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~boris_push.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~boris_push.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M435.4518,-54.361C419.7617,-49.7038 401.632,-44.3226 385.1029,-39.4164"/>
<polygon fill="#ff0000" stroke="#ff0000" points="385.6367,-35.924 375.0541,-36.4337 383.6448,-42.6346 385.6367,-35.924"/>
</g>
<!-- sourcefile~precision_def.f90 -->
<g id="sourcefile~~boris_push.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~precision_def.f90</title>
<g id="a_sourcefile~~boris_push.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/precision_def.f90.html" xlink:title="precision_def.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="106,-58.3965 0,-58.3965 0,-34.3965 106,-34.3965 106,-58.3965"/>
<text text-anchor="middle" x="53" y="-43.9965" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">precision_def.F90</text>
</a>
</g>
</g>
<!-- sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~boris_push.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M162.276,-94.2546C141.4782,-85.1461 112.7957,-72.5843 90.0347,-62.616"/>
<polygon fill="#ff0000" stroke="#ff0000" points="91.2469,-59.326 80.6828,-58.5203 88.4387,-65.7381 91.2469,-59.326"/>
</g>
<!-- sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~boris_push.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M273.7653,-62.0814C227.2364,-58.7756 163.2383,-54.2287 116.1249,-50.8814"/>
<polygon fill="#00ff00" stroke="#00ff00" points="116.2633,-47.3825 106.0404,-50.1649 115.7671,-54.3649 116.2633,-47.3825"/>
</g>
<!-- sourcefile~struct_def.f90 -->
<g id="sourcefile~~boris_push.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~struct_def.f90</title>
<g id="a_sourcefile~~boris_push.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/struct_def.f90.html" xlink:title="struct_def.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="232.5,-38.3965 147.5,-38.3965 147.5,-14.3965 232.5,-14.3965 232.5,-38.3965"/>
<text text-anchor="middle" x="190" y="-23.9965" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">struct_def.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~boris_push.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M284.7713,-25.0848C271.2398,-25.272 256.5372,-25.4755 242.84,-25.6651"/>
<polygon fill="#0000ff" stroke="#0000ff" points="242.5482,-22.1687 232.5976,-25.8069 242.6451,-29.1681 242.5482,-22.1687"/>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~boris_push.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M290.8484,-12.3879C251.5315,-3.3865 192.353,5.6441 142,-5.3965 120.6882,-10.0694 98.3929,-20.3503 81.4482,-29.4475"/>
<polygon fill="#0000ff" stroke="#0000ff" points="79.6756,-26.4282 72.6252,-34.3366 83.0685,-32.5511 79.6756,-26.4282"/>
</g>
<!-- sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~boris_push.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M147.4033,-32.615C137.5222,-34.0575 126.7978,-35.6231 116.2409,-37.1642"/>
<polygon fill="#ff0000" stroke="#ff0000" points="115.5932,-33.7216 106.2037,-38.6295 116.6044,-40.6482 115.5932,-33.7216"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~boris_push.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileboris_pushf90AfferentGraph" width="383pt" height="74pt"
 viewBox="0.00 0.00 383.00 74.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~boris_push.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 70)">
<title>sourcefile~~boris_push.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-70 379,-70 379,4 -4,4"/>
<!-- sourcefile~boris_push.f90 -->
<g id="sourcefile~~boris_push.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~boris_push.f90</title>
<polygon fill="none" stroke="#000000" points="90,-45 0,-45 0,-21 90,-21 90,-45"/>
<text text-anchor="middle" x="45" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">boris_push.f90</text>
</g>
<!-- sourcefile~pic_evolve_in_time.f90 -->
<g id="sourcefile~~boris_push.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~pic_evolve_in_time.f90</title>
<g id="a_sourcefile~~boris_push.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/pic_evolve_in_time.f90.html" xlink:title="pic_evolve_in_time.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="261,-66 128,-66 128,-42 261,-42 261,-66"/>
<text text-anchor="middle" x="194.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_evolve_in_time.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~boris_push.f90 -->
<g id="sourcefile~~boris_push.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~boris_push.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M127.6208,-44.6056C118.5684,-43.334 109.3604,-42.0406 100.5356,-40.801"/>
<polygon fill="#ff0000" stroke="#ff0000" points="100.7741,-37.3002 90.3844,-39.3751 99.8003,-44.2322 100.7741,-37.3002"/>
</g>
<!-- sourcefile~env_evolve_in_time.f90 -->
<g id="sourcefile~~boris_push.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~env_evolve_in_time.f90</title>
<g id="a_sourcefile~~boris_push.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/env_evolve_in_time.f90.html" xlink:title="env_evolve_in_time.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="263,-24 126,-24 126,0 263,0 263,-24"/>
<text text-anchor="middle" x="194.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">env_evolve_in_time.f90</text>
</a>
</g>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~boris_push.f90 -->
<g id="sourcefile~~boris_push.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~boris_push.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M125.8757,-21.6395C117.2534,-22.8507 108.5217,-24.0772 100.1436,-25.2541"/>
<polygon fill="#ff0000" stroke="#ff0000" points="99.5465,-21.8035 90.1306,-26.6606 100.5203,-28.7354 99.5465,-21.8035"/>
</g>
<!-- sourcefile~aladyn.f90 -->
<g id="sourcefile~~boris_push.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~aladyn.f90</title>
<g id="a_sourcefile~~boris_push.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/aladyn.f90.html" xlink:title="ALaDyn.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="375,-45 299,-45 299,-21 375,-21 375,-45"/>
<text text-anchor="middle" x="337" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALaDyn.F90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_evolve_in_time.f90 -->
<g id="sourcefile~~boris_push.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_evolve_in_time.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M298.8126,-38.6276C290.1852,-39.899 280.7268,-41.2929 271.1375,-42.7061"/>
<polygon fill="#ff0000" stroke="#ff0000" points="270.5092,-39.2608 261.1264,-44.1814 271.5298,-46.186 270.5092,-39.2608"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~env_evolve_in_time.f90 -->
<g id="sourcefile~~boris_push.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~env_evolve_in_time.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M298.8126,-27.3724C290.7861,-26.1895 282.0404,-24.9007 273.1391,-23.5889"/>
<polygon fill="#00ffff" stroke="#00ffff" points="273.4567,-20.098 263.0533,-22.1026 272.4361,-27.0232 273.4567,-20.098"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/boris_push.html">boris_push</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/boris_push.f90.html#src">boris_push.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-2"></a><span class="c">!                            Copyright 2008-2020  The ALaDyn Collaboration                            !</span>
<a name="ln-3"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-4"></a>
<a name="ln-5"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-6"></a><span class="c">!  This file is part of ALaDyn.                                                                       !</span>
<a name="ln-7"></a><span class="c">!                                                                                                     !</span>
<a name="ln-8"></a><span class="c">!  ALaDyn is free software: you can redistribute it and/or modify                                     !</span>
<a name="ln-9"></a><span class="c">!  it under the terms of the GNU General Public License as published by                               !</span>
<a name="ln-10"></a><span class="c">!  the Free Software Foundation, either version 3 of the License, or                                  !</span>
<a name="ln-11"></a><span class="c">!  (at your option) any later version.                                                                !</span>
<a name="ln-12"></a><span class="c">!                                                                                                     !</span>
<a name="ln-13"></a><span class="c">!  ALaDyn is distributed in the hope that it will be useful,                                          !</span>
<a name="ln-14"></a><span class="c">!  but WITHOUT ANY WARRANTY; without even the implied warranty of                                     !</span>
<a name="ln-15"></a><span class="c">!  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                      !</span>
<a name="ln-16"></a><span class="c">!  GNU General Public License for more details.                                                       !</span>
<a name="ln-17"></a><span class="c">!                                                                                                     !</span>
<a name="ln-18"></a><span class="c">!  You should have received a copy of the GNU General Public License                                  !</span>
<a name="ln-19"></a><span class="c">!  along with ALaDyn.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                                    !</span>
<a name="ln-20"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-21"></a>
<a name="ln-22"></a> <span class="k">module </span><span class="n">boris_push</span>
<a name="ln-23"></a>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">pstruct_data</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">fstruct_data</span>
<a name="ln-26"></a>  <span class="k">use </span><span class="n">common_param</span>
<a name="ln-27"></a>
<a name="ln-28"></a>  <span class="k">implicit none</span>
<a name="ln-29"></a>
<a name="ln-30"></a><span class="k"> contains</span>
<a name="ln-31"></a>  <span class="c">! SECTION for Leap-frog integrators in LP regime</span>
<a name="ln-32"></a>  <span class="c">!==========================</span>
<a name="ln-33"></a>  <span class="k">subroutine </span><span class="n">init_lpf_momenta</span><span class="p">(</span><span class="n">sp_loc</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-34"></a>   <span class="k">type</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sp_loc</span>
<a name="ln-35"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">pt</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-36"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">ic</span>
<a name="ln-37"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-38"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">alp</span><span class="p">,</span> <span class="n">dth_lp</span><span class="p">,</span> <span class="n">pp</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">vp</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">efp</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">gam2</span><span class="p">,</span> <span class="n">gam_inv</span>
<a name="ln-39"></a>
<a name="ln-40"></a>   <span class="n">dth_lp</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt_loc</span>
<a name="ln-41"></a>   <span class="n">alp</span> <span class="o">=</span> <span class="n">dth_lp</span><span class="o">*</span><span class="n">lorentz_fact</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="c">! Lfact =1./m</span>
<a name="ln-42"></a>   <span class="c">! Fields are already multiplied by particle(ic) charge</span>
<a name="ln-43"></a>   <span class="c">!=========================</span>
<a name="ln-44"></a>   <span class="c">! from p^n to p^{n-1/2}</span>
<a name="ln-45"></a>   <span class="c">!==========================</span>
<a name="ln-46"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">curr_ndim</span><span class="p">)</span>
<a name="ln-47"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-48"></a>    <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-49"></a>     <span class="n">efp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">alp</span><span class="o">*</span><span class="n">pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="c">!-DT/2*charge*(Ex,Ey,Bz)^n</span>
<a name="ln-50"></a>     <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span> <span class="c">!p_{n}</span>
<a name="ln-51"></a>     <span class="n">gam2</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">+</span><span class="nb">dot_product</span><span class="p">(</span><span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">),</span> <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-52"></a>     <span class="n">gam_inv</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">gam2</span><span class="p">)</span>
<a name="ln-53"></a>     <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">gam_inv</span>
<a name="ln-54"></a>     <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">efp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">vp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">efp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-55"></a>     <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">efp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">efp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-56"></a>    <span class="k">end do</span>
<a name="ln-57"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-58"></a>    <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-59"></a>     <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-60"></a>     <span class="n">efp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">alp</span><span class="o">*</span><span class="n">pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-61"></a>     <span class="n">gam2</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">+</span><span class="nb">dot_product</span><span class="p">(</span><span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span> <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-62"></a>     <span class="n">gam_inv</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">gam2</span><span class="p">)</span> <span class="c">!1/gamma</span>
<a name="ln-63"></a>     <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">gam_inv</span><span class="o">*</span><span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-64"></a>     <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">efp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">vp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">efp</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="p">&amp;</span>
<a name="ln-65"></a>                         <span class="n">vp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">efp</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-66"></a>     <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">efp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">vp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">efp</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="p">&amp;</span>
<a name="ln-67"></a>                         <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">efp</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-68"></a>     <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="n">efp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">efp</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="p">&amp;</span>
<a name="ln-69"></a>                         <span class="n">vp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">efp</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-70"></a>    <span class="k">end do</span>
<a name="ln-71"></a><span class="k">   end select</span>
<a name="ln-72"></a><span class="k">  end subroutine</span>
<a name="ln-73"></a>  <span class="c">!======================================</span>
<a name="ln-74"></a>  <span class="k">subroutine </span><span class="n">lpf_momenta_and_positions</span><span class="p">(</span><span class="n">sp_loc</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-75"></a>
<a name="ln-76"></a>   <span class="k">type</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sp_loc</span>
<a name="ln-77"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">pt</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-78"></a>
<a name="ln-79"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">ic</span>
<a name="ln-80"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">p</span><span class="p">,</span> <span class="n">ch</span>
<a name="ln-81"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">alp</span><span class="p">,</span> <span class="n">dt_lp</span><span class="p">,</span> <span class="n">dth_lp</span><span class="p">,</span> <span class="n">bb</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">pp</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">vp</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">vph</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">efp</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-82"></a>               <span class="n">b2</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">gam02</span><span class="p">,</span> <span class="n">gam2</span><span class="p">,</span> <span class="n">gam</span>
<a name="ln-83"></a>   <span class="c">!========================================</span>
<a name="ln-84"></a>   <span class="c">! uses exact explicit solution for</span>
<a name="ln-85"></a>   <span class="c">! p^{n}=(p^{n+1/2}+p^{n-1/2})/2 and gamma^n=sqrt( 1+p^n*p^n)</span>
<a name="ln-86"></a>   <span class="c">! v^n=p^n/gamma^n</span>
<a name="ln-87"></a>   <span class="c">!========================================</span>
<a name="ln-88"></a>   <span class="c">!Enter Fields multiplied by particle charge</span>
<a name="ln-89"></a>   <span class="n">dt_lp</span> <span class="o">=</span> <span class="n">dt_loc</span>
<a name="ln-90"></a>   <span class="n">dth_lp</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt_lp</span>
<a name="ln-91"></a>   <span class="n">alp</span> <span class="o">=</span> <span class="n">dth_lp</span><span class="o">*</span><span class="n">lorentz_fact</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-92"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">curr_ndim</span><span class="p">)</span>
<a name="ln-93"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-94"></a>    <span class="n">ch</span> <span class="o">=</span> <span class="mi">5</span>
<a name="ln-95"></a>    <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-96"></a>     <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span> <span class="c">!p_{n-1/2}</span>
<a name="ln-97"></a>     <span class="n">efp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">alp</span><span class="o">*</span><span class="n">pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="c">!q*Lfact*(Ex,Ey,Bz)*Dt/2</span>
<a name="ln-98"></a>     <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">efp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="c">!u^{-} in Boris push</span>
<a name="ln-99"></a>     <span class="n">vp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">efp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c">!b_z</span>
<a name="ln-100"></a>     <span class="n">gam02</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">+</span><span class="nb">dot_product</span><span class="p">(</span><span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">),</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">))</span> <span class="c">!gam0 in Boris push</span>
<a name="ln-101"></a>     <span class="n">b2</span> <span class="o">=</span> <span class="n">vp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">vp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c">!b_z*b_z</span>
<a name="ln-102"></a>     <span class="n">gam02</span> <span class="o">=</span> <span class="n">gam02</span> <span class="o">-</span> <span class="n">b2</span>
<a name="ln-103"></a>     <span class="n">gam2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gam02</span> <span class="o">+</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gam02</span><span class="o">*</span><span class="n">gam02</span> <span class="o">+</span> <span class="mf">4.</span><span class="o">*</span><span class="n">b2</span><span class="p">))</span> <span class="c">!exact gam^2 solution</span>
<a name="ln-104"></a>     <span class="n">gam</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gam2</span><span class="p">)</span>
<a name="ln-105"></a>     <span class="c">!==============================</span>
<a name="ln-106"></a>     <span class="c">!p_n=(gam2*vp+gam*(vp crossb)+b*bv/(gam2+b2)</span>
<a name="ln-107"></a>     <span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">gam2</span><span class="o">*</span><span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">gam</span><span class="o">*</span><span class="n">vp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">vp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-108"></a>     <span class="n">vph</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">gam2</span><span class="o">*</span><span class="n">vp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">gam</span><span class="o">*</span><span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">vp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-109"></a>     <span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">gam2</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span>
<a name="ln-110"></a>     <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-111"></a>     <span class="c">!=========== the new momenta</span>
<a name="ln-112"></a>     <span class="c">!        update positions</span>
<a name="ln-113"></a>     <span class="n">pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="c">!old positions stored</span>
<a name="ln-114"></a>     <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-115"></a>     <span class="n">gam2</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">+</span><span class="nb">dot_product</span><span class="p">(</span><span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">),</span> <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-116"></a>     <span class="n">pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">dt_lp</span><span class="o">/</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">gam2</span><span class="p">)</span>
<a name="ln-117"></a>     <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="c">!velocities</span>
<a name="ln-118"></a>     <span class="n">pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="c">!stores DT*V^{n+1/2}</span>
<a name="ln-119"></a>     <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="c">!new positions</span>
<a name="ln-120"></a>    <span class="k">end do</span>
<a name="ln-121"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-122"></a>    <span class="n">ch</span> <span class="o">=</span> <span class="mi">7</span>
<a name="ln-123"></a>    <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-124"></a>     <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-125"></a>     <span class="n">efp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">alp</span><span class="o">*</span><span class="n">pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span> <span class="c">!q*Lfact*(E,B) on p-th-particle</span>
<a name="ln-126"></a>     <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">efp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="c">!p^{-} in Boris push</span>
<a name="ln-127"></a>     <span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">efp</span><span class="p">(</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-128"></a>     <span class="n">gam02</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">+</span><span class="nb">dot_product</span><span class="p">(</span><span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="c">!the lower order gamma in Boris scheme</span>
<a name="ln-129"></a>     <span class="c">!=============================</span>
<a name="ln-130"></a>     <span class="n">b2</span> <span class="o">=</span> <span class="nb">dot_product</span><span class="p">(</span><span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span> <span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-131"></a>     <span class="n">bv</span> <span class="o">=</span> <span class="nb">dot_product</span><span class="p">(</span><span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-132"></a>     <span class="n">gam02</span> <span class="o">=</span> <span class="n">gam02</span> <span class="o">-</span> <span class="n">b2</span>
<a name="ln-133"></a>     <span class="n">gam2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gam02</span> <span class="o">+</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gam02</span><span class="o">*</span><span class="n">gam02</span> <span class="o">+</span> <span class="mf">4.</span><span class="o">*</span><span class="p">(</span><span class="n">b2</span> <span class="o">+</span> <span class="n">bv</span><span class="o">*</span><span class="n">bv</span><span class="p">)))</span> <span class="c">! exact solution for gam2=1+p_n*p_n</span>
<a name="ln-134"></a>     <span class="n">gam</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gam2</span><span class="p">)</span>
<a name="ln-135"></a>     <span class="c">!============================</span>
<a name="ln-136"></a>     <span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">gam2</span><span class="o">*</span><span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">bv</span>
<a name="ln-137"></a>     <span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">gam</span><span class="o">*</span><span class="p">(</span><span class="n">vp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">bb</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">vp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">bb</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-138"></a>     <span class="n">vph</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">vph</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">gam</span><span class="o">*</span><span class="p">(</span><span class="n">vp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bb</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-139"></a>     <span class="n">vph</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">vph</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">gam</span><span class="o">*</span><span class="p">(</span><span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bb</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">vp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-140"></a>     <span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">b2</span> <span class="o">+</span> <span class="n">gam2</span><span class="p">)</span> <span class="c">!p_n=(p_{n+1/2)+p_{n-1/2})/2</span>
<a name="ln-141"></a>     <span class="c">!======== advance momenta</span>
<a name="ln-142"></a>     <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-143"></a>     <span class="c">!==========</span>
<a name="ln-144"></a>     <span class="n">pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="c">!stores old positions</span>
<a name="ln-145"></a>     <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-146"></a>     <span class="n">gam2</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">+</span><span class="nb">dot_product</span><span class="p">(</span><span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span> <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-147"></a>     <span class="n">pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="n">dt_lp</span><span class="o">/</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">gam2</span><span class="p">)</span>
<a name="ln-148"></a>     <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">*</span><span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-149"></a>     <span class="n">pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="c">!stores dt*V</span>
<a name="ln-150"></a>     <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="c">!new positions</span>
<a name="ln-151"></a>    <span class="k">end do</span>
<a name="ln-152"></a><span class="k">   end select</span>
<a name="ln-153"></a>   <span class="c">!====================</span>
<a name="ln-154"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">iform</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-155"></a>    <span class="c">!old charge stored for charge preserving schemes</span>
<a name="ln-156"></a>    <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-157"></a>     <span class="n">pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span>
<a name="ln-158"></a>    <span class="k">end do</span>
<a name="ln-159"></a><span class="k">   end if</span>
<a name="ln-160"></a>   <span class="c">!In comoving frame vbeam &gt;0</span>
<a name="ln-161"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">vbeam</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-162"></a><span class="k">    do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-163"></a>     <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">dt_lp</span><span class="o">*</span><span class="n">vbeam</span>
<a name="ln-164"></a>     <span class="n">pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">dt_lp</span><span class="o">*</span><span class="n">vbeam</span> <span class="c">!</span>
<a name="ln-165"></a>    <span class="k">end do</span>
<a name="ln-166"></a><span class="k">   end if</span>
<a name="ln-167"></a><span class="k">  end subroutine</span>
<a name="ln-168"></a>  <span class="c">!=============================</span>
<a name="ln-169"></a>  <span class="k">subroutine </span><span class="n">lpf_env_momenta</span><span class="p">(</span><span class="n">sp_loc</span><span class="p">,</span> <span class="n">f_pt</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-170"></a>
<a name="ln-171"></a>   <span class="k">type</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sp_loc</span>
<a name="ln-172"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">f_pt</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-173"></a>
<a name="ln-174"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">ic</span>
<a name="ln-175"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-176"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bb</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">pp</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">vp</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">vph</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-177"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">b2</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">alp</span><span class="p">,</span> <span class="n">dt_lp</span><span class="p">,</span> <span class="n">efp</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-178"></a>
<a name="ln-179"></a>   <span class="n">dt_lp</span> <span class="o">=</span> <span class="n">dt_loc</span>
<a name="ln-180"></a>   <span class="n">alp</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt_lp</span><span class="o">*</span><span class="n">lorentz_fact</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-181"></a>   <span class="c">!==========================</span>
<a name="ln-182"></a>   <span class="c">!Enter F_pt(1:2)= q*(E+0.5q*grad[F]/gamp) and F_pt(3)=q*B/gamp     where F=|A|^2/2</span>
<a name="ln-183"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">curr_ndim</span><span class="p">)</span>
<a name="ln-184"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-185"></a>    <span class="c">!F_pt(5)=wgh/gamp</span>
<a name="ln-186"></a>    <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-187"></a>     <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span> <span class="c">!p_{n-1/2}</span>
<a name="ln-188"></a>     <span class="n">efp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">alp</span><span class="o">*</span><span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="c">!Lz_fact*Dt/2</span>
<a name="ln-189"></a>     <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">efp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="c">!u^{-}</span>
<a name="ln-190"></a>     <span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">efp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-191"></a>     <span class="c">!==============================</span>
<a name="ln-192"></a>     <span class="n">b2</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">+</span><span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-193"></a>     <span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">vp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-194"></a>     <span class="n">vph</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">vp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-195"></a>     <span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">b2</span> <span class="c">!p_n=(p_{n+1/2)+p_{n-1/2})/2</span>
<a name="ln-196"></a>     <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-197"></a>     <span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-198"></a>    <span class="k">end do</span>
<a name="ln-199"></a>    <span class="c">!F_pt(5)=wgh/gamp unchanged</span>
<a name="ln-200"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-201"></a>    <span class="c">!F_pt(7)=wgh/gamp</span>
<a name="ln-202"></a>    <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-203"></a>     <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-204"></a>     <span class="n">efp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">alp</span><span class="o">*</span><span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span> <span class="c">!multiply by Lz_fact*Dt/2</span>
<a name="ln-205"></a>     <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">efp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="c">!p_{n-1/2}+alp*(E+0.5*F/gamp)</span>
<a name="ln-206"></a>     <span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">efp</span><span class="p">(</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span> <span class="c">!alp*B/gamp</span>
<a name="ln-207"></a>     <span class="c">!=============================</span>
<a name="ln-208"></a>     <span class="c">! The Boris pusher</span>
<a name="ln-209"></a>     <span class="c">!=========================</span>
<a name="ln-210"></a>     <span class="n">b2</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">+</span><span class="nb">dot_product</span><span class="p">(</span><span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span> <span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-211"></a>     <span class="n">bv</span> <span class="o">=</span> <span class="nb">dot_product</span><span class="p">(</span><span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-212"></a>     <span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">vp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">bb</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">vp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">bb</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bv</span>
<a name="ln-213"></a>     <span class="n">vph</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">vp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">vp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bb</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">bb</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">bv</span>
<a name="ln-214"></a>     <span class="n">vph</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">vp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bb</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">vp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">bb</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">bv</span>
<a name="ln-215"></a>     <span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">b2</span> <span class="c">!p_n=(p_{n+1/2)+p_{n-1/2})/2</span>
<a name="ln-216"></a>     <span class="c">!======== advance momenta</span>
<a name="ln-217"></a>     <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">vph</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-218"></a>     <span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="c">!stores old positions</span>
<a name="ln-219"></a>    <span class="k">end do</span>
<a name="ln-220"></a>    <span class="c">!F_pt(7)=wgh/gamp unchanged</span>
<a name="ln-221"></a>   <span class="k">end select</span>
<a name="ln-222"></a><span class="k">  end subroutine</span>
<a name="ln-223"></a>  <span class="c">!======================</span>
<a name="ln-224"></a>  <span class="k">subroutine </span><span class="n">lpf_env_positions</span><span class="p">(</span><span class="n">sp_loc</span><span class="p">,</span> <span class="n">f_pt</span><span class="p">,</span> <span class="n">np</span><span class="p">)</span>
<a name="ln-225"></a>
<a name="ln-226"></a>   <span class="k">type</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sp_loc</span>
<a name="ln-227"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">f_pt</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-228"></a>
<a name="ln-229"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">np</span>
<a name="ln-230"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">p</span><span class="p">,</span> <span class="n">ch</span>
<a name="ln-231"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">pp</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">vp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-232"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">b2</span><span class="p">,</span> <span class="n">gam2</span><span class="p">,</span> <span class="n">gam_inv</span><span class="p">,</span> <span class="n">dt_lp</span><span class="p">,</span> <span class="n">dth_lp</span><span class="p">,</span> <span class="n">gam</span><span class="p">,</span> <span class="n">gam3</span>
<a name="ln-233"></a>
<a name="ln-234"></a>   <span class="n">dt_lp</span> <span class="o">=</span> <span class="n">dt_loc</span>
<a name="ln-235"></a>   <span class="n">dth_lp</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt_lp</span>
<a name="ln-236"></a>   <span class="n">ch</span> <span class="o">=</span> <span class="mi">5</span>
<a name="ln-237"></a>   <span class="c">!==========================</span>
<a name="ln-238"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">curr_ndim</span><span class="p">)</span>
<a name="ln-239"></a>    <span class="c">!============  enter F_pt(3)=F, F_pt (1:2) Grad[F] where F=|A|^2/2</span>
<a name="ln-240"></a>    <span class="c">!             at time level t^{n+1/2} assigned to the x^n positions</span>
<a name="ln-241"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-242"></a>    <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-243"></a>     <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span> <span class="c">!p^{n+1/2}</span>
<a name="ln-244"></a>     <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="c">!grad[F]</span>
<a name="ln-245"></a>     <span class="c">!=============================</span>
<a name="ln-246"></a>     <span class="n">gam2</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">+</span><span class="nb">dot_product</span><span class="p">(</span><span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">),</span> <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-247"></a>     <span class="n">gam</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gam2</span><span class="p">)</span>
<a name="ln-248"></a>     <span class="n">gam3</span> <span class="o">=</span> <span class="n">gam2</span><span class="o">*</span><span class="n">gam</span>
<a name="ln-249"></a>     <span class="n">b2</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="nb">dot_product</span><span class="p">(</span><span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">),</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-250"></a>     <span class="c">!-------------------- def gamma_p</span>
<a name="ln-251"></a>     <span class="n">gam_inv</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">gam</span>
<a name="ln-252"></a>     <span class="n">gam_inv</span> <span class="o">=</span> <span class="n">gam_inv</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">dt_lp</span><span class="o">*</span><span class="n">b2</span><span class="o">/</span><span class="n">gam3</span><span class="p">)</span>
<a name="ln-253"></a>     <span class="c">!============================</span>
<a name="ln-254"></a>     <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">dt_lp</span><span class="o">*</span><span class="n">gam_inv</span><span class="o">*</span><span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-255"></a>     <span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="c">!old (x,y)^n positions</span>
<a name="ln-256"></a>     <span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">dt_lp</span><span class="o">*</span><span class="n">gam_inv</span> <span class="c">! dt/gamma</span>
<a name="ln-257"></a>     <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-258"></a>     <span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="c">! dt*V^{n+1/2}  velocities</span>
<a name="ln-259"></a>    <span class="k">end do</span>
<a name="ln-260"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-261"></a>    <span class="c">!============enter F_pt(4)=F, F_pt (1:3) Grad[F] where F=|A|^2/2 at t^{n+1/2}</span>
<a name="ln-262"></a>    <span class="c">! assigned at x^n</span>
<a name="ln-263"></a>    <span class="n">ch</span> <span class="o">=</span> <span class="mi">7</span>
<a name="ln-264"></a>    <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-265"></a>     <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span> <span class="c">!p^{n+1/2}</span>
<a name="ln-266"></a>     <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="c">!grad[F]</span>
<a name="ln-267"></a>     <span class="c">!=============================</span>
<a name="ln-268"></a>     <span class="n">gam2</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">+</span><span class="nb">dot_product</span><span class="p">(</span><span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span> <span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-269"></a>     <span class="n">gam</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gam2</span><span class="p">)</span>
<a name="ln-270"></a>     <span class="n">gam3</span> <span class="o">=</span> <span class="n">gam2</span><span class="o">*</span><span class="n">gam</span>
<a name="ln-271"></a>     <span class="n">b2</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="nb">dot_product</span><span class="p">(</span><span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-272"></a>     <span class="c">!--------------------</span>
<a name="ln-273"></a>     <span class="n">gam_inv</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">gam2</span><span class="p">)</span>
<a name="ln-274"></a>     <span class="n">gam_inv</span> <span class="o">=</span> <span class="n">gam_inv</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">dt_lp</span><span class="o">*</span><span class="n">b2</span><span class="o">/</span><span class="n">gam3</span><span class="p">)</span>
<a name="ln-275"></a>     <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">dt_lp</span><span class="o">*</span><span class="n">gam_inv</span><span class="o">*</span><span class="n">pp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-276"></a>     <span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="c">!old positions</span>
<a name="ln-277"></a>     <span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="n">dt_lp</span><span class="o">*</span><span class="n">gam_inv</span> <span class="c">! dt*gam_inv</span>
<a name="ln-278"></a>     <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-279"></a>     <span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">vp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="c">! dt*V^{n+1/2}  velocities</span>
<a name="ln-280"></a>    <span class="k">end do</span>
<a name="ln-281"></a><span class="k">   end select</span>
<a name="ln-282"></a><span class="k">   if</span> <span class="p">(</span><span class="n">iform</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-283"></a><span class="k">    do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-284"></a>     <span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span>
<a name="ln-285"></a>    <span class="k">end do</span>
<a name="ln-286"></a><span class="k">   end if</span>
<a name="ln-287"></a>   <span class="c">!====================== vb=-wbet &gt; 0 in comoving x-coordinate</span>
<a name="ln-288"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">vbeam</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-289"></a><span class="k">    do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-290"></a>     <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sp_loc</span><span class="p">%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">dt_lp</span><span class="o">*</span><span class="n">vbeam</span>
<a name="ln-291"></a>     <span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">f_pt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">dt_lp</span><span class="o">*</span><span class="n">vbeam</span> <span class="c">!new x-position</span>
<a name="ln-292"></a>    <span class="k">end do</span>
<a name="ln-293"></a><span class="k">   end if</span>
<a name="ln-294"></a><span class="k">  end subroutine</span>
<a name="ln-295"></a>  <span class="c">!=====================</span>
<a name="ln-296"></a> <span class="k">end module</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-07-30 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> ALaDyn was developed by The ALaDyn Collaboration</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>